<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module NEURO 02 - Le Cerveau Ado en Chantier</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --neuro-primary: #6b8e23;
            --neuro-accent: #9acd32;
            --neuro-warning: #ff6b6b;
            --neuro-success: #4ecdc4;
            --void-dark: #0d0d1a;
            --deep-dark: #080812;
            --panel-bg: rgba(13, 13, 26, 0.95);
            --text-primary: #f5f5ff;
            --text-secondary: #9999bb;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Brain pattern background */
        .brain-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(107, 142, 35, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(154, 205, 50, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Animated synapses */
        .synapse-lines {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }
        
        .synapse-lines::before,
        .synapse-lines::after {
            content: '';
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--neuro-accent), transparent);
            height: 1px;
            width: 200px;
            animation: synapseMove 10s linear infinite;
        }
        
        .synapse-lines::before { top: 25%; left: -200px; }
        .synapse-lines::after { top: 75%; right: -200px; animation-delay: -5s; animation-direction: reverse; }
        
        @keyframes synapseMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 400px)); }
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(107, 142, 35, 0.6));
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--neuro-primary), var(--neuro-accent), var(--neuro-success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--neuro-accent);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 35px;
            background: linear-gradient(135deg, rgba(107, 142, 35, 0.2), rgba(154, 205, 50, 0.2));
            border: 2px solid var(--neuro-accent);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--neuro-accent);
            clip-path: polygon(10px 0%, calc(100% - 10px) 0%, 100% 50%, calc(100% - 10px) 100%, 10px 100%, 0% 50%);
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 60px; height: 60px;
            border: 3px solid var(--text-secondary);
            background: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .progress-node.active {
            border-color: var(--neuro-accent);
            color: var(--neuro-accent);
            box-shadow: 0 0 25px rgba(154, 205, 50, 0.5);
        }
        
        .progress-node.completed {
            border-color: var(--neuro-success);
            background: rgba(78, 205, 196, 0.2);
            color: var(--neuro-success);
        }
        
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 2px solid var(--neuro-accent);
            padding: 15px 25px;
            text-align: center;
            clip-path: polygon(8px 0%, calc(100% - 8px) 0%, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0% calc(100% - 8px), 0% 8px);
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--neuro-accent);
        }
        
        .content-panel {
            background: var(--panel-bg);
            border: 2px solid rgba(107, 142, 35, 0.3);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--neuro-primary), var(--neuro-accent), var(--neuro-success));
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(107, 142, 35, 0.15), rgba(154, 205, 50, 0.1));
            padding: 18px 25px;
            border-bottom: 1px solid rgba(107, 142, 35, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--neuro-primary), var(--neuro-accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--neuro-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .panel-body { padding: 25px; }
        
        /* Intro specific styles */
        .intro-screen { text-align: center; padding: 30px 20px; }
        
        .brain-diagram {
            margin: 30px auto;
            max-width: 400px;
            position: relative;
        }
        
        .brain-svg {
            width: 100%;
            height: auto;
        }
        
        .brain-part {
            display: inline-block;
            padding: 12px 20px;
            margin: 10px;
            border: 2px solid;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            text-transform: uppercase;
        }
        
        .part-limbique { border-color: var(--neuro-warning); color: var(--neuro-warning); background: rgba(255, 107, 107, 0.1); }
        .part-prefrontal { border-color: var(--neuro-success); color: var(--neuro-success); background: rgba(78, 205, 196, 0.1); }
        
        /* Name input */
        .name-input-group {
            margin: 30px auto;
            max-width: 400px;
        }
        
        .name-input {
            width: 100%;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--neuro-accent);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .name-input:focus {
            outline: none;
            border-color: var(--neuro-success);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        
        .name-input::placeholder { color: var(--text-secondary); }
        
        /* Flashcards */
        .flashcard-container { perspective: 1200px; margin-bottom: 20px; }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 240px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute;
            width: 100%;
            min-height: 240px;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            border: 2px solid var(--neuro-accent);
            background: var(--panel-bg);
        }
        
        .card-back { transform: rotateY(180deg); }
        
        .card-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--text-primary);
            text-align: center;
            line-height: 1.5;
        }
        
        .card-answer {
            font-size: 1.1rem;
            color: var(--neuro-accent);
            text-align: center;
            line-height: 1.7;
        }
        
        .card-source {
            margin-top: 15px;
            padding: 8px 15px;
            background: rgba(107, 142, 35, 0.2);
            border-left: 3px solid var(--neuro-primary);
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Quiz styles */
        .quiz-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .quiz-option {
            padding: 18px;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .quiz-option:hover { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.1); }
        .quiz-option.selected { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.2); }
        .quiz-option.correct { border-color: var(--neuro-success); background: rgba(78, 205, 196, 0.2); }
        .quiz-option.incorrect { border-color: var(--neuro-warning); background: rgba(255, 107, 107, 0.2); }
        
        .quiz-feedback {
            margin-top: 20px;
            padding: 20px;
            background: var(--panel-bg);
            border-left: 4px solid var(--neuro-accent);
            line-height: 1.7;
        }
        
        /* Scenario styles */
        .scenario-context {
            background: rgba(107, 142, 35, 0.1);
            padding: 20px;
            border-left: 4px solid var(--neuro-primary);
            margin-bottom: 20px;
            font-size: 1.05rem;
            line-height: 1.7;
        }
        
        .scenario-intro {
            font-size: 1.05rem;
            line-height: 1.7;
            margin-bottom: 25px;
            color: var(--text-secondary);
        }
        
        .scenario-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .scenario-choice {
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        
        .scenario-choice:hover { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.1); }
        .scenario-choice.selected { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.2); }
        
        .scenario-result {
            margin-top: 20px;
            padding: 25px;
            background: var(--panel-bg);
            border-left: 4px solid var(--neuro-success);
            line-height: 1.8;
        }
        
        /* Buttons */
        .btn {
            padding: 15px 35px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--neuro-accent);
            color: var(--deep-dark);
        }
        
        .btn:hover {
            background: var(--neuro-success);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--neuro-accent);
            color: var(--neuro-accent);
        }
        
        .btn-secondary:hover {
            background: var(--neuro-accent);
            color: var(--deep-dark);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        /* Final screen */
        .final-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .mastery-badge {
            display: inline-block;
            padding: 20px 40px;
            margin: 30px 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            border: 3px solid;
            clip-path: polygon(10px 0%, calc(100% - 10px) 0%, 100% 50%, calc(100% - 10px) 100%, 10px 100%, 0% 50%);
        }
        
        .mastery-expert { border-color: var(--neuro-success); color: var(--neuro-success); background: rgba(78, 205, 196, 0.2); }
        .mastery-confirmed { border-color: var(--neuro-accent); color: var(--neuro-accent); background: rgba(154, 205, 50, 0.2); }
        .mastery-training { border-color: var(--neuro-primary); color: var(--neuro-primary); background: rgba(107, 142, 35, 0.2); }
        
        .save-code-box {
            background: var(--deep-dark);
            border: 2px solid var(--neuro-success);
            padding: 20px;
            margin: 30px auto;
            max-width: 600px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            color: var(--neuro-success);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .save-code-box:hover {
            background: rgba(78, 205, 196, 0.1);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }
        
        /* Utilities */
        .info { color: var(--neuro-accent); font-weight: 600; }
        .warning { color: var(--neuro-warning); font-weight: 600; }
        .success { color: var(--neuro-success); font-weight: 600; }
        
        @media (max-width: 768px) {
            .app-container { padding: 15px; }
            .glitch-title { font-size: 1.5rem; }
            .flashcard, .card-face { min-height: 200px; }
        }
    </style>
</head>
<body>
    <div class="brain-bg"></div>
    <div class="synapse-lines"></div>
    
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

        const MODULE_DATA = {
            id: "NEURO_02",
            version: "1.0.0",
            titre: "LE CERVEAU ADO EN CHANTIER",
            sous_titre: "Pourquoi on r√©agit si fort",
            description: "Comprendre pourquoi les √©motions sont plus intenses √† l'adolescence et pourquoi le contr√¥le est plus difficile.",
            auteur: "Programme pHARe",
            niveau1: {
                titre: "Ferrari sans freins",
                type: "flashcards",
                xp_reward: 50,
                cartes: [
                    {
                        recto: "Le cerveau ado est-il fini ?",
                        verso: "Non. Il est en pleine construction et continuera √† m√ªrir jusqu'√† environ 25 ans.",
                        source: "Neurosciences du d√©veloppement"
                    },
                    {
                        recto: "Quelle zone m√ªrit en premier ?",
                        verso: "Le syst√®me √©motionnel, tr√®s sensible aux r√©compenses sociales.",
                        source: "Syst√®me limbique"
                    },
                    {
                        recto: "Quelle zone m√ªrit plus tard ?",
                        verso: "Le cortex pr√©frontal, responsable du contr√¥le et de la r√©flexion.",
                        source: "Fonctions ex√©cutives"
                    },
                    {
                        recto: "Pourquoi les √©motions sont-elles plus intenses ?",
                        verso: "Le syst√®me limbique (√©motions) est en surchauffe pendant que le cortex pr√©frontal (r√©gulation) finit de se d√©velopper.",
                        source: "D√©s√©quilibre d√©veloppemental"
                    },
                    {
                        recto: "Qu'est-ce que le 'dual-systems model' ?",
                        verso: "Mod√®le qui explique l'adolescence comme un d√©s√©quilibre temporaire : syst√®me √©motionnel √† fond, syst√®me de contr√¥le en construction.",
                        source: "Psychologie d√©veloppementale"
                    },
                    {
                        recto: "Les ados prennent-ils plus de risques ?",
                        verso: "Oui, surtout en pr√©sence de pairs. Le cerveau social influence fortement les d√©cisions, parfois plus que la raison.",
                        source: "Influence sociale et prise de risque"
                    },
                    {
                        recto: "Peut-on 'r√©parer' ce d√©s√©quilibre ?",
                        verso: "On ne r√©pare pas : c'est normal. Mais on peut entra√Æner le contr√¥le avec des strat√©gies (pause, respiration, anticipation).",
                        source: "Neuroplasticit√© et entra√Ænement"
                    }
                ]
            },
            niveau2: {
                titre: "R√©agir ou r√©fl√©chir",
                type: "quiz",
                xp_reward: 100,
                questions: [
                    {
                        texte: "Un √©l√®ve r√©agit violemment sous le regard des autres.",
                        question: "Quelle explication est la plus juste ?",
                        choix: [
                            {
                                txt: "La recherche de reconnaissance sociale",
                                correct: true,
                                feedback: "Exact. Le cerveau social est hypersensible √† l'adolescence. Le regard des pairs active intens√©ment les zones de r√©compense, ce qui peut pousser √† des r√©actions extr√™mes pour impressionner ou se prot√©ger socialement."
                            },
                            {
                                txt: "Un manque total de r√®gles",
                                correct: false,
                                feedback: "Non. M√™me avec des r√®gles, le cerveau ado privil√©gie l'√©motion imm√©diate et la validation sociale. Ce n'est pas qu'il ignore les r√®gles, c'est que le syst√®me √©motionnel court-circuite temporairement le raisonnement."
                            }
                        ]
                    },
                    {
                        texte: "L√©a explose apr√®s une remarque pourtant anodine en apparence.",
                        question: "Pourquoi cette r√©action disproportionn√©e ?",
                        choix: [
                            {
                                txt: "Son cortex pr√©frontal n'a pas eu le temps de mod√©rer la r√©action √©motionnelle",
                                correct: true,
                                feedback: "Exact. Le syst√®me limbique r√©agit en quelques millisecondes, le cortex pr√©frontal a besoin de secondes pour intervenir. Chez l'ado, ce d√©lai est encore plus long car cette zone est en construction."
                            },
                            {
                                txt: "Elle fait expr√®s pour attirer l'attention",
                                correct: false,
                                feedback: "Faux. La plupart du temps, la r√©action est authentique et incontr√¥l√©e. Bl√¢mer l'intention ignore le fonctionnement neurologique r√©el de l'adolescence."
                            }
                        ]
                    },
                    {
                        texte: "Tom dit souvent 'Je sais pas ce qui m'a pris' apr√®s avoir r√©agi fort.",
                        question: "Que se passe-t-il neurologiquement ?",
                        choix: [
                            {
                                txt: "Il ment pour √©viter la responsabilit√©",
                                correct: false,
                                feedback: "Pas n√©cessairement. Cette phrase traduit souvent une r√©alit√© : l'action a pr√©c√©d√© la r√©flexion. Le cerveau √©motionnel a agi avant que le cerveau rationnel ne prenne le relais."
                            },
                            {
                                txt: "Son syst√®me limbique a pris le contr√¥le avant que le cortex pr√©frontal n'intervienne",
                                correct: true,
                                feedback: "Exact. C'est le 'd√©tournement √©motionnel' (emotional hijack). Le syst√®me √©motionnel d√©clenche une action r√©flexe avant m√™me que la conscience rationnelle ne soit consult√©e."
                            }
                        ]
                    },
                    {
                        texte: "Un groupe d'ados fait quelque chose qu'aucun ne ferait seul.",
                        question: "Pourquoi ce ph√©nom√®ne ?",
                        choix: [
                            {
                                txt: "Effet de dilution de responsabilit√© + hypersensibilit√© au regard des pairs",
                                correct: true,
                                feedback: "Exact. Double m√©canisme : 1) 'Ce n'est pas que moi' (dilution). 2) Le cerveau ado valorise √©norm√©ment l'approbation sociale, ce qui amplifie les comportements en groupe."
                            },
                            {
                                txt: "Ils sont tous naturellement d√©viants",
                                correct: false,
                                feedback: "Faux. C'est un biais neurologique universel √† l'adolescence, pas un trait de personnalit√©. La m√™me personne agira tr√®s diff√©remment seule vs en groupe."
                            }
                        ]
                    },
                    {
                        texte: "Une strat√©gie pour aider le cerveau ado √† mieux r√©guler :",
                        question: "Laquelle est la plus efficace neurologiquement ?",
                        choix: [
                            {
                                txt: "Punir syst√©matiquement toute r√©action √©motionnelle",
                                correct: false,
                                feedback: "Inefficace et contre-productif. √áa ne change pas le fonctionnement c√©r√©bral, √ßa ajoute juste de la honte qui peut aggraver les r√©actions futures."
                            },
                            {
                                txt: "Entra√Æner le 'temps de pause' entre d√©clencheur et r√©action",
                                correct: true,
                                feedback: "Exact. La neuroplasticit√© permet d'entra√Æner ce d√©lai. Techniques : respiration profonde, compter jusqu'√† 5, verbaliser l'√©motion ('je sens que je vais exploser'). Le cortex pr√©frontal se muscle avec la pratique."
                            }
                        ]
                    }
                ]
            },
            niveau3: {
                titre: "Installer des freins",
                type: "dojo",
                xp_reward: 150,
                scenarios: [
                    {
                        contexte: "Une provocation d√©clenche une mont√©e de col√®re instantan√©e.",
                        question: "Que peut-on entra√Æner ?",
                        choix: [
                            {
                                txt: "Ignorer l'√©motion et faire comme si de rien n'√©tait",
                                impact: -10,
                                level: "inefficace",
                                feedback: "Mauvaise strat√©gie. R√©primer l'√©motion ne la fait pas dispara√Ætre et peut cr√©er une explosion diff√©r√©e encore plus forte. Le cerveau a besoin de reconnaissance de l'√©motion, pas de d√©ni."
                            },
                            {
                                txt: "Exploser imm√©diatement pour 'lib√©rer la pression'",
                                impact: -20,
                                level: "contre-productif",
                                feedback: "Contre-productif. Agir sur l'impulsion renforce le circuit neuronal de la r√©action imm√©diate. Chaque explosion rend la suivante plus probable."
                            },
                            {
                                txt: "Le temps de pause avant l'action",
                                impact: 100,
                                level: "optimal",
                                feedback: "Exact. Le contr√¥le se travaille. Strat√©gie : RECONNA√éTRE l'√©motion ('Je sens la col√®re'), NOMMER ('Je suis √©nerv√© par cette provocation'), PAUSE (respirer 3 fois profond√©ment), CHOISIR (agir ou pas). Ce processus cr√©e un nouvel automatisme avec la pratique."
                            },
                            {
                                txt: "Demander √† quelqu'un d'intervenir √† votre place",
                                impact: 20,
                                level: "partiel",
                                feedback: "Strat√©gie utile en urgence mais ne d√©veloppe pas le contr√¥le interne. Mieux que rien, mais l'objectif est d'entra√Æner son propre cortex pr√©frontal √† prendre le relais."
                            }
                        ]
                    },
                    {
                        contexte: "En cours, une remarque blesse profond√©ment. L'envie de pleurer ou de crier monte.",
                        question: "Comment utiliser la connaissance du cerveau ado ?",
                        choix: [
                            {
                                txt: "Se dire 'Je suis trop sensible, je devrais √™tre plus fort¬∑e'",
                                impact: -15,
                                level: "contre-productif",
                                feedback: "Auto-bl√¢me inutile. La sensibilit√© √©motionnelle accrue est NORMALE √† l'adolescence. Se culpabiliser ajoute de la souffrance sans r√©soudre le probl√®me."
                            },
                            {
                                txt: "Verbaliser int√©rieurement : 'C'est mon syst√®me limbique qui r√©agit fort, c'est normal'",
                                impact: 80,
                                level: "tr√®s efficace",
                                feedback: "Excellent. La m√©tacognition (penser sur sa pens√©e) active le cortex pr√©frontal. Comprendre que c'est neurologique et temporaire r√©duit l'intensit√© √©motionnelle. Puis : respiration, sortir si besoin, en parler apr√®s."
                            },
                            {
                                txt: "Attendre que √ßa passe sans rien faire",
                                impact: 10,
                                level: "insuffisant",
                                feedback: "Passif. L'√©motion passera mais on n'entra√Æne pas le contr√¥le. Mieux : observer l'√©motion activement en se disant 'je regarde ma col√®re/tristesse monter, je la reconnais, elle va redescendre'."
                            }
                        ]
                    },
                    {
                        contexte: "Devant un groupe, quelqu'un vous d√©fie. L'envie de r√©agir violemment pour 'ne pas perdre la face' est intense.",
                        question: "Comment g√©rer l'influence du cerveau social ?",
                        choix: [
                            {
                                txt: "R√©agir fort pour montrer qu'on ne se laisse pas faire",
                                impact: -25,
                                level: "pi√®ge social",
                                feedback: "Vous tombez dans le pi√®ge du cerveau social ado. La validation du groupe devient plus importante que votre s√©curit√© ou vos valeurs. R√©sultat : escalade, regrets, possibles cons√©quences graves."
                            },
                            {
                                txt: "Se rappeler : 'Mon cerveau survalorise le regard des autres en ce moment'",
                                impact: 90,
                                level: "optimal",
                                feedback: "Excellent recul m√©tacognitif. Reconna√Ætre que l'urgence sociale est amplifi√©e par le cerveau ado permet de relativiser. Strat√©gie : 'Cette pression va passer, mais les cons√©quences de mes actes restent'. Puis : sortir de la sc√®ne, ou r√©pondre calmement."
                            },
                            {
                                txt: "Ignorer totalement en faisant semblant de ne rien entendre",
                                impact: 30,
                                level: "partiel",
                                feedback: "Peut marcher parfois mais ne r√©sout pas la pression interne. Le cerveau continue de r√©agir m√™me si on n'agit pas. Mieux : reconna√Ætre int√©rieurement la pression, puis choisir consciemment de ne pas y c√©der."
                            }
                        ]
                    },
                    {
                        contexte: "Apr√®s une dispute, vous r√©alisez que vous avez r√©agi de mani√®re disproportionn√©e.",
                        question: "Comment transformer cette prise de conscience en apprentissage ?",
                        choix: [
                            {
                                txt: "Se dire 'je suis nul¬∑le, je ne changerai jamais'",
                                impact: -20,
                                level: "destructeur",
                                feedback: "Auto-sabotage. Cette pens√©e renforce l'impuissance et emp√™che l'apprentissage. Le cerveau ado est en construction : les erreurs sont des opportunit√©s d'entra√Ænement, pas des preuves d'√©chec."
                            },
                            {
                                txt: "Analyser : 'Quel a √©t√© le d√©clencheur ? Qu'est-ce que j'aurais pu faire diff√©remment ?'",
                                impact: 100,
                                level: "optimal",
                                feedback: "Parfait. Analyse post-action = entra√Ænement du cortex pr√©frontal. Identifier le pattern (d√©clencheur ‚Üí √©motion ‚Üí r√©action) permet de cr√©er un nouveau circuit. Prochaine fois : 'Je connais ce pattern, je peux choisir une autre r√©ponse'."
                            },
                            {
                                txt: "Oublier et passer √† autre chose",
                                impact: 5,
                                level: "occasion manqu√©e",
                                feedback: "Dommage. Chaque situation est une chance d'entra√Æner le cerveau. Sans analyse, le m√™me sch√©ma se r√©p√©tera. La neuroplasticit√© fonctionne par r√©p√©tition consciente."
                            },
                            {
                                txt: "S'excuser et proposer une strat√©gie pour la prochaine fois",
                                impact: 95,
                                level: "excellent",
                                feedback: "Tr√®s mature. Vous prenez responsabilit√© (bon pour le cortex pr√©frontal) ET vous cr√©ez un plan d'action futur. Exemple : 'La prochaine fois que je sens √ßa monter, je te dis que j'ai besoin de 5 minutes'. Le cerveau apprend par l'action planifi√©e."
                            }
                        ]
                    }
                ]
            }
        };

        const flashcardsData = MODULE_DATA.niveau1.cartes.map(c => ({
            question: c.recto,
            answer: c.verso,
            source: c.source
        }));

        const quizData = MODULE_DATA.niveau2.questions.map(q => ({
            question: q.texte + " " + q.question,
            options: q.choix.map(ch => ch.txt),
            correct: q.choix.findIndex(ch => ch.correct),
            feedback: q.choix.find(ch => ch.correct).feedback
        }));

        const scenarioData = MODULE_DATA.niveau3.scenarios.map(s => ({
            title: s.contexte,
            context: s.contexte,
            intro: s.question,
            choices: s.choix.map(ch => ({
                text: ch.txt,
                result: ch.feedback,
                impact: { regulation: ch.impact }
            }))
        }));

        function encodeSaveCode(data) { return btoa(JSON.stringify(data)); }
        function decodeSaveCode(code) { try { return JSON.parse(atob(code)); } catch { return null; } }
        function getMasteryLevel(score) {
            if (score >= 450) return { level: "Expert", class: "mastery-expert" };
            if (score >= 280) return { level: "Confirm√©", class: "mastery-confirmed" };
            return { level: "En formation", class: "mastery-training" };
        }

        function App() {
            const [gameState, setGameState] = useState("intro");
            const [playerData, setPlayerData] = useState({ 
                name: "", 
                class: "", 
                level: 1, 
                score: 0, 
                xp: 0, 
                quizScore: 0, 
                scenarioScore: 0, 
                flashcardsViewed: 0, 
                finished: false 
            });
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            function startGame() {
                if (playerData.name.trim()) setGameState("flashcards");
            }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({ 
                        ...prev, 
                        flashcardsViewed: Math.max(prev.flashcardsViewed, currentFlashcard + 2), 
                        xp: prev.xp + 12 
                    }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({ 
                        ...prev, 
                        level: 2, 
                        flashcardsViewed: flashcardsData.length, 
                        xp: prev.xp + 50 
                    }));
                }
            }

            function prevFlashcard() { 
                if (currentFlashcard > 0) { 
                    setCurrentFlashcard(prev => prev - 1); 
                    setFlashcardFlipped(false); 
                } 
            }

            function selectQuizAnswer(index) { 
                if (!showQuizFeedback) setSelectedAnswer(index); 
            }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                if (selectedAnswer === quizData[currentQuiz].correct) {
                    setPlayerData(prev => ({ 
                        ...prev, 
                        score: prev.score + 30, 
                        quizScore: prev.quizScore + 30, 
                        xp: prev.xp + 30 
                    }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({ ...prev, level: 3, xp: prev.xp + 60 }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                const choice = scenarioData[currentScenario].choices[index];
                const values = Object.values(choice.impact);
                const totalChange = Math.max(0, values.reduce((a, b) => a + b, 0));
                setPlayerData(prev => ({ 
                    ...prev, 
                    score: prev.score + totalChange, 
                    scenarioScore: prev.scenarioScore + totalChange, 
                    xp: prev.xp + 25 
                }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    finishModule();
                }
            }

            function finishModule() {
                setPlayerData(prev => ({ 
                    ...prev, 
                    finished: true, 
                    xp: prev.xp + 100 
                }));
                setGameState("final");
            }

            function generateSaveCode() {
                const saveData = {
                    v: MODULE_DATA.version,
                    d: new Date().toISOString(),
                    m: MODULE_DATA.id,
                    n: playerData.name,
                    c: playerData.class,
                    s: playerData.score,
                    x: playerData.xp,
                    f: playerData.finished
                };
                return encodeSaveCode(saveData);
            }

            function copySaveCode() {
                const code = generateSaveCode();
                navigator.clipboard.writeText(code).then(() => {
                    alert("‚úÖ Code copi√© dans le presse-papier !");
                });
            }

            // Render functions
            function renderIntro() {
                return (
                    <div className="intro-screen">
                        <div className="content-panel">
                            <div className="panel-body">
                                <h2 style={{fontSize: "1.8rem", marginBottom: "20px", color: "var(--neuro-accent)"}}>
                                    üß† {MODULE_DATA.titre}
                                </h2>
                                <p style={{fontSize: "1.1rem", lineHeight: "1.8", marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    {MODULE_DATA.description}
                                </p>
                                
                                <div className="brain-diagram">
                                    <div className="brain-part part-limbique">
                                        ‚ö° Syst√®me Limbique<br/>
                                        <span style={{fontSize: "0.75rem"}}>(√âmotions √† fond)</span>
                                    </div>
                                    <div className="brain-part part-prefrontal">
                                        üéØ Cortex Pr√©frontal<br/>
                                        <span style={{fontSize: "0.75rem"}}>(Contr√¥le en construction)</span>
                                    </div>
                                </div>

                                <p style={{fontSize: "1rem", lineHeight: "1.6", marginTop: "30px", color: "var(--text-primary)"}}>
                                    <strong>Ce que tu vas apprendre :</strong><br/>
                                    ‚Ä¢ Pourquoi les √©motions sont plus intenses<br/>
                                    ‚Ä¢ Comment le cerveau ado fonctionne diff√©remment<br/>
                                    ‚Ä¢ Des strat√©gies concr√®tes pour mieux r√©guler
                                </p>

                                <div className="name-input-group">
                                    <input 
                                        type="text" 
                                        className="name-input"
                                        placeholder="Ton pr√©nom"
                                        value={playerData.name}
                                        onChange={(e) => setPlayerData(prev => ({...prev, name: e.target.value}))}
                                    />
                                    <input 
                                        type="text" 
                                        className="name-input"
                                        placeholder="Ta classe (optionnel)"
                                        value={playerData.class}
                                        onChange={(e) => setPlayerData(prev => ({...prev, class: e.target.value}))}
                                    />
                                    <button 
                                        className="btn" 
                                        onClick={startGame}
                                        disabled={!playerData.name.trim()}
                                    >
                                        Commencer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderFlashcards() {
                const card = flashcardsData[currentFlashcard];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">üß†</div>
                                <div className="panel-title">Niveau 1 : {MODULE_DATA.niveau1.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Carte {currentFlashcard + 1} / {flashcardsData.length}
                                </p>
                                
                                <div className="flashcard-container">
                                    <div 
                                        className={`flashcard ${flashcardFlipped ? 'flipped' : ''}`}
                                        onClick={() => setFlashcardFlipped(!flashcardFlipped)}
                                    >
                                        <div className="card-face">
                                            <div className="card-question">{card.question}</div>
                                            <p style={{marginTop: "20px", fontSize: "0.85rem", color: "var(--text-secondary)"}}>
                                                Clique pour retourner
                                            </p>
                                        </div>
                                        <div className="card-face card-back">
                                            <div className="card-answer">{card.answer}</div>
                                            {card.source && <div className="card-source">Source : {card.source}</div>}
                                        </div>
                                    </div>
                                </div>

                                <div className="btn-group">
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={prevFlashcard}
                                        disabled={currentFlashcard === 0}
                                    >
                                        ‚Üê Pr√©c√©dent
                                    </button>
                                    <button 
                                        className="btn" 
                                        onClick={nextFlashcard}
                                    >
                                        {currentFlashcard === flashcardsData.length - 1 ? "Passer au Quiz ‚Üí" : "Suivant ‚Üí"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderQuiz() {
                const quiz = quizData[currentQuiz];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">‚ö°</div>
                                <div className="panel-title">Niveau 2 : {MODULE_DATA.niveau2.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Question {currentQuiz + 1} / {quizData.length}
                                </p>
                                
                                <div className="quiz-question">{quiz.question}</div>
                                
                                <div className="quiz-options">
                                    {quiz.options.map((option, index) => (
                                        <div
                                            key={index}
                                            className={`quiz-option ${
                                                selectedAnswer === index ? 'selected' : ''
                                            } ${
                                                showQuizFeedback && index === quiz.correct ? 'correct' : ''
                                            } ${
                                                showQuizFeedback && selectedAnswer === index && index !== quiz.correct ? 'incorrect' : ''
                                            }`}
                                            onClick={() => selectQuizAnswer(index)}
                                        >
                                            {option}
                                        </div>
                                    ))}
                                </div>

                                {showQuizFeedback && (
                                    <div className="quiz-feedback">
                                        <strong>
                                            {selectedAnswer === quiz.correct ? "‚úÖ Correct !" : "‚ùå Pas tout √† fait..."}
                                        </strong>
                                        <p style={{marginTop: "10px"}}>{quiz.feedback}</p>
                                    </div>
                                )}

                                <div className="btn-group">
                                    {!showQuizFeedback ? (
                                        <button 
                                            className="btn" 
                                            onClick={validateQuizAnswer}
                                            disabled={selectedAnswer === null}
                                        >
                                            Valider
                                        </button>
                                    ) : (
                                        <button className="btn" onClick={nextQuizQuestion}>
                                            {currentQuiz === quizData.length - 1 ? "Passer aux Sc√©narios ‚Üí" : "Question suivante ‚Üí"}
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderScenarios() {
                const scenario = scenarioData[currentScenario];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">üéØ</div>
                                <div className="panel-title">Niveau 3 : {MODULE_DATA.niveau3.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Sc√©nario {currentScenario + 1} / {scenarioData.length}
                                </p>
                                
                                <div className="scenario-context">
                                    <strong>Situation :</strong> {scenario.context}
                                </div>
                                
                                <div className="scenario-intro">{scenario.intro}</div>
                                
                                <div className="scenario-choices">
                                    {scenario.choices.map((choice, index) => (
                                        <div
                                            key={index}
                                            className={`scenario-choice ${scenarioChoice === index ? 'selected' : ''}`}
                                            onClick={() => !showScenarioResult && makeScenarioChoice(index)}
                                        >
                                            {choice.text}
                                        </div>
                                    ))}
                                </div>

                                {showScenarioResult && scenarioChoice !== null && (
                                    <div className="scenario-result">
                                        <strong>Analyse :</strong>
                                        <p style={{marginTop: "10px"}}>
                                            {scenario.choices[scenarioChoice].result}
                                        </p>
                                    </div>
                                )}

                                {showScenarioResult && (
                                    <div className="btn-group">
                                        <button className="btn" onClick={nextScenario}>
                                            {currentScenario === scenarioData.length - 1 ? "Terminer le module ‚Üí" : "Sc√©nario suivant ‚Üí"}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            function renderFinal() {
                const mastery = getMasteryLevel(playerData.score);
                return (
                    <div className="final-screen">
                        <div className="content-panel">
                            <div className="panel-body">
                                <h2 style={{fontSize: "2rem", marginBottom: "20px", color: "var(--neuro-accent)"}}>
                                    üéì Module Compl√©t√© !
                                </h2>
                                
                                <p style={{fontSize: "1.2rem", marginBottom: "30px"}}>
                                    Bravo <strong>{playerData.name}</strong> !
                                </p>

                                <div className={`mastery-badge ${mastery.class}`}>
                                    {mastery.level}
                                </div>

                                <div className="xp-display">
                                    <div className="xp-box">
                                        <div className="xp-label">Score Total</div>
                                        <div className="xp-value">{playerData.score}</div>
                                    </div>
                                    <div className="xp-box">
                                        <div className="xp-label">XP Gagn√©</div>
                                        <div className="xp-value">{playerData.xp}</div>
                                    </div>
                                </div>

                                <p style={{margin: "30px 0", lineHeight: "1.8", color: "var(--text-secondary)"}}>
                                    Tu as maintenant les cl√©s pour comprendre comment ton cerveau fonctionne √† l'adolescence.
                                    <br/>
                                    <strong style={{color: "var(--neuro-accent)"}}>
                                        Le contr√¥le √©motionnel, √ßa s'entra√Æne !
                                    </strong>
                                </p>

                                <div className="save-code-box" onClick={copySaveCode}>
                                    <div style={{fontSize: "0.85rem", marginBottom: "10px", color: "var(--text-secondary)"}}>
                                        üìã CODE DE VALIDATION (clique pour copier)
                                    </div>
                                    <div style={{fontSize: "0.9rem", wordBreak: "break-all"}}>
                                        {generateSaveCode()}
                                    </div>
                                </div>

                                <p style={{fontSize: "0.9rem", color: "var(--text-secondary)"}}>
                                    Copie ce code et valide-le sur le hub PIXHARe pour d√©bloquer le niveau suivant.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // Main render
            return (
                <div className="app-container">
                    <div className="header">
                        <div className="pillar-icon">üß†</div>
                        <h1 className="glitch-title">{MODULE_DATA.titre}</h1>
                        <div className="subtitle">{MODULE_DATA.sous_titre}</div>
                        <div className="module-badge">PILIER NEURO & EMPATHIE</div>
                    </div>

                    {gameState !== "intro" && (
                        <>
                            <div className="progress-bar">
                                <div className={`progress-node ${playerData.level >= 1 ? 'completed' : ''} ${playerData.level === 1 && gameState === 'flashcards' ? 'active' : ''}`}>
                                    1
                                </div>
                                <div className={`progress-node ${playerData.level >= 2 ? 'completed' : ''} ${playerData.level === 2 && gameState === 'quiz' ? 'active' : ''}`}>
                                    2
                                </div>
                                <div className={`progress-node ${playerData.level >= 3 ? 'completed' : ''} ${playerData.level === 3 && gameState === 'scenarios' ? 'active' : ''}`}>
                                    3
                                </div>
                            </div>

                            <div className="xp-display">
                                <div className="xp-box">
                                    <div className="xp-label">Score</div>
                                    <div className="xp-value">{playerData.score}</div>
                                </div>
                                <div className="xp-box">
                                    <div className="xp-label">XP</div>
                                    <div className="xp-value">{playerData.xp}</div>
                                </div>
                            </div>
                        </>
                    )}

                    {gameState === "intro" && renderIntro()}
                    {gameState === "flashcards" && renderFlashcards()}
                    {gameState === "quiz" && renderQuiz()}
                    {gameState === "scenarios" && renderScenarios()}
                    {gameState === "final" && renderFinal()}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
