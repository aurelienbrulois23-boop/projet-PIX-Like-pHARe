<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module GROUPE 02 - Le Pouvoir des T√©moins</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --witness-gold: #f59e0b;
            --witness-amber: #fbbf24;
            --defender-green: #10b981;
            --passive-gray: #6b7280;
            --reinforcer-red: #ef4444;
            --assistant-orange: #f97316;
            --void-dark: #0d0d1a;
            --deep-dark: #080812;
            --panel-bg: rgba(13, 13, 26, 0.95);
            --text-primary: #f5f5ff;
            --text-secondary: #9999bb;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .witness-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 70%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Eye pattern overlay */
        .eye-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(circle at center, rgba(245, 158, 11, 0.03) 2px, transparent 2px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(245, 158, 11, 0.6));
            animation: eyeBlink 4s ease-in-out infinite;
        }
        
        @keyframes eyeBlink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--witness-gold), var(--defender-green), var(--witness-amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--witness-gold);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 35px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(16, 185, 129, 0.2));
            border: 2px solid var(--witness-gold);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--witness-gold);
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 55px; height: 55px;
            border: 3px solid var(--text-secondary);
            background: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            border-radius: 50%;
            position: relative;
            transition: all 0.4s ease;
        }
        
        .progress-node::before {
            content: '';
            position: absolute;
            inset: -5px;
            border: 2px dashed transparent;
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .progress-node.active {
            border-color: var(--witness-gold);
            color: var(--witness-gold);
            box-shadow: 0 0 25px rgba(245, 158, 11, 0.5);
        }
        
        .progress-node.active::before {
            border-color: var(--witness-gold);
            animation: spinDash 8s linear infinite;
        }
        
        @keyframes spinDash {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .progress-node.completed {
            border-color: var(--defender-green);
            background: rgba(16, 185, 129, 0.2);
            color: var(--defender-green);
        }
        
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 2px solid var(--witness-gold);
            padding: 15px 25px;
            text-align: center;
            border-radius: 10px;
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--witness-gold);
        }
        
        .content-panel {
            background: var(--panel-bg);
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--reinforcer-red), var(--assistant-orange), var(--witness-gold), var(--passive-gray), var(--defender-green));
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(16, 185, 129, 0.1));
            padding: 18px 25px;
            border-bottom: 1px solid rgba(245, 158, 11, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--witness-gold), var(--defender-green));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--witness-gold);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .panel-body { padding: 25px; }
        
        /* Unlock & intro */
        .unlock-screen { text-align: center; padding: 40px 20px; }
        
        .lock-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: eyePulse 2s ease-in-out infinite;
        }
        
        @keyframes eyePulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(245, 158, 11, 0.5)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 30px rgba(245, 158, 11, 0.8)); }
        }
        
        .unlock-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--witness-gold);
            margin-bottom: 15px;
        }
        
        .code-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--witness-gold);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            margin: 20px auto;
            display: block;
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--defender-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .error-msg {
            color: var(--reinforcer-red);
            font-family: 'Share Tech Mono', monospace;
            margin-top: 15px;
            padding: 10px;
            border: 1px solid var(--reinforcer-red);
            border-radius: 10px;
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Role cards - Salmivalli taxonomy */
        .role-spectrum {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 25px 0;
        }
        
        .role-tag {
            padding: 10px 18px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            border: 2px solid;
            border-radius: 20px;
            text-transform: uppercase;
        }
        
        .role-aggressor { border-color: var(--reinforcer-red); color: var(--reinforcer-red); background: rgba(239, 68, 68, 0.1); }
        .role-assistant { border-color: var(--assistant-orange); color: var(--assistant-orange); background: rgba(249, 115, 22, 0.1); }
        .role-reinforcer { border-color: var(--witness-amber); color: var(--witness-amber); background: rgba(251, 191, 36, 0.1); }
        .role-passive { border-color: var(--passive-gray); color: var(--passive-gray); background: rgba(107, 114, 128, 0.1); }
        .role-defender { border-color: var(--defender-green); color: var(--defender-green); background: rgba(16, 185, 129, 0.1); }
        
        /* Data highlight */
        .data-highlight {
            display: inline-block;
            padding: 8px 15px;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid var(--witness-gold);
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--witness-gold);
            margin: 5px;
        }
        
        /* Flashcards */
        .flashcard-container { perspective: 1200px; margin-bottom: 20px; }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 260px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .flashcard-face {
            position: absolute;
            width: 100%;
            min-height: 260px;
            backface-visibility: hidden;
            border: 2px solid var(--witness-gold);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 25px;
            background: var(--deep-dark);
        }
        
        .flashcard-front {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(16, 185, 129, 0.05));
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(245, 158, 11, 0.1));
            border-color: var(--defender-green);
        }
        
        .flashcard-step {
            position: absolute;
            top: 15px; right: 15px;
            padding: 8px 18px;
            background: linear-gradient(135deg, var(--witness-gold), var(--defender-green));
            color: var(--deep-dark);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 20px;
        }
        
        .flashcard-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--witness-gold);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .flashcard-hint {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--defender-green);
            text-align: center;
        }
        
        .flashcard-answer {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
        }
        
        .flashcard-answer strong { color: var(--defender-green); }
        .flashcard-answer .data { color: var(--witness-gold); font-family: 'Orbitron', sans-serif; }
        .flashcard-answer .warning { color: var(--reinforcer-red); }
        
        .flashcard-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: transparent;
            border: 2px solid var(--witness-gold);
            color: var(--witness-gold);
            padding: 12px 30px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 25px;
        }
        
        .nav-btn:hover {
            background: rgba(245, 158, 11, 0.2);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
        }
        
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        
        /* Quiz */
        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(16, 185, 129, 0.05));
            border-left: 4px solid var(--witness-gold);
            border-radius: 0 15px 15px 0;
        }
        
        .quiz-options { display: flex; flex-direction: column; gap: 12px; }
        
        .quiz-option {
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-option:hover:not(.selected):not(.correct):not(.incorrect) {
            border-color: var(--witness-gold);
            background: rgba(245, 158, 11, 0.1);
            transform: translateX(5px);
        }
        
        .quiz-option.selected { border-color: var(--witness-gold); background: rgba(245, 158, 11, 0.15); }
        .quiz-option.correct { border-color: var(--defender-green); background: rgba(16, 185, 129, 0.2); }
        .quiz-option.incorrect { border-color: var(--reinforcer-red); background: rgba(239, 68, 68, 0.15); }
        
        .option-marker {
            width: 35px; height: 35px;
            border: 2px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }
        
        .option-text { flex: 1; font-size: 0.95rem; }
        
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-left: 4px solid var(--defender-green);
            border-radius: 0 15px 15px 0;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .feedback-box.incorrect-feedback {
            border-color: var(--reinforcer-red);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .feedback-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--defender-green);
            margin-bottom: 10px;
        }
        
        .feedback-box.incorrect-feedback .feedback-title { color: var(--reinforcer-red); }
        
        /* Scenario */
        .scenario-intro {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 15px;
        }
        
        .scenario-context {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--witness-gold);
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px dashed var(--witness-gold);
            border-radius: 10px;
        }
        
        .five-steps-box {
            margin: 20px 0;
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--defender-green);
            border-radius: 15px;
        }
        
        .step-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .step-item.active { background: rgba(16, 185, 129, 0.15); }
        .step-item.blocked { background: rgba(239, 68, 68, 0.1); }
        
        .step-number {
            width: 35px; height: 35px;
            background: var(--defender-green);
            color: var(--deep-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .step-item.blocked .step-number { background: var(--reinforcer-red); }
        
        .choice-btn {
            display: block;
            width: 100%;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            border-radius: 12px;
            padding: 18px 20px;
            margin-bottom: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }
        
        .choice-btn:hover {
            border-color: var(--witness-gold);
            background: rgba(245, 158, 11, 0.1);
            transform: translateX(5px);
        }
        
        .choice-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--defender-green);
            border-radius: 15px;
        }
        
        .impact-score {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .impact-item {
            padding: 8px 15px;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--witness-gold);
            border-radius: 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
        }
        
        .impact-item.positive { border-color: var(--defender-green); color: var(--defender-green); }
        .impact-item.negative { border-color: var(--reinforcer-red); color: var(--reinforcer-red); }
        
        .action-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--witness-gold), var(--defender-green));
            color: var(--deep-dark);
            border: none;
            padding: 15px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
        }
        
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        /* Completion */
        .completion-screen { text-align: center; padding: 50px 20px; }
        
        .completion-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: eyePulse 2s ease-in-out infinite;
        }
        
        .completion-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--witness-gold), var(--defender-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--panel-bg);
            border: 2px solid var(--witness-gold);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--witness-gold);
        }
        
        .stat-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .save-code-box {
            background: var(--deep-dark);
            border: 2px solid var(--defender-green);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .save-code-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--defender-green);
            margin-bottom: 10px;
        }
        
        .save-code {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--witness-gold);
            word-break: break-all;
            background: rgba(245, 158, 11, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--witness-gold);
        }
        
        .copy-btn {
            margin-top: 15px;
            background: transparent;
            border: 2px solid var(--defender-green);
            color: var(--defender-green);
            padding: 10px 25px;
            font-family: 'Share Tech Mono', monospace;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover { background: rgba(16, 185, 129, 0.2); }
        
        .mastery-badge {
            display: inline-block;
            padding: 10px 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            border: 2px solid;
            border-radius: 25px;
            margin-top: 15px;
        }
        
        .mastery-expert { color: var(--witness-gold); border-color: var(--witness-gold); box-shadow: 0 0 20px rgba(245, 158, 11, 0.5); }
        .mastery-confirmed { color: var(--defender-green); border-color: var(--defender-green); }
        .mastery-training { color: var(--passive-gray); border-color: var(--passive-gray); }
        
        @media (max-width: 600px) {
            .glitch-title { font-size: 1.5rem; }
            .progress-node { width: 45px; height: 45px; font-size: 1rem; }
            .panel-body { padding: 15px; }
            .flashcard-face { padding: 20px 15px; min-height: 280px; }
        }
    </style>
</head>
<body>
    <div class="witness-bg"></div>
    <div class="eye-overlay"></div>
    
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
        const { useState } = React;
        const e = React.createElement;

        const MODULE_ID = "GROUPE_02";
        const MODULE_VERSION = "1.0";
        const MODULE_TITLE = "Le Pouvoir des T√©moins";
        const PREREQUISITE_MODULE = "GROUPE_01";
        
        // Flashcards based on research: Salmivalli taxonomy + Darley-Latan√© 5 steps
        const flashcardsData = [
            {
                step: "DONN√âE CL√â",
                question: "Quel pourcentage des incidents de harc√®lement se produit devant des t√©moins ?",
                hint: "[ Cliquez pour la r√©ponse ]",
                answer: "<span class='data'>85%</span> des situations de harc√®lement se produisent en pr√©sence de pairs. C'est un ph√©nom√®ne <strong>public</strong>, pas priv√©. Cela signifie que les t√©moins ont une occasion d'agir dans presque tous les cas. Le harc√®lement a besoin d'un public."
            },
            {
                step: "TAXONOMIE",
                question: "Quels sont les 5 r√¥les dans une situation de harc√®lement ? (Salmivalli)",
                hint: "[ Cliquez pour la classification ]",
                answer: "<strong>1) Agresseur</strong> : initie l'agression. <strong>2) Assistant</strong> : participe activement. <strong>3) Renforceur</strong> : encourage (rires, attention). <strong>4) Spectateur passif</strong> : observe sans agir. <strong>5) D√©fenseur</strong> : intervient pour la cible. Les assistants et renforceurs = extension de l'agresseur."
            },
            {
                step: "√âTAPE 1/5",
                question: "√âtape 1 : PERCEVOIR - Reconna√Ætre qu'il se passe quelque chose",
                hint: "[ Cliquez pour comprendre ]",
                answer: "Premi√®re barri√®re : <strong>distinguer le harc√®lement d'une simple taquinerie</strong>. Indices : r√©p√©tition, d√©s√©quilibre de pouvoir, souffrance visible de la cible, plaisir visible de l'agresseur. Si tu ne VOIS pas le probl√®me, tu ne peux pas agir."
            },
            {
                step: "√âTAPE 2/5",
                question: "√âtape 2 : INTERPR√âTER - Comprendre que c'est une urgence",
                hint: "[ Cliquez pour comprendre ]",
                answer: "Deuxi√®me barri√®re : <strong>comprendre que la situation n√©cessite une aide</strong>. Pi√®ge : minimiser ('c'est pas grave', 'il/elle exag√®re'). Le t√©moin doit reconna√Ætre que m√™me les 'petites' agressions r√©p√©t√©es cr√©ent une souffrance r√©elle."
            },
            {
                step: "√âTAPE 3/5",
                question: "√âtape 3 : ACCEPTER LA RESPONSABILIT√â - 'C'est MON probl√®me'",
                hint: "[ Cliquez pour comprendre ]",
                answer: "Troisi√®me barri√®re : <strong>diffusion de responsabilit√©</strong>. Plus il y a de t√©moins, moins chacun se sent responsable ('quelqu'un d'autre va agir'). Solution : se d√©signer SOI-M√äME comme responsable. 'Si je n'agis pas, QUI va le faire ?'"
            },
            {
                step: "√âTAPE 4/5",
                question: "√âtape 4 : SAVOIR COMMENT AGIR - Avoir les outils",
                hint: "[ Cliquez pour comprendre ]",
                answer: "Quatri√®me barri√®re : <strong>ne pas savoir quoi faire</strong>. Options : intervention directe ('Stop'), distraction (changer de sujet), d√©l√©gation (chercher un adulte), soutien diff√©r√© (parler √† la cible apr√®s). Plusieurs strat√©gies = plus de chances d'agir."
            },
            {
                step: "√âTAPE 5/5",
                question: "√âtape 5 : AGIR - Passer √† l'action malgr√© la peur",
                hint: "[ Cliquez pour comprendre ]",
                answer: "Derni√®re barri√®re : <strong>la peur</strong> (devenir cible, perdre son statut social). Donn√©es rassurantes : quand un t√©moin intervient, le harc√®lement s'arr√™te dans <span class='data'>57% des cas en moins de 10 secondes</span>. L'action a un impact MASSIF."
            },
            {
                step: "EFFICACIT√â",
                question: "Quelle est l'efficacit√© prouv√©e des programmes ciblant les t√©moins ?",
                hint: "[ Cliquez pour les donn√©es ]",
                answer: "M√©ta-analyse (Niveau 1) : taille d'effet <span class='data'>g = 0,43</span> chez les coll√©giens. C'est significatif ! L'adolescence est la <strong>fen√™tre d'opportunit√© id√©ale</strong> pour ces interventions car la maturit√© cognitive permet de naviguer les pressions sociales complexes."
            }
        ];

        // Quiz based on 5 steps and witness types
        const quizData = [
            {
                question: "Samir voit un groupe se moquer de L√©a tous les jours. Il pense : 'Ce n'est pas mon probl√®me, quelqu'un d'autre va s'en occuper.' Quelle √©tape bloque son passage √† l'action ?",
                options: [
                    "√âtape 1 : Il ne per√ßoit pas l'incident",
                    "√âtape 2 : Il ne l'interpr√®te pas comme urgent",
                    "√âtape 3 : Il n'accepte pas la responsabilit√© (diffusion)",
                    "√âtape 4 : Il ne sait pas comment agir"
                ],
                correct: 2,
                feedback: "C'est la DIFFUSION DE RESPONSABILIT√â (√©tape 3). Samir per√ßoit et interpr√®te correctement, mais il se d√©responsabilise. Plus il y a de t√©moins, plus ce pi√®ge est fort. Solution : se rappeler que SI JE n'agis pas, peut-√™tre que personne ne le fera."
            },
            {
                question: "Dans la taxonomie de Salmivalli, quel r√¥le joue quelqu'un qui rit aux moqueries sans participer directement ?",
                options: [
                    "Spectateur passif",
                    "Renforceur",
                    "Assistant",
                    "D√©fenseur silencieux"
                ],
                correct: 1,
                feedback: "C'est un RENFORCEUR. Il ne participe pas directement mais son rire apporte une 'r√©compense sociale' √† l'agresseur. Les renforceurs sont consid√©r√©s comme une EXTENSION de l'agresseur car ils alimentent la dynamique. Le rire n'est jamais neutre."
            },
            {
                question: "Pourquoi l'adolescence (11-15 ans) est-elle la 'fen√™tre d'opportunit√© id√©ale' pour former les t√©moins ?",
                options: [
                    "Parce que les ados sont plus impressionnables",
                    "Parce que la maturit√© cognitive permet de g√©rer les pressions sociales complexes",
                    "Parce que les adultes ne les √©coutent pas",
                    "Parce que le harc√®lement n'existe qu'√† cet √¢ge"
                ],
                correct: 1,
                feedback: "La recherche montre une taille d'effet plus importante chez les coll√©giens (g=0,43) que chez les primaires. Le cortex pr√©frontal, en plein d√©veloppement, permet aux ados de mieux comprendre les dynamiques de groupe et de prendre des d√©cisions morales complexes."
            },
            {
                question: "Emma veut aider son ami harcel√© mais elle a peur de devenir cible elle-m√™me. Quelle strat√©gie minimise ce risque ?",
                options: [
                    "Confronter directement l'agresseur devant tout le monde",
                    "Ne rien faire pour se prot√©ger",
                    "Soutien diff√©r√© : parler √† la cible apr√®s, en priv√©, et signaler √† un adulte",
                    "Rejoindre le groupe pour ne pas √™tre vis√©e"
                ],
                correct: 2,
                feedback: "Le soutien diff√©r√© est une strat√©gie de d√©fense √† faible risque. Parler √† la cible apr√®s lui montre qu'elle n'est pas seule. Signaler √† un adulte active le syst√®me de protection sans s'exposer. Plusieurs strat√©gies existent selon le contexte et le niveau de risque per√ßu."
            },
            {
                question: "Selon les donn√©es, quand un t√©moin intervient, dans quel pourcentage des cas le harc√®lement s'arr√™te-t-il rapidement ?",
                options: [
                    "Environ 20% des cas",
                    "Environ 35% des cas",
                    "Environ 57% des cas",
                    "Environ 90% des cas"
                ],
                correct: 2,
                feedback: "57% d'arr√™t en moins de 10 secondes ! L'intervention d'UN SEUL t√©moin a un impact MASSIF. L'agresseur perd sa 'r√©compense sociale' quand quelqu'un d√©sapprouve. Cette donn√©e doit rassurer : agir n'est pas vain, c'est extr√™mement efficace."
            }
        ];

        // Scenarios applying the 5 steps
        const scenarioData = [
            {
                title: "Le Blocage de l'√âtape 3",
                context: "Cours de sport. Tout le monde voit que Julien est syst√©matiquement exclu des √©quipes et moqu√©.",
                intro: "Tu observes la sc√®ne. Autour de toi, 15 autres √©l√®ves voient la m√™me chose. Personne ne r√©agit. Tu te dis : 'Quelqu'un va bien faire quelque chose...'",
                fiveSteps: [
                    { num: 1, text: "PERCEVOIR : ‚úì Tu vois ce qui se passe", active: true },
                    { num: 2, text: "INTERPR√âTER : ‚úì Tu sais que c'est du harc√®lement", active: true },
                    { num: 3, text: "ACCEPTER : ‚ö†Ô∏è Tu attends que quelqu'un d'autre agisse", blocked: true },
                    { num: 4, text: "SAVOIR : ? Tu ne sais pas encore", active: false },
                    { num: 5, text: "AGIR : ? Pas encore", active: false }
                ],
                choices: [
                    { text: "Tu continues d'attendre. Avec 15 t√©moins, quelqu'un va forc√©ment r√©agir.", result: "C'est le pi√®ge classique de la diffusion de responsabilit√©. Les 15 autres pensent EXACTEMENT la m√™me chose. R√©sultat : personne n'agit. Plus il y a de t√©moins, plus ce pi√®ge est fort.", impact: { efficacite: -20, courage: -15 } },
                    { text: "Tu te dis : 'Si je n'agis pas, qui le fera ?' et tu passes √† l'√©tape 4.", result: "Tu brises le cycle de la diffusion ! En te d√©signant TOI-M√äME comme responsable, tu d√©passes le blocage. Maintenant tu dois d√©cider COMMENT agir. C'est le moment de choisir ta strat√©gie.", impact: { efficacite: +25, courage: +20 } },
                    { text: "Tu interpelles directement un autre t√©moin : 'Toi, va chercher le prof.'", result: "Strat√©gie avanc√©e ! Tu brises la diffusion ET tu actives un autre t√©moin. En d√©signant quelqu'un de pr√©cis ('TOI'), tu emp√™ches qu'il se d√©responsabilise aussi. Double impact.", impact: { efficacite: +30, courage: +25 } },
                    { text: "Tu postes sur le groupe classe : 'Quelqu'un devrait faire quelque chose pour Julien'.", result: "Message vague qui renforce la diffusion plut√¥t que de la briser. 'Quelqu'un' = personne en particulier. Si tu veux agir en ligne, sois pr√©cis ou agis directement.", impact: { efficacite: -5, courage: +5 } }
                ]
            },
            {
                title: "Choisir sa Strat√©gie (√âtape 4)",
                context: "Tu as d√©cid√© d'agir. Maintenant : COMMENT ? La situation : moqueries en classe, agresseur populaire.",
                intro: "Tu as franchi les √©tapes 1-2-3. Tu es face au choix de la STRAT√âGIE. L'agresseur est plus populaire que toi, ce qui rend l'intervention directe risqu√©e...",
                fiveSteps: [
                    { num: 1, text: "PERCEVOIR : ‚úì Fait", active: true },
                    { num: 2, text: "INTERPR√âTER : ‚úì Fait", active: true },
                    { num: 3, text: "ACCEPTER : ‚úì Tu as pris la responsabilit√©", active: true },
                    { num: 4, text: "SAVOIR : ‚ö†Ô∏è Tu dois choisir comment agir", blocked: true },
                    { num: 5, text: "AGIR : ? D√©pend de ton choix", active: false }
                ],
                choices: [
                    { text: "INTERVENTION DIRECTE : Tu dis fort 'Arr√™te, c'est pas dr√¥le.'", result: "Courageux et potentiellement tr√®s efficace. Tu d√©finis une norme sociale ('ce n'est pas acceptable'). Risque : escalade possible, mais les donn√©es montrent 57% d'arr√™t imm√©diat quand un t√©moin intervient.", impact: { efficacite: +25, courage: +30 } },
                    { text: "DISTRACTION : Tu changes de sujet bruyamment ou fais diversion.", result: "Strat√©gie √† risque mod√©r√©. Tu interromps la dynamique sans confrontation directe. L'agresseur perd son 'moment' et sa r√©compense sociale est diminu√©e. Efficace pour d√©samorcer.", impact: { efficacite: +20, courage: +15 } },
                    { text: "D√âL√âGATION : Tu vas discr√®tement chercher un adulte.", result: "Strat√©gie √† faible risque personnel. Tu actives le syst√®me de protection officiel. Important : le faire RAPIDEMENT et SYST√âMATIQUEMENT. Un signalement ponctuel peut √™tre ignor√© ; des signalements r√©p√©t√©s cr√©ent une trace.", impact: { efficacite: +20, courage: +10 } },
                    { text: "SOUTIEN DIFF√âR√â : Tu parles √† la cible apr√®s, en priv√©.", result: "Strat√©gie minimale mais pr√©cieuse. La cible sait qu'elle n'est pas seule. Tu peux ensuite l'accompagner pour signaler. Ne remplace pas l'action imm√©diate, mais compl√®te d'autres strat√©gies.", impact: { efficacite: +15, courage: +10 } }
                ]
            },
            {
                title: "Le Cas du Renforceur Inconscient",
                context: "Tu r√©alises que tu as ri aux blagues sur Karim. Tu n'es pas l'agresseur, mais...",
                intro: "En repensant aux situations pass√©es, tu comprends que ton rire faisait partie du probl√®me. Tu √©tais un RENFORCEUR dans la taxonomie de Salmivalli. Que fais-tu de cette prise de conscience ?",
                fiveSteps: null,
                choices: [
                    { text: "Tu minimises : 'C'√©tait juste des blagues, tout le monde riait.'", result: "C'est du D√âSENGAGEMENT MORAL (√©tiquetage euph√©misant + diffusion). Tu utilises les m√™mes m√©canismes qui permettent √† la violence de continuer. La prise de conscience ne sert √† rien si elle ne change pas le comportement.", impact: { efficacite: -20, empathie: -25 } },
                    { text: "Tu d√©cides de ne plus rire aux prochaines moqueries.", result: "Premier pas important. Retirer ton rire = retirer une partie de la r√©compense sociale de l'agresseur. C'est passer de RENFORCEUR √† SPECTATEUR PASSIF. Mieux, mais pas encore D√âFENSEUR.", impact: { efficacite: +15, empathie: +15 } },
                    { text: "Tu vas voir Karim pour t'excuser et lui demander comment il va.", result: "Tu reconnais l'impact de ton comportement ET tu apportes du soutien. Cela r√©pare (un peu) le mal fait et montre √† Karim qu'il n'est pas seul. C'est un acte de d√©fenseur r√©trospectif.", impact: { efficacite: +25, empathie: +30 } },
                    { text: "Tu d√©cides qu'√† la prochaine occasion, tu interviendras activement.", result: "Tu transformes ta culpabilit√© en engagement. Passer de RENFORCEUR √† D√âFENSEUR est le changement le plus puissant dans la dynamique de groupe. Un renforceur qui change de camp affaiblit consid√©rablement l'agresseur.", impact: { efficacite: +30, empathie: +20 } }
                ]
            }
        ];

        function encodeSaveCode(data) { return btoa(JSON.stringify(data)); }
        function decodeSaveCode(code) { try { return JSON.parse(atob(code)); } catch { return null; } }
        function getMasteryLevel(score) {
            if (score >= 420) return { level: "D√©fenseur Expert", class: "mastery-expert" };
            if (score >= 260) return { level: "D√©fenseur Confirm√©", class: "mastery-confirmed" };
            return { level: "En formation", class: "mastery-training" };
        }

        function App() {
            const [gameState, setGameState] = useState("unlock");
            const [playerData, setPlayerData] = useState({ name: "", class: "", level: 1, score: 0, xp: 0, quizScore: 0, scenarioScore: 0, flashcardsViewed: 0, finished: false });
            const [unlockCode, setUnlockCode] = useState("");
            const [unlockError, setUnlockError] = useState("");
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            function verifyUnlockCode() {
                const decoded = decodeSaveCode(unlockCode);
                if (!decoded) { setUnlockError("Code invalide."); return; }
                if (decoded.m !== PREREQUISITE_MODULE) { setUnlockError(`Code du module ${decoded.m}. Il te faut celui de ${PREREQUISITE_MODULE}.`); return; }
                if (!decoded.f) { setUnlockError("Module pr√©c√©dent non termin√©."); return; }
                setPlayerData(prev => ({ ...prev, name: decoded.n || "", class: decoded.c || "" }));
                setGameState("intro");
            }

            function startGame() { setGameState("flashcards"); }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({ ...prev, flashcardsViewed: Math.max(prev.flashcardsViewed, currentFlashcard + 2), xp: prev.xp + 15 }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({ ...prev, level: 2, flashcardsViewed: flashcardsData.length, xp: prev.xp + 60 }));
                }
            }

            function prevFlashcard() { if (currentFlashcard > 0) { setCurrentFlashcard(prev => prev - 1); setFlashcardFlipped(false); } }

            function selectQuizAnswer(index) { if (!showQuizFeedback) setSelectedAnswer(index); }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                if (selectedAnswer === quizData[currentQuiz].correct) {
                    setPlayerData(prev => ({ ...prev, score: prev.score + 35, quizScore: prev.quizScore + 35, xp: prev.xp + 35 }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({ ...prev, level: 3, xp: prev.xp + 70 }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                const choice = scenarioData[currentScenario].choices[index];
                const values = Object.values(choice.impact);
                const totalChange = Math.max(0, values.reduce((a, b) => a + b, 0));
                setPlayerData(prev => ({ ...prev, score: prev.score + totalChange, scenarioScore: prev.scenarioScore + totalChange, xp: prev.xp + 30 }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    setPlayerData(prev => ({ ...prev, finished: true, xp: prev.xp + 100 }));
                    setGameState("complete");
                }
            }

            function generateSaveCode() {
                return encodeSaveCode({
                    v: 1, d: new Date().toISOString(), m: MODULE_ID, mv: MODULE_VERSION,
                    n: playerData.name, c: playerData.class, l: 3, s: playerData.score,
                    x: playerData.xp, q: playerData.quizScore, sc: playerData.scenarioScore, f: true
                });
            }

            function copyCode() { navigator.clipboard.writeText(generateSaveCode()).then(() => alert("Code copi√© !")); }

            function renderUnlock() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "üëÅÔ∏è"),
                        e("h1", { className: "glitch-title" }, "PIX-pHARe"),
                        e("div", { className: "subtitle" }, "Pilier Dynamiques de Groupe"),
                        e("div", { className: "module-badge" }, "MODULE 02 - VERROUILL√â")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üîê"),
                            e("div", { className: "panel-title" }, "Acc√®s Prot√©g√©")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "unlock-screen" },
                                e("div", { className: "lock-icon" }, "üëÅÔ∏è"),
                                e("h2", { className: "unlock-title" }, MODULE_TITLE),
                                e("p", { style: { color: "var(--text-secondary)", marginBottom: "20px" } }, "Ce module n√©cessite d'avoir compl√©t√© le Module 01 (Le Triangle Infernal)."),
                                e("input", { type: "text", className: "code-input", value: unlockCode, onChange: ev => setUnlockCode(ev.target.value), placeholder: "Code du Module 01..." }),
                                unlockError && e("div", { className: "error-msg" }, unlockError),
                                e("div", { style: { marginTop: "25px" } },
                                    e("button", { className: "action-btn", onClick: verifyUnlockCode, disabled: !unlockCode.trim() }, "[ D√âVERROUILLER ]")
                                )
                            )
                        )
                    )
                );
            }

            function renderIntro() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "üëÅÔ∏è"),
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Module 02"),
                        e("div", { className: "module-badge" }, "LE POUVOIR DES T√âMOINS")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "‚ö°"),
                            e("div", { className: "panel-title" }, "Tu as plus de pouvoir que tu ne crois")
                        ),
                        e("div", { className: "panel-body" },
                            e("p", { style: { fontSize: "1.1rem", marginBottom: "20px" } }, 
                                "Bienvenue ", e("strong", null, playerData.name), ". Tu connais maintenant le triangle. Place aux DONN√âES."
                            ),
                            e("div", { style: { textAlign: "center", margin: "25px 0" } },
                                e("span", { className: "data-highlight" }, "85% des incidents ont des t√©moins"),
                                e("span", { className: "data-highlight" }, "57% s'arr√™tent si quelqu'un intervient")
                            ),
                            e("p", { style: { marginBottom: "20px" } }, 
                                "Les t√©moins ont un ", e("strong", { style: { color: "var(--defender-green)" } }, "pouvoir massif"), 
                                ". Mais 5 barri√®res les emp√™chent d'agir. Ce module va t'apprendre √† les franchir."
                            ),
                            e("div", { className: "role-spectrum" },
                                e("span", { className: "role-tag role-aggressor" }, "Agresseur"),
                                e("span", { className: "role-tag role-assistant" }, "Assistant"),
                                e("span", { className: "role-tag role-reinforcer" }, "Renforceur"),
                                e("span", { className: "role-tag role-passive" }, "Passif"),
                                e("span", { className: "role-tag role-defender" }, "D√©fenseur")
                            ),
                            e("p", { style: { textAlign: "center", color: "var(--text-secondary)", marginTop: "20px" } }, 
                                "Objectif : passer de Passif √† ", e("strong", { style: { color: "var(--defender-green)" } }, "D√©fenseur"), "."
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "30px" } },
                                e("button", { className: "action-btn", onClick: startGame }, "[ COMMENCER ]")
                            )
                        )
                    )
                );
            }

            function renderFlashcards() {
                const card = flashcardsData[currentFlashcard];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 1 : Les 5 √âtapes")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node active" }, "1"),
                        e("div", { className: "progress-node" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "√âtape"), e("div", { className: "xp-value" }, `${currentFlashcard + 1}/${flashcardsData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üìä"),
                            e("div", { className: "panel-title" }, "Donn√©es & Strat√©gies")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "flashcard-container" },
                                e("div", { className: `flashcard ${flashcardFlipped ? "flipped" : ""}`, onClick: () => setFlashcardFlipped(!flashcardFlipped) },
                                    e("div", { className: "flashcard-face flashcard-front" },
                                        e("div", { className: "flashcard-step" }, card.step),
                                        e("div", { className: "flashcard-question" }, card.question),
                                        e("div", { className: "flashcard-hint" }, card.hint)
                                    ),
                                    e("div", { className: "flashcard-face flashcard-back" },
                                        e("div", { className: "flashcard-step", style: { background: "var(--defender-green)" } }, "ACQUIS"),
                                        e("div", { className: "flashcard-answer", dangerouslySetInnerHTML: { __html: card.answer } })
                                    )
                                )
                            ),
                            e("div", { className: "flashcard-nav" },
                                e("button", { className: "nav-btn", onClick: prevFlashcard, disabled: currentFlashcard === 0 }, "‚óÑ PR√âC"),
                                e("button", { className: "nav-btn", onClick: nextFlashcard }, currentFlashcard < flashcardsData.length - 1 ? "SUIV ‚ñ∫" : "NIVEAU 2 ‚ñ∫")
                            )
                        )
                    )
                );
            }

            function renderQuiz() {
                const question = quizData[currentQuiz];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 2 : Diagnostic")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "‚úì"),
                        e("div", { className: "progress-node active" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.quizScore)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Question"), e("div", { className: "xp-value" }, `${currentQuiz + 1}/${quizData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üî¨"),
                            e("div", { className: "panel-title" }, "Identifier les Blocages")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "quiz-question" }, question.question),
                            e("div", { className: "quiz-options" },
                                question.options.map((opt, idx) => {
                                    let optClass = "quiz-option";
                                    if (showQuizFeedback) {
                                        if (idx === question.correct) optClass += " correct";
                                        else if (idx === selectedAnswer) optClass += " incorrect";
                                    } else if (idx === selectedAnswer) optClass += " selected";
                                    return e("div", { key: idx, className: optClass, onClick: () => selectQuizAnswer(idx) },
                                        e("div", { className: "option-marker" }, String.fromCharCode(65 + idx)),
                                        e("div", { className: "option-text" }, opt)
                                    );
                                })
                            ),
                            showQuizFeedback && e("div", { className: `feedback-box ${selectedAnswer !== question.correct ? "incorrect-feedback" : ""}` },
                                e("div", { className: "feedback-title" }, selectedAnswer === question.correct ? "‚úì DIAGNOSTIC CORRECT" : "‚úó √Ä REVOIR"),
                                e("p", null, question.feedback)
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                !showQuizFeedback ?
                                    e("button", { className: "action-btn", onClick: validateQuizAnswer, disabled: selectedAnswer === null }, "[ VALIDER ]") :
                                    e("button", { className: "action-btn", onClick: nextQuizQuestion }, currentQuiz < quizData.length - 1 ? "[ SUIVANT ]" : "[ NIVEAU 3 ]")
                            )
                        )
                    )
                );
            }

            function renderScenarios() {
                const scenario = scenarioData[currentScenario];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 3 : Action")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "‚úì"),
                        e("div", { className: "progress-node completed" }, "‚úì"),
                        e("div", { className: "progress-node active" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP Total"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.score)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Sc√©nario"), e("div", { className: "xp-value" }, `${currentScenario + 1}/${scenarioData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üéØ"),
                            e("div", { className: "panel-title" }, scenario.title)
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "scenario-context" }, scenario.context),
                            e("div", { className: "scenario-intro" }, scenario.intro),
                            scenario.fiveSteps && e("div", { className: "five-steps-box" },
                                e("p", { style: { fontFamily: "'Share Tech Mono', monospace", marginBottom: "15px", color: "var(--witness-gold)" } }, "üìä Les 5 √©tapes de Darley-Latan√© :"),
                                scenario.fiveSteps.map((step, i) => 
                                    e("div", { key: i, className: `step-item ${step.active ? "active" : ""} ${step.blocked ? "blocked" : ""}` },
                                        e("div", { className: "step-number" }, step.num),
                                        e("span", null, step.text)
                                    )
                                )
                            ),
                            !showScenarioResult ?
                                e("div", null, scenario.choices.map((choice, idx) =>
                                    e("button", { key: idx, className: "choice-btn", onClick: () => makeScenarioChoice(idx) }, choice.text)
                                )) :
                                e("div", { className: "choice-result" },
                                    e("p", { style: { marginBottom: "15px", lineHeight: "1.7" } }, scenario.choices[scenarioChoice].result),
                                    e("div", { className: "impact-score" },
                                        Object.entries(scenario.choices[scenarioChoice].impact).map(([key, val]) =>
                                            e("div", { key: key, className: `impact-item ${val > 0 ? "positive" : "negative"}` }, `${key}: ${val > 0 ? "+" : ""}${val}`)
                                        )
                                    ),
                                    e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                        e("button", { className: "action-btn", onClick: nextScenario }, currentScenario < scenarioData.length - 1 ? "[ SUIVANT ]" : "[ TERMINER ]")
                                    )
                                )
                        )
                    )
                );
            }

            function renderComplete() {
                const mastery = getMasteryLevel(playerData.score);
                const saveCode = generateSaveCode();
                return e("div", { className: "app-container" },
                    e("div", { className: "completion-screen" },
                        e("div", { className: "completion-icon" }, "üëÅÔ∏è"),
                        e("h1", { className: "completion-title" }, "T√âMOIN √âVEILL√â"),
                        e("p", { style: { fontSize: "1.2rem", color: "var(--text-secondary)", marginBottom: "15px" } }, `Bravo ${playerData.name} ! Tu connais maintenant le pouvoir des t√©moins.`),
                        e("div", { className: `mastery-badge ${mastery.class}` }, mastery.level),
                        e("div", { className: "stats-grid" },
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.score), e("div", { className: "stat-label" }, "Score Total")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.xp), e("div", { className: "stat-label" }, "XP Gagn√©s")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.quizScore), e("div", { className: "stat-label" }, "Diagnostic")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.scenarioScore), e("div", { className: "stat-label" }, "Action"))
                        ),
                        e("div", { className: "save-code-box" },
                            e("div", { className: "save-code-label" }, "üìã TON CODE (pour le Module 03) :"),
                            e("div", { className: "save-code" }, saveCode),
                            e("button", { className: "copy-btn", onClick: copyCode }, "Copier le code")
                        ),
                        e("div", { className: "content-panel", style: { marginTop: "30px", textAlign: "left" } },
                            e("div", { className: "panel-header" },
                                e("div", { className: "panel-icon" }, "üéì"),
                                e("div", { className: "panel-title" }, "Comp√©tences acquises")
                            ),
                            e("div", { className: "panel-body" },
                                e("p", null, "Tu connais maintenant les ", e("strong", { style: { color: "var(--witness-gold)" } }, "5 r√¥les de Salmivalli"), " et les ", e("strong", null, "5 √©tapes de Darley-Latan√©"), "."),
                                e("p", { style: { marginTop: "15px" } }, "Tu sais identifier les blocages (diffusion de responsabilit√©, peur) et choisir des strat√©gies adapt√©es."),
                                e("p", { style: { marginTop: "15px" } }, "Dans le Module 03, tu d√©couvriras les ", e("strong", { style: { color: "var(--defender-green)" } }, "8 m√©canismes de d√©sengagement moral"), " de Bandura - les phrases qui permettent de justifier la violence.")
                            )
                        )
                    )
                );
            }

            switch (gameState) {
                case "unlock": return renderUnlock();
                case "intro": return renderIntro();
                case "flashcards": return renderFlashcards();
                case "quiz": return renderQuiz();
                case "scenarios": return renderScenarios();
                case "complete": return renderComplete();
                default: return renderUnlock();
            }
        }

        ReactDOM.createRoot(document.getElementById("root")).render(e(App));
    </script>
</body>
</html>
