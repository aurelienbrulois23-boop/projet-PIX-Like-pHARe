<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module NUMÉRIQUE 03 - Bulles & Miroirs</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --mirror-blue: #4a9eff;
            --mirror-purple: #a855f7;
            --bubble-pink: #ec4899;
            --reflect-white: #f0f4ff;
            --void-black: #0a0a1a;
            --deep-void: #050510;
            --panel-bg: rgba(10, 10, 26, 0.95);
            --text-primary: #e8e8ff;
            --text-secondary: #8888bb;
            --glow-blue: 0 0 30px rgba(74, 158, 255, 0.4);
            --glow-purple: 0 0 30px rgba(168, 85, 247, 0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-black);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Bubble background effect */
        .bubble-field {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }
        
        .bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(74, 158, 255, 0.15), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(74, 158, 255, 0.2);
            animation: floatBubble 20s ease-in-out infinite;
        }
        
        @keyframes floatBubble {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.3; }
            50% { transform: translateY(-30px) scale(1.1); opacity: 0.5; }
        }
        
        /* Mirror reflection effect */
        .mirror-plane {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                transparent 0%,
                rgba(74, 158, 255, 0.03) 25%,
                transparent 50%,
                rgba(168, 85, 247, 0.03) 75%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 0;
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }
        
        .header-reflection {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, rgba(74, 158, 255, 0.1), transparent);
            transform: scaleY(-1);
            opacity: 0.3;
            pointer-events: none;
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple), var(--bubble-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(74, 158, 255, 0.5));
            letter-spacing: 3px;
            animation: shimmerText 3s ease-in-out infinite;
        }
        
        @keyframes shimmerText {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(74, 158, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(168, 85, 247, 0.7)); }
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--mirror-purple);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 30px;
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.2), rgba(168, 85, 247, 0.2));
            border: 1px solid var(--mirror-blue);
            border-radius: 30px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--mirror-blue);
            position: relative;
            overflow: hidden;
        }
        
        .module-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 40%,
                rgba(255, 255, 255, 0.1) 50%,
                transparent 60%
            );
            animation: mirrorShine 4s linear infinite;
        }
        
        @keyframes mirrorShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        /* Progress indicator */
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 55px;
            height: 55px;
            border: 2px solid var(--text-secondary);
            background: var(--deep-void);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.4s ease;
            position: relative;
        }
        
        .progress-node::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 50%;
            border: 1px dashed transparent;
            transition: all 0.4s ease;
        }
        
        .progress-node.active {
            border-color: var(--mirror-blue);
            color: var(--mirror-blue);
            box-shadow: var(--glow-blue);
        }
        
        .progress-node.active::after {
            border-color: var(--mirror-purple);
            animation: spinDashed 10s linear infinite;
        }
        
        @keyframes spinDashed {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-node.completed {
            border-color: var(--bubble-pink);
            background: rgba(236, 72, 153, 0.2);
            color: var(--bubble-pink);
        }
        
        /* XP Display */
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 1px solid rgba(74, 158, 255, 0.3);
            padding: 15px 25px;
            text-align: center;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .xp-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--mirror-blue), var(--mirror-purple));
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Content panels */
        .content-panel {
            background: var(--panel-bg);
            border: 1px solid rgba(74, 158, 255, 0.2);
            border-radius: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--mirror-blue), var(--mirror-purple), var(--bubble-pink));
            border-radius: 20px 20px 0 0;
        }
        
        .panel-header {
            background: rgba(74, 158, 255, 0.1);
            padding: 18px 25px;
            border-bottom: 1px solid rgba(74, 158, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
            box-shadow: var(--glow-blue);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--mirror-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .panel-body {
            padding: 25px;
        }
        
        /* Unlock screen */
        .unlock-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .lock-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 20px rgba(74, 158, 255, 0.5));
        }
        
        .unlock-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--mirror-blue);
            margin-bottom: 15px;
        }
        
        .code-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            background: var(--deep-void);
            border: 2px solid var(--mirror-purple);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            margin: 20px auto;
            display: block;
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--mirror-blue);
            box-shadow: var(--glow-blue);
        }
        
        .error-msg {
            color: var(--bubble-pink);
            font-family: 'Share Tech Mono', monospace;
            margin-top: 15px;
            padding: 10px;
            border: 1px solid var(--bubble-pink);
            border-radius: 10px;
            background: rgba(236, 72, 153, 0.1);
        }
        
        /* Flashcards */
        .flashcard-container {
            perspective: 1200px;
            margin-bottom: 20px;
        }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 220px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .flashcard-face {
            position: absolute;
            width: 100%;
            min-height: 220px;
            backface-visibility: hidden;
            border: 2px solid var(--mirror-blue);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 25px;
            background: var(--deep-void);
        }
        
        .flashcard-front {
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1), rgba(168, 85, 247, 0.1));
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(74, 158, 255, 0.1));
            border-color: var(--bubble-pink);
        }
        
        .flashcard-category {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple));
            color: white;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 20px;
        }
        
        .flashcard-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--mirror-blue);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .flashcard-hint {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--mirror-purple);
            text-align: center;
        }
        
        .flashcard-answer {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
        }
        
        .flashcard-answer strong {
            color: var(--bubble-pink);
        }
        
        .flashcard-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: transparent;
            border: 2px solid var(--mirror-purple);
            color: var(--mirror-purple);
            padding: 12px 30px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 25px;
        }
        
        .nav-btn:hover {
            background: rgba(168, 85, 247, 0.2);
            box-shadow: var(--glow-purple);
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        /* Quiz styles */
        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(74, 158, 255, 0.1), rgba(168, 85, 247, 0.1));
            border-left: 4px solid var(--mirror-blue);
            border-radius: 0 15px 15px 0;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .quiz-option {
            background: var(--deep-void);
            border: 1px solid var(--text-secondary);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-option:hover:not(.selected):not(.correct):not(.incorrect) {
            border-color: var(--mirror-blue);
            background: rgba(74, 158, 255, 0.1);
            transform: translateX(5px);
        }
        
        .quiz-option.selected {
            border-color: var(--mirror-purple);
            background: rgba(168, 85, 247, 0.2);
        }
        
        .quiz-option.correct {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }
        
        .quiz-option.incorrect {
            border-color: var(--bubble-pink);
            background: rgba(236, 72, 153, 0.2);
        }
        
        .option-marker {
            width: 35px;
            height: 35px;
            border: 2px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .option-text {
            flex: 1;
            font-size: 0.95rem;
        }
        
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-left: 4px solid #22c55e;
            border-radius: 0 15px 15px 0;
            background: rgba(34, 197, 94, 0.1);
        }
        
        .feedback-box.incorrect-feedback {
            border-color: var(--bubble-pink);
            background: rgba(236, 72, 153, 0.1);
        }
        
        .feedback-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 10px;
        }
        
        .feedback-box.incorrect-feedback .feedback-title {
            color: var(--bubble-pink);
        }
        
        /* Scenario styles */
        .scenario-intro {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(74, 158, 255, 0.1));
            border-radius: 15px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        
        .scenario-context {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--mirror-blue);
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(74, 158, 255, 0.1);
            border-radius: 10px;
            border: 1px dashed var(--mirror-blue);
        }
        
        .bubble-visual {
            margin: 20px 0;
            padding: 25px;
            background: radial-gradient(ellipse at center, rgba(74, 158, 255, 0.15), transparent 70%);
            border: 2px solid rgba(74, 158, 255, 0.3);
            border-radius: 50%;
            text-align: center;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .bubble-visual-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--mirror-purple);
        }
        
        .choice-btn {
            display: block;
            width: 100%;
            background: var(--deep-void);
            border: 1px solid var(--text-secondary);
            border-radius: 12px;
            padding: 18px 20px;
            margin-bottom: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }
        
        .choice-btn:hover {
            border-color: var(--mirror-blue);
            background: rgba(74, 158, 255, 0.1);
            transform: translateX(5px);
        }
        
        .choice-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--deep-void);
            border: 1px solid var(--bubble-pink);
            border-radius: 15px;
        }
        
        .impact-score {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .impact-item {
            padding: 8px 15px;
            background: rgba(74, 158, 255, 0.1);
            border: 1px solid var(--mirror-blue);
            border-radius: 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
        }
        
        .impact-item.positive {
            border-color: #22c55e;
            color: #22c55e;
        }
        
        .impact-item.negative {
            border-color: var(--bubble-pink);
            color: var(--bubble-pink);
        }
        
        /* Primary action button */
        .action-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple));
            color: white;
            border: none;
            padding: 15px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(74, 158, 255, 0.5);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Completion screen */
        .completion-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .completion-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: floatIcon 3s ease-in-out infinite;
        }
        
        @keyframes floatIcon {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        
        .completion-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--mirror-blue), var(--mirror-purple), var(--bubble-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .completion-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--panel-bg);
            border: 1px solid var(--mirror-blue);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--mirror-blue);
        }
        
        .stat-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .save-code-box {
            background: var(--deep-void);
            border: 2px solid var(--bubble-pink);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .save-code-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--bubble-pink);
            margin-bottom: 10px;
        }
        
        .save-code {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--mirror-purple);
            word-break: break-all;
            background: rgba(168, 85, 247, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--mirror-purple);
        }
        
        .copy-btn {
            margin-top: 15px;
            background: transparent;
            border: 1px solid var(--bubble-pink);
            color: var(--bubble-pink);
            padding: 10px 25px;
            font-family: 'Share Tech Mono', monospace;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: rgba(236, 72, 153, 0.2);
        }
        
        /* Mastery badge */
        .mastery-badge {
            display: inline-block;
            padding: 10px 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: 2px solid;
            border-radius: 25px;
            margin-top: 15px;
        }
        
        .mastery-expert {
            color: var(--bubble-pink);
            border-color: var(--bubble-pink);
            box-shadow: 0 0 20px rgba(236, 72, 153, 0.5);
        }
        
        .mastery-confirmed {
            color: var(--mirror-purple);
            border-color: var(--mirror-purple);
        }
        
        .mastery-training {
            color: var(--mirror-blue);
            border-color: var(--mirror-blue);
        }
        
        /* Mobile responsive */
        @media (max-width: 600px) {
            .glitch-title {
                font-size: 1.5rem;
                letter-spacing: 2px;
            }
            
            .progress-node {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .xp-display {
                gap: 12px;
            }
            
            .xp-box {
                padding: 10px 15px;
            }
            
            .panel-body {
                padding: 15px;
            }
            
            .flashcard-face {
                padding: 20px 15px;
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="mirror-plane"></div>
    <div class="bubble-field">
        <div class="bubble" style="width: 100px; height: 100px; top: 10%; left: 5%; animation-delay: 0s;"></div>
        <div class="bubble" style="width: 60px; height: 60px; top: 30%; left: 80%; animation-delay: -5s;"></div>
        <div class="bubble" style="width: 80px; height: 80px; top: 60%; left: 15%; animation-delay: -10s;"></div>
        <div class="bubble" style="width: 120px; height: 120px; top: 70%; left: 70%; animation-delay: -3s;"></div>
        <div class="bubble" style="width: 50px; height: 50px; top: 85%; left: 40%; animation-delay: -8s;"></div>
        <div class="bubble" style="width: 90px; height: 90px; top: 20%; left: 50%; animation-delay: -12s;"></div>
    </div>
    
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
        const { useState, useEffect } = React;
        const e = React.createElement;

        // Module data
        const MODULE_ID = "NUMERIQUE_03";
        const MODULE_VERSION = "1.0";
        const MODULE_TITLE = "Bulles & Miroirs";
        const PREREQUISITE_MODULE = "NUMERIQUE_02";
        
        // Flashcards data - Filter Bubbles & Echo Chambers
        const flashcardsData = [
            {
                category: "DÉFINITION",
                question: "Qu'est-ce qu'une 'bulle de filtre' (filter bubble) ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Univers informationnel personnalisé créé par les algorithmes. Chaque utilisateur voit un <strong>internet différent</strong> basé sur son historique, ses clics, sa localisation. Terme inventé par Eli Pariser en 2011. Tu ne vois pas 'internet' - tu vois TON internet."
            },
            {
                category: "MÉCANISME",
                question: "Comment l'algorithme construit-il ta bulle ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Il analyse : tes <strong>likes</strong>, tes <strong>temps de visionnage</strong>, tes <strong>partages</strong>, tes <strong>commentaires</strong>, tes <strong>recherches</strong>, ta <strong>localisation</strong>, ton <strong>âge</strong>, ton <strong>réseau social</strong>. Puis il prédit ce qui te gardera le plus longtemps et te montre UNIQUEMENT ça. Le reste disparaît."
            },
            {
                category: "EFFET",
                question: "Qu'est-ce qu'une 'chambre d'écho' ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Espace où tes opinions sont <strong>répétées et amplifiées</strong> par des gens qui pensent comme toi. Aucune contradiction, aucun débat. Tu crois que 'tout le monde' pense comme toi parce que l'algorithme t'a isolé avec tes semblables."
            },
            {
                category: "BIAIS",
                question: "Qu'est-ce que le biais de confirmation algorithmique ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Le biais de confirmation humain (chercher ce qui confirme nos croyances) est <strong>amplifié par l'algorithme</strong>. Si tu cliques sur un contenu, l'algo t'en montre 10 similaires. Ta croyance se renforce. Les preuves contraires disparaissent de ton feed."
            },
            {
                category: "POLARISATION",
                question: "Comment les bulles créent-elles la polarisation politique ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Chaque camp vit dans une <strong>réalité parallèle</strong>. Mêmes événements, interprétations opposées. L'algorithme maximise l'engagement via l'émotion (indignation, peur). Résultat : deux groupes qui ne peuvent plus se comprendre car ils n'ont pas les mêmes 'faits'."
            },
            {
                category: "INVISIBLE",
                question: "Pourquoi les bulles sont-elles si dangereuses ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "Elles sont <strong>invisibles</strong>. Tu ne sais pas ce que tu ne vois pas. Tu crois avoir 'fait tes recherches' alors que l'algo a pré-filtré les résultats. Tu penses être informé alors que tu es enfermé. C'est une prison sans barreaux."
            },
            {
                category: "RADICALISATION",
                question: "Comment YouTube peut-il radicaliser en quelques heures ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "L'autoplay + recommandations créent un <strong>tunnel de radicalisation</strong>. Vidéo soft → vidéo un peu plus extrême → encore plus extrême. Études montrent : 5-7 vidéos suffisent pour passer d'un sujet banal à du contenu complotiste ou extrémiste."
            },
            {
                category: "SOLUTION",
                question: "Comment 'éclater' sa bulle ?",
                hint: "[ Cliquez pour révéler ]",
                answer: "1) <strong>Diversifier ses sources</strong> volontairement. 2) Utiliser la <strong>navigation privée</strong> pour des recherches neutres. 3) <strong>S'abonner à des opinions opposées</strong>. 4) Utiliser des agrégateurs <strong>sans personnalisation</strong>. 5) <strong>Questionner</strong> pourquoi on voit ce contenu."
            }
        ];

        // Quiz data
        const quizData = [
            {
                question: "Deux amis font la même recherche Google 'vaccins'. Que verront-ils ?",
                options: [
                    "Exactement les mêmes résultats",
                    "Des résultats différents basés sur leur historique et profil",
                    "Les résultats les plus objectifs scientifiquement",
                    "Des résultats aléatoires"
                ],
                correct: 1,
                feedback: "Google personnalise les résultats selon ton historique, ta localisation, tes clics précédents, ton profil démographique. Un pro-vaccin verra des sources scientifiques, un sceptique verra des témoignages de 'victimes'. Chacun croit voir 'la vérité' alors qu'il voit SA vérité algorithmique."
            },
            {
                question: "Pourquoi les contenus émotionnels (indignation, peur, colère) sont-ils favorisés par les algorithmes ?",
                options: [
                    "Par hasard, c'est un bug",
                    "Parce qu'ils génèrent plus d'engagement (clics, commentaires, partages)",
                    "Parce que c'est ce que les utilisateurs demandent explicitement",
                    "Pour des raisons éducatives"
                ],
                correct: 1,
                feedback: "L'émotion = engagement = temps passé = revenus publicitaires. Les contenus modérés et nuancés génèrent moins de réactions. Un titre choquant fait cliquer. L'algorithme optimise pour le clic, pas pour la vérité ou le bien-être mental."
            },
            {
                question: "Le phénomène 'Flat Earth' (Terre plate) s'est propagé principalement via :",
                options: [
                    "Les manuels scolaires",
                    "Les journaux télévisés",
                    "Les recommandations YouTube et les groupes Facebook",
                    "Les conférences scientifiques"
                ],
                correct: 2,
                feedback: "Une étude de 2019 montre que la majorité des 'flat earthers' ont été convaincus via les recommandations YouTube. L'algorithme a créé un tunnel : curiosité → vidéo 'alternative' → communauté → conviction. Sans l'algo, cette théorie serait restée marginale."
            },
            {
                question: "Quel est le principal problème des 'fact-checkers' (vérificateurs de faits) face aux bulles ?",
                options: [
                    "Ils sont trop lents",
                    "Ils ne sont pas vus par ceux qui en auraient le plus besoin",
                    "Ils sont tous corrompus",
                    "Ils n'existent pas vraiment"
                ],
                correct: 1,
                feedback: "Paradoxe des fact-checkers : ils prêchent des convertis. Si tu es dans une bulle complotiste, tu ne vois jamais les vérifications. Et si tu les vois, tu les considères comme 'partie du complot'. La correction ne perce pas les bulles."
            },
            {
                question: "L'expression 'réalité fragmentée' désigne :",
                options: [
                    "Un problème de connexion internet",
                    "Le fait que chaque groupe social vit dans sa propre version des faits",
                    "Une technique de méditation",
                    "Un genre de jeu vidéo"
                ],
                correct: 1,
                feedback: "Nous ne partageons plus une réalité commune. Chaque tribu a ses 'faits', ses 'experts', ses 'preuves'. Le dialogue devient impossible car il n'y a plus de terrain commun. C'est un défi majeur pour la démocratie qui suppose des citoyens informés... des mêmes informations."
            }
        ];

        // Scenario data
        const scenarioData = [
            {
                title: "Le Feed Identique",
                context: "Tu discutes politique avec un ami. Vous n'êtes pas d'accord du tout.",
                intro: "Ton ami dit : 'C'est évident, tout le monde sait que...' et cite des 'faits' que tu n'as jamais vus. Tu lui montres ton feed : il ne contient aucune de ces informations. Il est choqué : 'Comment tu peux ne pas être au courant ?!' Vous réalisez que vos internets sont totalement différents.",
                choices: [
                    {
                        text: "Tu conclus que ton ami est manipulé par de la désinformation.",
                        result: "Réflexe humain mais dangereux. Tu fais exactement ce que la bulle veut : rejeter l'autre comme 'manipulé' plutôt que questionner ta propre bulle. Vous êtes TOUS LES DEUX dans des bulles.",
                        impact: { lucidite: -10, ouverture: -15 }
                    },
                    {
                        text: "Tu lui demandes ses sources et tu les consultes, même si ça te déplaît.",
                        result: "Excellente démarche. Sortir de sa bulle demande un effort VOLONTAIRE. Consulter des sources opposées ne signifie pas les approuver - mais comprendre comment l'autre construit sa vision du monde.",
                        impact: { lucidite: +25, ouverture: +20 }
                    },
                    {
                        text: "Vous décidez de faire une recherche ensemble en navigation privée.",
                        result: "Brillant ! La navigation privée élimine la personnalisation. Vous verrez des résultats 'neutres' (ou du moins non personnalisés). C'est une façon de trouver un terrain commun factuel.",
                        impact: { lucidite: +30, ouverture: +25 }
                    },
                    {
                        text: "Tu bloques ton ami car 'on ne peut pas discuter avec lui'.",
                        result: "Tu renforces ta propre bulle. En éliminant les voix discordantes, tu confirmes à l'algorithme que tu veux UNIQUEMENT des opinions similaires. Ta chambre d'écho devient plus hermétique.",
                        impact: { lucidite: -20, ouverture: -25 }
                    }
                ]
            },
            {
                title: "Le Tunnel de Recommandations",
                context: "Tu regardes une vidéo sur l'alimentation saine. L'autoplay est activé.",
                intro: "Vidéo 1 : conseils nutrition classiques. Vidéo 2 : 'Les secrets que les médecins cachent'. Vidéo 3 : 'Big Pharma contrôle ton alimentation'. Vidéo 4 : 'Ils nous empoisonnent volontairement'. Tu réalises que tu regardes depuis 2 heures et que le contenu est devenu de plus en plus extrême.",
                choices: [
                    {
                        text: "Tu continues par curiosité : 'Je veux voir jusqu'où ça va'.",
                        result: "Piège classique. Chaque minute de visionnage RENFORCE le signal à l'algorithme. Demain, tes recommandations seront encore plus extrêmes. Tu nourris le tunnel.",
                        impact: { lucidite: -15, ouverture: -10 }
                    },
                    {
                        text: "Tu fermes immédiatement et tu purges ton historique.",
                        result: "Bonne réaction d'urgence. Purger l'historique 'réinitialise' partiellement l'algorithme. Tu coupes le tunnel de radicalisation avant qu'il ne s'installe dans tes recommandations.",
                        impact: { lucidite: +20, ouverture: +10 }
                    },
                    {
                        text: "Tu cliques sur 'Ne pas recommander cette chaîne' pour chaque vidéo problématique.",
                        result: "Action efficace. Tu donnes un contre-signal explicite à l'algorithme. C'est comme entraîner un chien : tu lui dis ce que tu ne veux PAS. Mais ça demande de la vigilance constante.",
                        impact: { lucidite: +25, ouverture: +15 }
                    },
                    {
                        text: "Tu désactives l'autoplay et les recommandations personnalisées.",
                        result: "Solution radicale et durable. Sans autoplay, tu dois CHOISIR chaque vidéo. Sans personnalisation, tu vois le contenu 'populaire' plutôt que 'ciblé pour toi'. Tu reprends le contrôle.",
                        impact: { lucidite: +30, ouverture: +20 }
                    }
                ]
            },
            {
                title: "La Chambre d'Écho Sociale",
                context: "Tu postes une opinion sur un sujet controversé. Tu reçois 200 likes et des commentaires d'approbation.",
                intro: "Tous les commentaires sont positifs. 'Tellement vrai !', 'Enfin quelqu'un qui dit la vérité !', 'Je partage !' Tu te sens validé, intelligent, courageux. Puis tu remarques : aucun commentaire contradictoire. Zéro. Sur un sujet pourtant très débattu. Que comprends-tu ?",
                choices: [
                    {
                        text: "Tu conclues que ton opinion est objectivement juste puisque tout le monde approuve.",
                        result: "C'est exactement ce que la chambre d'écho veut que tu croies. 'Tout le monde' = les gens que l'algorithme t'a montrés. Les millions qui pensent différemment ont été filtrés. L'approbation unanime est un RED FLAG.",
                        impact: { lucidite: -20, ouverture: -15 }
                    },
                    {
                        text: "Tu te méfies : l'unanimité sur un sujet controversé est suspecte.",
                        result: "Excellent réflexe critique. Sur un vrai sujet de débat, l'unanimité est impossible... sauf dans une bulle. L'absence de contradiction n'est pas preuve de vérité - c'est preuve d'enfermement.",
                        impact: { lucidite: +25, ouverture: +20 }
                    },
                    {
                        text: "Tu vas volontairement chercher des espaces où des gens défendent l'opinion opposée.",
                        result: "Démarche courageuse. Sortir de sa zone de confort intellectuel est difficile mais nécessaire. Comprendre les arguments adverses ne signifie pas les adopter - mais affiner et tester les siens.",
                        impact: { lucidite: +30, ouverture: +30 }
                    },
                    {
                        text: "Tu bloques le seul commentaire légèrement critique qui apparaît.",
                        result: "Tu participes activement à la construction de ta propre prison. Chaque voix discordante éliminée renforce l'illusion d'unanimité. Tu deviens complice de ta propre désinformation.",
                        impact: { lucidite: -25, ouverture: -30 }
                    }
                ]
            }
        ];

        // Utility functions
        function encodeSaveCode(data) {
            return btoa(JSON.stringify(data));
        }

        function decodeSaveCode(code) {
            try {
                return JSON.parse(atob(code));
            } catch {
                return null;
            }
        }

        function getMasteryLevel(score) {
            if (score >= 520) return { level: "Expert", class: "mastery-expert" };
            if (score >= 320) return { level: "Confirmé", class: "mastery-confirmed" };
            return { level: "En formation", class: "mastery-training" };
        }

        // Main App Component
        function App() {
            const [gameState, setGameState] = useState("unlock");
            const [playerData, setPlayerData] = useState({
                name: "",
                class: "",
                level: 1,
                score: 0,
                xp: 0,
                quizScore: 0,
                scenarioScore: 0,
                flashcardsViewed: 0,
                finished: false
            });
            
            const [unlockCode, setUnlockCode] = useState("");
            const [unlockError, setUnlockError] = useState("");
            
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            // Verify unlock code
            function verifyUnlockCode() {
                const decoded = decodeSaveCode(unlockCode);
                
                if (!decoded) {
                    setUnlockError("Code invalide. Vérifie que tu as copié le code complet.");
                    return;
                }
                
                if (decoded.m !== PREREQUISITE_MODULE) {
                    setUnlockError(`Ce code provient du module ${decoded.m}. Tu as besoin du code de ${PREREQUISITE_MODULE}.`);
                    return;
                }
                
                if (!decoded.f) {
                    setUnlockError("Tu n'as pas terminé le module précédent. Retourne le compléter !");
                    return;
                }
                
                setPlayerData(prev => ({
                    ...prev,
                    name: decoded.n || "",
                    class: decoded.c || ""
                }));
                setGameState("intro");
            }

            function startGame() {
                setGameState("flashcards");
            }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({
                        ...prev,
                        flashcardsViewed: Math.max(prev.flashcardsViewed, currentFlashcard + 2),
                        xp: prev.xp + 12
                    }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({
                        ...prev,
                        level: 2,
                        flashcardsViewed: flashcardsData.length,
                        xp: prev.xp + 50
                    }));
                }
            }

            function prevFlashcard() {
                if (currentFlashcard > 0) {
                    setCurrentFlashcard(prev => prev - 1);
                    setFlashcardFlipped(false);
                }
            }

            function selectQuizAnswer(index) {
                if (showQuizFeedback) return;
                setSelectedAnswer(index);
            }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                const isCorrect = selectedAnswer === quizData[currentQuiz].correct;
                if (isCorrect) {
                    setPlayerData(prev => ({
                        ...prev,
                        score: prev.score + 35,
                        quizScore: prev.quizScore + 35,
                        xp: prev.xp + 35
                    }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({
                        ...prev,
                        level: 3,
                        xp: prev.xp + 70
                    }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                
                const choice = scenarioData[currentScenario].choices[index];
                const luciditeChange = choice.impact.lucidite || 0;
                const ouvertureChange = choice.impact.ouverture || 0;
                const totalChange = Math.max(0, luciditeChange + ouvertureChange);
                
                setPlayerData(prev => ({
                    ...prev,
                    score: prev.score + totalChange,
                    scenarioScore: prev.scenarioScore + totalChange,
                    xp: prev.xp + 30
                }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    completeModule();
                }
            }

            function completeModule() {
                setPlayerData(prev => ({
                    ...prev,
                    finished: true,
                    xp: prev.xp + 120
                }));
                setGameState("complete");
            }

            function generateSaveCode() {
                const saveData = {
                    v: 1,
                    d: new Date().toISOString(),
                    m: MODULE_ID,
                    mv: MODULE_VERSION,
                    n: playerData.name,
                    c: playerData.class,
                    l: 3,
                    s: playerData.score,
                    x: playerData.xp,
                    q: playerData.quizScore,
                    sc: playerData.scenarioScore,
                    f: true
                };
                return encodeSaveCode(saveData);
            }

            function copyCode() {
                const code = generateSaveCode();
                navigator.clipboard.writeText(code).then(() => {
                    alert("Code copié !");
                });
            }

            // Render functions
            function renderUnlock() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, "PIX-pHARe"),
                        e("div", { className: "subtitle" }, "Pilier Numérique"),
                        e("div", { className: "module-badge" }, "MODULE 03 - VERROUILLÉ")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "🔮"),
                            e("div", { className: "panel-title" }, "Accès Restreint")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "unlock-screen" },
                                e("div", { className: "lock-icon" }, "🫧"),
                                e("h2", { className: "unlock-title" }, MODULE_TITLE),
                                e("p", { style: { color: "var(--text-secondary)", marginBottom: "20px" } }, 
                                    "Ce module nécessite d'avoir complété le Module 02 'Les Architectes de l'Ombre'."
                                ),
                                e("input", {
                                    type: "text",
                                    className: "code-input",
                                    value: unlockCode,
                                    onChange: (ev) => setUnlockCode(ev.target.value),
                                    placeholder: "Colle ton code ici..."
                                }),
                                unlockError && e("div", { className: "error-msg" }, unlockError),
                                e("div", { style: { marginTop: "25px" } },
                                    e("button", {
                                        className: "action-btn",
                                        onClick: verifyUnlockCode,
                                        disabled: !unlockCode.trim()
                                    }, "[ DÉVERROUILLER ]")
                                )
                            )
                        )
                    )
                );
            }

            function renderIntro() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, "PIX-pHARe"),
                        e("div", { className: "subtitle" }, "Pilier Numérique"),
                        e("div", { className: "module-badge" }, "MODULE 03")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "🫧"),
                            e("div", { className: "panel-title" }, MODULE_TITLE)
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "scenario-intro" },
                                e("p", null, "Bienvenue ", e("strong", null, playerData.name), " dans le Module 03."),
                                e("p", { style: { marginTop: "15px" } }, 
                                    "Tu connais maintenant les dark patterns. Mais il existe une manipulation plus insidieuse : celle qui ne change pas TON comportement, mais change ce que tu VOIS du monde."
                                ),
                                e("p", { style: { marginTop: "15px" } }, 
                                    "Bienvenue dans l'univers des ", 
                                    e("strong", { style: { color: "var(--mirror-blue)" } }, "Bulles de Filtre"), 
                                    " et des ", 
                                    e("strong", { style: { color: "var(--mirror-purple)" } }, "Chambres d'Écho"),
                                    "."
                                )
                            ),
                            e("div", { className: "bubble-visual" },
                                e("div", { className: "bubble-visual-text" }, 
                                    "Tu ne vois pas internet.",
                                    e("br"),
                                    "Tu vois TON internet.",
                                    e("br"),
                                    "Et les autres voient le leur."
                                )
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "30px" } },
                                e("button", {
                                    className: "action-btn",
                                    onClick: startGame
                                }, "[ PERCER LA BULLE ]")
                            )
                        )
                    )
                );
            }

            function renderFlashcards() {
                const card = flashcardsData[currentFlashcard];
                
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 1 : Cartographie")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node active" }, "1"),
                        e("div", { className: "progress-node" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "XP"),
                            e("div", { className: "xp-value" }, playerData.xp)
                        ),
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "Concept"),
                            e("div", { className: "xp-value" }, `${currentFlashcard + 1}/${flashcardsData.length}`)
                        )
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "📚"),
                            e("div", { className: "panel-title" }, "Encyclopédie des Bulles")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "flashcard-container" },
                                e("div", { 
                                    className: `flashcard ${flashcardFlipped ? "flipped" : ""}`,
                                    onClick: () => setFlashcardFlipped(!flashcardFlipped)
                                },
                                    e("div", { className: "flashcard-face flashcard-front" },
                                        e("div", { className: "flashcard-category" }, card.category),
                                        e("div", { className: "flashcard-question" }, card.question),
                                        e("div", { className: "flashcard-hint" }, card.hint)
                                    ),
                                    e("div", { className: "flashcard-face flashcard-back" },
                                        e("div", { className: "flashcard-category", style: { background: "linear-gradient(135deg, var(--bubble-pink), var(--mirror-purple))" } }, "RÉVÉLÉ"),
                                        e("div", { 
                                            className: "flashcard-answer",
                                            dangerouslySetInnerHTML: { __html: card.answer }
                                        })
                                    )
                                )
                            ),
                            e("div", { className: "flashcard-nav" },
                                e("button", {
                                    className: "nav-btn",
                                    onClick: prevFlashcard,
                                    disabled: currentFlashcard === 0
                                }, "◄ PRÉC"),
                                e("button", {
                                    className: "nav-btn",
                                    onClick: nextFlashcard
                                }, currentFlashcard < flashcardsData.length - 1 ? "SUIV ►" : "NIVEAU 2 ►")
                            )
                        )
                    )
                );
            }

            function renderQuiz() {
                const question = quizData[currentQuiz];
                
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 2 : Diagnostic")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "✓"),
                        e("div", { className: "progress-node active" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "XP"),
                            e("div", { className: "xp-value" }, playerData.xp)
                        ),
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "Score"),
                            e("div", { className: "xp-value" }, playerData.quizScore)
                        ),
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "Question"),
                            e("div", { className: "xp-value" }, `${currentQuiz + 1}/${quizData.length}`)
                        )
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "🔬"),
                            e("div", { className: "panel-title" }, "Analyseur de Bulles")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "quiz-question" }, question.question),
                            e("div", { className: "quiz-options" },
                                question.options.map((opt, idx) => {
                                    let optClass = "quiz-option";
                                    if (showQuizFeedback) {
                                        if (idx === question.correct) optClass += " correct";
                                        else if (idx === selectedAnswer) optClass += " incorrect";
                                    } else if (idx === selectedAnswer) {
                                        optClass += " selected";
                                    }
                                    
                                    return e("div", {
                                        key: idx,
                                        className: optClass,
                                        onClick: () => selectQuizAnswer(idx)
                                    },
                                        e("div", { className: "option-marker" }, String.fromCharCode(65 + idx)),
                                        e("div", { className: "option-text" }, opt)
                                    );
                                })
                            ),
                            showQuizFeedback && e("div", { 
                                className: `feedback-box ${selectedAnswer !== question.correct ? "incorrect-feedback" : ""}`
                            },
                                e("div", { className: "feedback-title" }, 
                                    selectedAnswer === question.correct ? "✓ BULLE PERCÉE" : "✗ ENCORE ENFERMÉ"
                                ),
                                e("p", null, question.feedback)
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                !showQuizFeedback ? 
                                    e("button", {
                                        className: "action-btn",
                                        onClick: validateQuizAnswer,
                                        disabled: selectedAnswer === null
                                    }, "[ ANALYSER ]") :
                                    e("button", {
                                        className: "action-btn",
                                        onClick: nextQuizQuestion
                                    }, currentQuiz < quizData.length - 1 ? "[ SUIVANT ]" : "[ NIVEAU 3 ]")
                            )
                        )
                    )
                );
            }

            function renderScenarios() {
                const scenario = scenarioData[currentScenario];
                
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 3 : Évasion")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "✓"),
                        e("div", { className: "progress-node completed" }, "✓"),
                        e("div", { className: "progress-node active" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "XP Total"),
                            e("div", { className: "xp-value" }, playerData.xp)
                        ),
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "Score"),
                            e("div", { className: "xp-value" }, playerData.score)
                        ),
                        e("div", { className: "xp-box" },
                            e("div", { className: "xp-label" }, "Scénario"),
                            e("div", { className: "xp-value" }, `${currentScenario + 1}/${scenarioData.length}`)
                        )
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "🎯"),
                            e("div", { className: "panel-title" }, scenario.title)
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "scenario-context" }, scenario.context),
                            e("div", { className: "scenario-intro" }, scenario.intro),
                            !showScenarioResult ? 
                                e("div", { className: "choices" },
                                    scenario.choices.map((choice, idx) => 
                                        e("button", {
                                            key: idx,
                                            className: "choice-btn",
                                            onClick: () => makeScenarioChoice(idx)
                                        }, choice.text)
                                    )
                                ) :
                                e("div", { className: "choice-result" },
                                    e("p", { style: { marginBottom: "15px" } }, scenario.choices[scenarioChoice].result),
                                    e("div", { className: "impact-score" },
                                        Object.entries(scenario.choices[scenarioChoice].impact).map(([key, val]) =>
                                            e("div", { 
                                                key: key,
                                                className: `impact-item ${val > 0 ? "positive" : "negative"}`
                                            }, `${key}: ${val > 0 ? "+" : ""}${val}`)
                                        )
                                    ),
                                    e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                        e("button", {
                                            className: "action-btn",
                                            onClick: nextScenario
                                        }, currentScenario < scenarioData.length - 1 ? "[ SUIVANT ]" : "[ TERMINER ]")
                                    )
                                )
                        )
                    )
                );
            }

            function renderComplete() {
                const mastery = getMasteryLevel(playerData.score);
                const saveCode = generateSaveCode();
                
                return e("div", { className: "app-container" },
                    e("div", { className: "completion-screen" },
                        e("div", { className: "completion-icon" }, "🔭"),
                        e("h1", { className: "completion-title" }, "VISION ÉLARGIE"),
                        e("p", { className: "completion-subtitle" }, 
                            `Bravo ${playerData.name} ! Tu as maîtrisé "${MODULE_TITLE}"`
                        ),
                        e("div", { className: `mastery-badge ${mastery.class}` }, mastery.level),
                        e("div", { className: "stats-grid" },
                            e("div", { className: "stat-card" },
                                e("div", { className: "stat-value" }, playerData.score),
                                e("div", { className: "stat-label" }, "Score Total")
                            ),
                            e("div", { className: "stat-card" },
                                e("div", { className: "stat-value" }, playerData.xp),
                                e("div", { className: "stat-label" }, "XP Gagnés")
                            ),
                            e("div", { className: "stat-card" },
                                e("div", { className: "stat-value" }, playerData.quizScore),
                                e("div", { className: "stat-label" }, "Diagnostic")
                            ),
                            e("div", { className: "stat-card" },
                                e("div", { className: "stat-value" }, playerData.scenarioScore),
                                e("div", { className: "stat-label" }, "Évasion")
                            )
                        ),
                        e("div", { className: "save-code-box" },
                            e("div", { className: "save-code-label" }, "📋 TON CODE DE SAUVEGARDE (pour le Module 04) :"),
                            e("div", { className: "save-code" }, saveCode),
                            e("button", { 
                                className: "copy-btn",
                                onClick: copyCode
                            }, "Copier le code")
                        ),
                        e("div", { className: "content-panel", style: { marginTop: "30px", textAlign: "left" } },
                            e("div", { className: "panel-header" },
                                e("div", { className: "panel-icon" }, "🎓"),
                                e("div", { className: "panel-title" }, "Nouvelles capacités")
                            ),
                            e("div", { className: "panel-body" },
                                e("p", null, "Tu comprends maintenant que ", e("strong", { style: { color: "var(--mirror-blue)" } }, "chaque utilisateur vit dans un internet différent"), ". Les bulles de filtre et chambres d'écho fragmentent notre réalité commune."),
                                e("p", { style: { marginTop: "15px" } }, "Tu sais reconnaître les signes d'enfermement (unanimité suspecte, absence de contradiction) et tu as des outils pour ", e("strong", null, "diversifier volontairement tes sources"), "."),
                                e("p", { style: { marginTop: "15px" } }, "Dans le Module 04, tu découvriras ", e("strong", { style: { color: "var(--bubble-pink)" } }, "tes droits numériques"), " et comment construire ton ", e("strong", { style: { color: "var(--bubble-pink)" } }, "armure juridique"), " contre les abus.")
                            )
                        )
                    )
                );
            }

            // Main render
            switch (gameState) {
                case "unlock": return renderUnlock();
                case "intro": return renderIntro();
                case "flashcards": return renderFlashcards();
                case "quiz": return renderQuiz();
                case "scenarios": return renderScenarios();
                case "complete": return renderComplete();
                default: return renderUnlock();
            }
        }

        ReactDOM.createRoot(document.getElementById("root")).render(e(App));
    </script>
</body>
</html>
