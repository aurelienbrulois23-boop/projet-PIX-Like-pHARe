<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Ma√Ætre de l'Harmonie</title>
    <style>
        :root {
            --primary: #ffd700;
            --accent: #ff6b6b;
            --success: #4ecdc4;
            --warning: #ffe66d;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
            --card: #16213e;
            --light: #f5f5f5;
            --gold: #ffd700;
            --gradient: linear-gradient(135deg, #ffd700, #ff6b6b, #4ecdc4, #ffd700);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #2a1a4a 50%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .app-container {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255,215,0,0.2), 0 0 100px rgba(255,215,0,0.1);
            padding: 40px;
            position: relative;
            overflow: hidden;
        }
        .app-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 6px;
            background: var(--gradient);
            background-size: 300% 100%;
            animation: shimmer 3s ease infinite;
        }
        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 {
            font-size: 2.4em;
            background: var(--gradient);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease infinite;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 5px;
        }
        .header .subtitle { color: var(--gold); font-size: 1.2em; text-shadow: 0 0 20px rgba(255,215,0,0.5); }
        .header .level-badge {
            background: var(--gradient);
            background-size: 200% 100%;
            animation: shimmer 2s ease infinite;
            color: #000;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
            font-size: 1.1em;
        }
        .crown { font-size: 2em; display: block; margin-bottom: 10px; animation: float 2s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .progress-container { background: var(--darker); border-radius: 10px; padding: 15px 20px; margin-bottom: 25px; border: 1px solid rgba(255,215,0,0.2); }
        .progress-bar-outer { background: rgba(255,255,255,0.1); border-radius: 10px; height: 14px; overflow: hidden; margin-top: 10px; }
        .progress-bar-inner { height: 100%; background: var(--gradient); background-size: 200% 100%; animation: shimmer 2s ease infinite; border-radius: 10px; transition: width 0.5s ease; }
        .progress-stats { display: flex; justify-content: space-between; font-size: 0.9em; }
        .xp-badge { background: var(--gold); color: #000; padding: 5px 15px; border-radius: 15px; font-weight: bold; font-size: 1.05em; }
        .btn {
            background: var(--gradient);
            background-size: 200% 100%;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 40px rgba(255,215,0,0.5); animation: shimmer 1s ease infinite; }
        .btn-secondary { background: linear-gradient(135deg, #555, #333); color: #fff; }
        .btn-success { background: linear-gradient(135deg, var(--success), #3db8ab); }
        .btn-warning { background: linear-gradient(135deg, var(--warning), #e6cc00); }
        .btn-block { width: 100%; justify-content: center; }
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .card { background: linear-gradient(145deg, #1e2a4a, var(--card)); color: var(--light); padding: 30px; border-radius: 15px; margin: 20px 0; border: 1px solid rgba(255,215,0,0.2); }
        .flashcard-container { perspective: 1000px; margin: 25px 0; }
        .flashcard {
            background: linear-gradient(145deg, #ffd700, #ffed4a);
            color: #1a1a2e;
            padding: 40px 30px;
            border-radius: 15px;
            min-height: 320px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.6s, box-shadow 0.3s;
            transform-style: preserve-3d;
            box-shadow: 0 15px 50px rgba(255,215,0,0.4);
            position: relative;
        }
        .flashcard:hover { box-shadow: 0 20px 60px rgba(255,215,0,0.6); }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard .front, .flashcard .back { backface-visibility: hidden; position: absolute; width: calc(100% - 60px); }
        .flashcard .back { transform: rotateY(180deg); }
        .flashcard .question { font-size: 1.3em; font-weight: 700; line-height: 1.5; }
        .flashcard .answer { font-size: 1.1em; line-height: 1.6; }
        .flashcard .answer-label { color: #c0392b; font-weight: bold; font-size: 0.9em; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; }
        .flashcard .source { margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.2); font-size: 0.85em; color: #555; font-style: italic; }
        .flashcard .tap-hint { position: absolute; bottom: 15px; font-size: 0.8em; color: #666; }
        .card-counter { text-align: center; margin-bottom: 15px; font-size: 0.95em; opacity: 0.8; }
        .quiz-question { background: var(--darker); padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--gold); }
        .quiz-question .label { color: var(--gold); font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .quiz-choices { display: flex; flex-direction: column; gap: 12px; }
        .quiz-choice {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,215,0,0.2);
            color: var(--light);
            padding: 18px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 1rem;
        }
        .quiz-choice:hover { background: rgba(255,215,0,0.1); border-color: var(--gold); transform: translateX(5px); }
        .quiz-choice.correct { background: rgba(78,205,196,0.3); border-color: var(--success); }
        .quiz-choice.incorrect { background: rgba(255,107,107,0.3); border-color: var(--accent); }
        .quiz-choice.disabled { pointer-events: none; opacity: 0.6; }
        .feedback { padding: 20px; border-radius: 12px; margin-top: 20px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .feedback.correct { background: rgba(78,205,196,0.2); border: 1px solid var(--success); }
        .feedback.incorrect { background: rgba(255,107,107,0.2); border: 1px solid var(--accent); }
        .feedback .title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .feedback.correct .title { color: var(--success); }
        .feedback.incorrect .title { color: var(--accent); }
        .dojo-scenario { background: linear-gradient(135deg, var(--darker), #1a0a3e); padding: 25px; border-radius: 12px; border: 2px solid rgba(255,215,0,0.3); margin-bottom: 20px; }
        .dojo-scenario .context-label { color: var(--gold); font-size: 0.9em; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .dojo-scenario .context { font-size: 1.05em; line-height: 1.7; margin-bottom: 20px; }
        .dojo-scenario .question { background: rgba(255,215,0,0.1); padding: 15px; border-radius: 8px; border-left: 3px solid var(--gold); }
        .impact-badge { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; margin-left: 10px; }
        .impact-positive { background: var(--success); color: #000; }
        .impact-negative { background: var(--accent); color: #fff; }
        .impact-neutral { background: var(--warning); color: #000; }
        .save-code-section { background: var(--darker); border: 3px solid var(--gold); border-radius: 12px; padding: 25px; margin: 25px 0; box-shadow: 0 0 30px rgba(255,215,0,0.3); }
        .save-code-box { background: #000; color: var(--gold); font-family: 'Courier New', monospace; padding: 20px; border-radius: 8px; word-break: break-all; font-size: 0.85em; line-height: 1.5; user-select: all; margin: 15px 0; max-height: 120px; overflow-y: auto; border: 1px solid var(--gold); }
        .save-instructions { background: rgba(255,215,0,0.1); border: 1px solid var(--gold); padding: 15px; border-radius: 8px; margin-top: 20px; }
        .save-instructions h4 { color: var(--gold); margin-bottom: 10px; }
        .save-instructions ul { margin-left: 20px; line-height: 1.8; }
        .report { background: linear-gradient(145deg, #1e2a4a, #0f0f2a); border-radius: 15px; overflow: hidden; border: 2px solid var(--gold); box-shadow: 0 0 50px rgba(255,215,0,0.3); }
        .report-header { background: var(--gradient); background-size: 200% 100%; animation: shimmer 3s ease infinite; color: #000; padding: 40px; text-align: center; }
        .report-header h2 { font-size: 2em; margin-bottom: 5px; }
        .report-body { padding: 30px; }
        .report-stat { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(255,215,0,0.2); }
        .report-stat:last-child { border-bottom: none; }
        .report-stat .label { color: #aaa; }
        .report-stat .value { font-weight: bold; color: var(--gold); }
        .mastery-badge { display: inline-block; padding: 10px 25px; border-radius: 25px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; font-size: 1.1em; }
        .mastery-expert { background: var(--gradient); background-size: 200% 100%; animation: shimmer 2s ease infinite; color: #000; }
        .mastery-confirmed { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
        .mastery-learning { background: linear-gradient(135deg, #3498db, #2980b9); color: #fff; }
        .unlock-section { background: linear-gradient(135deg, #1a0a3e, var(--darker)); border: 2px solid var(--warning); border-radius: 15px; padding: 30px; text-align: center; margin: 20px 0; }
        .unlock-section h3 { color: var(--warning); margin-bottom: 15px; }
        .unlock-section input { width: 100%; padding: 15px; border: 2px solid #444; border-radius: 8px; background: var(--darker); color: var(--gold); font-family: 'Courier New', monospace; font-size: 0.9em; margin: 15px 0; }
        .unlock-section input:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 15px rgba(255,215,0,0.3); }
        .error-msg { color: var(--accent); font-weight: bold; margin-top: 10px; }
        .level-indicator { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .level-dot { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3em; background: var(--darker); border: 3px solid #444; transition: all 0.3s; }
        .level-dot.active { border-color: var(--gold); box-shadow: 0 0 25px rgba(255,215,0,0.6); }
        .level-dot.completed { background: var(--success); border-color: var(--success); color: #000; }
        .certification-badge { text-align: center; padding: 30px; margin: 20px 0; background: radial-gradient(circle, rgba(255,215,0,0.2) 0%, transparent 70%); }
        .certification-badge .seal { font-size: 5em; animation: float 2s ease-in-out infinite; }
        .certification-badge h3 { color: var(--gold); font-size: 1.5em; margin: 15px 0; letter-spacing: 3px; }
        .certification-badge p { color: #aaa; }
        @media (max-width: 600px) { body { padding: 10px; } .app-container { padding: 20px; } .header h1 { font-size: 1.8em; } .flashcard { padding: 25px 20px; min-height: 270px; } .btn { padding: 12px 20px; font-size: 0.9rem; } }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        const MODULE_DATA = {
            id: "JURIDIQUE_05",
            version: "1.0.0",
            titre: "MA√éTRE DE L'HARMONIE",
            sous_titre: "Module Final : Expertise Int√©grative",
            description: "Le module ultime qui synth√©tise tous les apprentissages : cas complexes multi-dimensionnels, leadership √©thique et vision syst√©mique.",
            auteur: "Programme pHARe",
            prerequis: "JURIDIQUE_04",
            niveau_difficulte: 5,
            
            niveau1: {
                titre: "Vision Syst√©mique",
                type: "flashcards",
                xp_reward: 150,
                cartes: [
                    {
                        recto: "Qu'est-ce que la VISION SYST√âMIQUE du harc√®lement ?",
                        verso: "Le harc√®lement n'est JAMAIS un probl√®me isol√© entre 2 personnes.\n\nC'est un SYST√àME impliquant :\n‚Ä¢ La victime\n‚Ä¢ L'auteur (souvent plusieurs)\n‚Ä¢ Les t√©moins (actifs et passifs)\n‚Ä¢ L'environnement (culture de classe, normes)\n‚Ä¢ Les adultes (pr√©sence, r√©activit√©)\n\nAGIR SUR UN SEUL √âL√âMENT = INSUFFISANT",
                        source: "Approche √©cologique du harc√®lement"
                    },
                    {
                        recto: "Pourquoi la SANCTION SEULE ne suffit-elle jamais ?",
                        verso: "La sanction traite le SYMPT√îME, pas la CAUSE.\n\nSans travail sur :\n‚Ä¢ Les normes de groupe\n‚Ä¢ Les m√©canismes de d√©sengagement moral\n‚Ä¢ Le r√¥le des t√©moins\n‚Ä¢ L'empathie collective\n\n‚Üí Le harc√®lement se D√âPLACE vers une autre victime ou une autre forme.",
                        source: "Recherches sur l'efficacit√© des interventions"
                    },
                    {
                        recto: "Qu'est-ce que le concept de D√âFENSEUR (Defender) dans la dynamique de groupe ?",
                        verso: "Le D√âFENSEUR est le game-changer !\n\n‚Ä¢ √âl√®ve qui intervient activement pour la victime\n‚Ä¢ Son action stoppe l'agression dans 50% des cas\n‚Ä¢ Il b√©n√©ficie g√©n√©ralement d'un statut social positif\n\nOBJECTIF pHARe : Transformer les t√©moins passifs en d√©fenseurs actifs.",
                        source: "Salmivalli - R√¥les dans le harc√®lement"
                    },
                    {
                        recto: "Quelle est la diff√©rence entre R√âSILIENCE et FRAGILISATION de la victime ?",
                        verso: "ATTENTION au mythe du \"ce qui ne tue pas rend plus fort\" !\n\nLes victimes peuvent rester FRAGILIS√âES des ANN√âES apr√®s :\n‚Ä¢ Anxi√©t√© sociale\n‚Ä¢ Difficult√©s de confiance\n‚Ä¢ Hypervigilance\n‚Ä¢ Impact sur parcours scolaire/professionnel\n\nLe SUIVI √Ä LONG TERME est essentiel, m√™me apr√®s r√©solution.",
                        source: "√âtudes longitudinales sur les victimes"
                    },
                    {
                        recto: "Qu'est-ce que l'HARMONIE DYNAMIQUE dans le contexte anti-harc√®lement ?",
                        verso: "L'objectif n'est pas l'absence de conflit (utopie) mais un √âQUILIBRE VIVANT o√π :\n\n‚Ä¢ Les tensions sont exprim√©es sainement\n‚Ä¢ Les diff√©rences sont respect√©es\n‚Ä¢ Les m√©canismes de r√©gulation fonctionnent\n‚Ä¢ Chacun se sent en s√©curit√© pour √™tre lui-m√™me\n\nL'HARMONIE est dynamique car elle se construit en permanence.",
                        source: "Philosophie du programme pHARe"
                    },
                    {
                        recto: "Quel est le R√îLE ULTIME de l'ambassadeur pHARe ?",
                        verso: "Tu n'es pas un POLICIER ni un D√âLATEUR.\n\nTu es un CATALYSEUR DE CHANGEMENT :\n‚Ä¢ Tu incarnes les valeurs de respect\n‚Ä¢ Tu interviens avec tact et humanit√©\n‚Ä¢ Tu fais le pont entre √©l√®ves et adultes\n‚Ä¢ Tu transformes les normes de ta classe\n\nTon pouvoir : L'EXEMPLE + LA VIGILANCE BIENVEILLANTE.",
                        source: "Mission pHARe ambassadeurs"
                    }
                ]
            },
            
            niveau2: {
                titre: "Cas Complexes Int√©gr√©s",
                type: "quiz",
                xp_reward: 200,
                questions: [
                    {
                        texte: "Situation multi-dimensionnelle : Un √©l√®ve est victime de cyberharc√®lement. L'auteur principal est son ex-meilleur ami. D'autres √©l√®ves ont relay√©. La victime refuse de parler aux adultes. Les parents de l'auteur nient en bloc.",
                        question: "Par quoi commences-tu ?",
                        choix: [
                            { txt: "Confronter l'auteur avec les preuves num√©riques", correct: false, feedback: "Trop t√¥t ! Sans avoir s√©curis√© le soutien √† la victime et pr√©par√© le terrain avec les adultes, tu risques l'escalade et la fermeture de l'auteur." },
                            { txt: "Accompagner la victime et identifier un adulte de confiance qu'elle accepte", correct: true, feedback: "PARFAIT ! Priorit√© 1 = Victime. Trouve un adulte qu'elle peut accepter (pas forc√©ment le CPE si elle refuse). Une fois ce lien cr√©√©, le reste peut se d√©ployer. Le refus initial de parler aux adultes n'est pas d√©finitif." },
                            { txt: "Lancer la proc√©dure Article 40 imm√©diatement", correct: false, feedback: "Pr√©matur√©. Le signalement viendra, mais si tu court-circuites la victime sans son consentement √©clair√©, tu risques de la retraumatiser et de perdre sa confiance." }
                        ]
                    },
                    {
                        texte: "Un √©l√®ve auteur de harc√®lement a √©t√© sanctionn√© (3 jours d'exclusion). √Ä son retour, tu observes que : 1) La victime a peur de repr√©sailles. 2) L'auteur semble en col√®re et isol√©. 3) La classe est divis√©e.",
                        question: "Quelle est la faille syst√©mique √©vidente ?",
                        choix: [
                            { txt: "La sanction √©tait trop l√©g√®re", correct: false, feedback: "La dur√©e de la sanction n'est pas le probl√®me. Le probl√®me est l'ABSENCE DE TRAVAIL DE FOND autour de la sanction." },
                            { txt: "Il manque le travail de r√©int√©gration, de r√©conciliation et de transformation des normes de classe", correct: true, feedback: "EXACT ! La sanction sans accompagnement = bombe √† retardement. Il faut : 1) Suivi victime (peur = signal d'alerte) 2) Entretiens avec l'auteur (col√®re = non-trait√©) 3) Travail collectif sur les normes." },
                            { txt: "Il aurait fallu un conseil de discipline avec exclusion d√©finitive", correct: false, feedback: "L'exclusion d√©finitive d√©place le probl√®me, elle ne le r√©sout pas. Et elle ne r√©pare rien pour la victime ni pour le groupe." }
                        ]
                    },
                    {
                        texte: "Paradoxe √©thique : Tu d√©couvres qu'un √©l√®ve que tu pensais victime a en fait ORCHESTR√â une fausse accusation de harc√®lement contre un camarade. Les adultes ont sanctionn√© un innocent.",
                        question: "Comment g√®res-tu cette r√©v√©lation ?",
                        choix: [
                            { txt: "Minimiser pour prot√©ger le syst√®me (\"ce qui est fait est fait\")", correct: false, feedback: "GRAVE ! L'injustice envers l'innocent ne peut pas √™tre balay√©e. C'est aussi une forme de violence institutionnelle. La v√©rit√© doit √™tre r√©tablie." },
                            { txt: "Signaler aux adultes avec preuves. L'innocent doit √™tre r√©habilit√©, le manipulateur accompagn√©.", correct: true, feedback: "EXACT ! L'int√©grit√© du syst√®me passe par la reconnaissance des erreurs. 1) R√©habiliter l'innocent (excuses, annulation sanction) 2) Comprendre pourquoi le \"manipulateur\" a agi ainsi (souffrance cach√©e ?) 3) Tirer des le√ßons institutionnelles." },
                            { txt: "Punir s√©v√®rement le faux accusateur pour l'exemple", correct: false, feedback: "La punition seule r√©p√®te l'erreur. Un √©l√®ve qui manipule ainsi a probablement lui-m√™me des probl√®mes. Punir sans comprendre = reproduire la violence." }
                        ]
                    },
                    {
                        texte: "Un enseignant utilise r√©guli√®rement des remarques humiliantes envers certains √©l√®ves (\"Tu es nul\", \"Tu n'arriveras jamais √† rien\"). Plusieurs √©l√®ves t'en parlent.",
                        question: "Comment positionnes-tu cette situation ?",
                        choix: [
                            { txt: "Ce n'est pas du harc√®lement car c'est un adulte, pas un √©l√®ve", correct: false, feedback: "ERREUR ! La violence verbale existe aussi de l'adulte vers l'√©l√®ve. Ce sont des violences institutionnelles qui peuvent constituer du harc√®lement moral." },
                            { txt: "C'est de la violence institutionnelle qui doit √™tre signal√©e, m√™me si c'est d√©licat", correct: true, feedback: "EXACT ! Les √©l√®ves m√©ritent le respect de TOUS les adultes. La hi√©rarchie doit √™tre inform√©e. C'est d√©licat mais n√©cessaire. Un ambassadeur pHARe agit aussi face aux dysfonctionnements adultes." },
                            { txt: "C'est une question de p√©dagogie, pas de harc√®lement", correct: false, feedback: "Humilier n'est JAMAIS de la p√©dagogie. Les remarques r√©p√©t√©es qui d√©gradent l'estime de soi constituent de la violence psychologique caract√©ris√©e." }
                        ]
                    }
                ]
            },
            
            niveau3: {
                titre: "√âpreuve du Ma√Ætre",
                type: "dojo",
                xp_reward: 275,
                scenarios: [
                    {
                        contexte: "SITUATION CULMINANTE : Tu es sollicit√© pour pr√©senter le bilan pHARe de ton √©tablissement devant le Conseil d'Administration. Tu dois expliquer pourquoi, malgr√© 3 cas de harc√®lement cette ann√©e, le programme est un SUCC√àS.",
                        question: "Quel argument d√©ploies-tu ?",
                        choix: [
                            { txt: "\"3 cas c'est peu compar√© aux moyennes nationales\"", impact: 30, level: "partial", feedback: "Argument faible. Comparer aux stats peut sembler minimiser chaque cas. Le succ√®s ne se mesure pas qu'en volume." },
                            { txt: "\"Le succ√®s est dans la D√âTECTION et la PRISE EN CHARGE : 3 cas identifi√©s et trait√©s, vs combien de cas invisibles avant ?\"", impact: 100, level: "optimal", feedback: "MAGISTRAL ! Tu retournes la logique : avoir des cas d√©tect√©s = preuve que le syst√®me fonctionne. L'absence de cas d√©tect√©s serait inqui√©tante (omerta, pas d√©tection). Le vrai indicateur = vitesse de d√©tection + qualit√© de r√©solution." },
                            { txt: "\"On fera mieux l'ann√©e prochaine, on va renforcer la surveillance\"", impact: 10, level: "partial", feedback: "R√©ponse d√©fensive qui sugg√®re un √©chec. La surveillance seule ne r√©sout rien. Tu dois montrer la valeur du travail fait, pas promettre un futur hypoth√©tique." }
                        ]
                    },
                    {
                        contexte: "DILEMME √âTHIQUE : Tu apprends qu'un √©l√®ve harceleur a √©t√© lui-m√™me victime d'agressions sexuelles dans sa famille. Il a 14 ans. Cette information t'a √©t√© confi√©e en secret.",
                        question: "Comment navigues-tu entre secret, protection et responsabilit√© ?",
                        choix: [
                            { txt: "Je garde le secret car on me l'a confi√©", impact: -50, level: "error", feedback: "DANGER ! Les agressions sexuelles sur mineur constituent un CRIME. Tu as une OBLIGATION de signalement. Le secret ne peut pas couvrir un crime. L'int√©r√™t de l'enfant prime sur la promesse." },
                            { txt: "Je signale les agressions tout en maintenant l'accompagnement du jeune comme auteur ET victime", impact: 100, level: "optimal", feedback: "EXACT ! Double obligation : 1) Signalement des agressions (protection de l'enfance) 2) Prise en charge de son comportement de harceleur. Il n'est pas excus√© mais il est AUSSI victime. Complexit√© assum√©e." },
                            { txt: "Je l'excuse du harc√®lement vu son v√©cu traumatique", impact: -30, level: "error", feedback: "Comprendre n'est pas excuser. SA victime de harc√®lement m√©rite protection ind√©pendamment de son histoire. Les deux souffrances coexistent sans s'annuler." }
                        ]
                    },
                    {
                        contexte: "VISION FINALE : On te demande de d√©finir en une phrase ce qu'est un \"√©tablissement scolaire en harmonie\" selon ta compr√©hension globale du programme pHARe.",
                        question: "Quelle d√©finition proposes-tu ?",
                        choix: [
                            { txt: "Un √©tablissement o√π il n'y a aucun conflit entre √©l√®ves", impact: 20, level: "partial", feedback: "Utopique et m√™me pas souhaitable ! Le conflit fait partie de la vie. L'objectif n'est pas l'absence de friction mais sa gestion saine." },
                            { txt: "Un √©cosyst√®me o√π chacun peut √™tre pleinement soi-m√™me car les m√©canismes de r√©gulation collective transforment les tensions en opportunit√©s de croissance", impact: 100, level: "optimal", feedback: "üèÜ MAGNIFIQUE ! Tu as int√©gr√© l'HARMONIE DYNAMIQUE : pas l'absence de tensions, mais leur m√©tabolisation positive. L'√©tablissement devient un organisme vivant qui apprend et s'am√©liore continuellement." },
                            { txt: "Un lieu o√π les r√®gles sont strictement appliqu√©es et les sanctions imm√©diates", impact: 10, level: "partial", feedback: "Vision purement r√©pressive. La r√®gle sans l'√©ducation, la sanction sans la r√©paration, la surveillance sans la confiance = √©cole-prison, pas √©cole-harmonie." }
                        ]
                    }
                ]
            }
        };

        const generateSaveCode = (progress) => {
            const payload = { v: 1, d: new Date().toISOString(), m: MODULE_DATA.id, mv: MODULE_DATA.version, n: progress.nom || "Anonyme", c: progress.classe || "", l: progress.currentLevel, s: progress.score, x: progress.xp, q: progress.quizScore, dj: progress.dojoScore, f: progress.finished, cert: progress.finished };
            return btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
        };

        const decodeSaveCode = (code) => { try { return { valid: true, data: JSON.parse(decodeURIComponent(escape(atob(code.trim())))) }; } catch (e) { return { valid: false, error: "Code invalide." }; } };

        const verifyPrerequisite = (code) => {
            const result = decodeSaveCode(code);
            if (!result.valid) return { valid: false, error: "Code invalide." };
            if (result.data.m !== MODULE_DATA.prerequis) return { valid: false, error: `Ce code provient du module ${result.data.m}, pas du module ${MODULE_DATA.prerequis}.` };
            if (!result.data.f) return { valid: false, error: "Ce module n'a pas √©t√© termin√©." };
            return { valid: true, data: result.data };
        };

        const e = React.createElement;
        const { useState } = React;

        function Header({ showProgress, xp }) {
            return e('div', { className: 'header' },
                e('span', { className: 'crown' }, 'üëë'),
                e('div', { className: 'level-badge' }, `NIVEAU ${MODULE_DATA.niveau_difficulte} - FINAL`),
                e('h1', null, MODULE_DATA.titre),
                e('div', { className: 'subtitle' }, MODULE_DATA.sous_titre),
                showProgress && e('div', { style: { marginTop: '15px' } }, e('span', { className: 'xp-badge' }, `‚ö° ${xp} XP`))
            );
        }

        function ProgressBar({ currentLevel, xp }) {
            const percent = Math.min(100, (currentLevel / 3) * 100);
            return e('div', { className: 'progress-container' }, e('div', { className: 'progress-stats' }, e('span', null, `√âpreuve ${currentLevel}/3`), e('span', { className: 'xp-badge' }, `${xp} XP`)), e('div', { className: 'progress-bar-outer' }, e('div', { className: 'progress-bar-inner', style: { width: `${percent}%` } })));
        }

        function LevelIndicator({ current }) {
            const levels = ['üåü', '‚öîÔ∏è', 'üëë'];
            return e('div', { className: 'level-indicator' }, levels.map((emoji, i) => e('div', { key: i, className: `level-dot ${i + 1 === current ? 'active' : ''} ${i + 1 < current ? 'completed' : ''}` }, i + 1 < current ? '‚úì' : emoji)));
        }

        function Flashcard({ card, onNext, isLast, onComplete }) {
            const [flipped, setFlipped] = useState(false);
            return e('div', { className: 'flashcard-container' },
                e('div', { className: `flashcard ${flipped ? 'flipped' : ''}`, onClick: () => setFlipped(!flipped) },
                    e('div', { className: 'front' }, e('div', { className: 'question', style: { whiteSpace: 'pre-line' } }, card.recto), e('div', { className: 'tap-hint' }, 'üëÜ Clique pour retourner')),
                    e('div', { className: 'back' }, e('div', { className: 'answer-label' }, '‚úì R√©ponse'), e('div', { className: 'answer', style: { whiteSpace: 'pre-line' } }, card.verso), e('div', { className: 'source' }, `üìñ ${card.source}`))
                ),
                e('div', { className: 'text-center', style: { marginTop: '20px' } }, flipped && (isLast ? e('button', { className: 'btn btn-success', onClick: onComplete }, '‚úì VALIDER') : e('button', { className: 'btn', onClick: () => { onNext(); setFlipped(false); } }, 'SUIVANT ‚Üí')))
            );
        }

        function QuizQuestion({ question, onAnswer }) {
            const [answered, setAnswered] = useState(false);
            const [selectedIdx, setSelectedIdx] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const handleChoice = (choice, idx) => { if (answered) return; setAnswered(true); setSelectedIdx(idx); setFeedback({ correct: choice.correct, text: choice.feedback }); };
            return e('div', null,
                e('div', { className: 'quiz-question' }, e('div', { className: 'label' }, '‚öîÔ∏è CAS COMPLEXE'), e('p', { style: { marginBottom: '15px', lineHeight: '1.6' } }, question.texte), question.question && e('p', { style: { fontWeight: 'bold', color: '#ffd700' } }, `‚ùì ${question.question}`)),
                e('div', { className: 'quiz-choices' }, question.choix.map((choice, idx) => e('button', { key: idx, className: `quiz-choice ${answered ? (idx === selectedIdx ? (choice.correct ? 'correct' : 'incorrect') : 'disabled') : ''}`, onClick: () => handleChoice(choice, idx), disabled: answered }, choice.txt))),
                feedback && e('div', { className: `feedback ${feedback.correct ? 'correct' : 'incorrect'}` }, e('div', { className: 'title' }, feedback.correct ? 'üèÜ MA√éTRISE D√âMONTR√âE !' : '‚ö†Ô∏è R√âFLEXION INCOMPL√àTE'), e('p', null, feedback.text), e('button', { className: 'btn', style: { marginTop: '20px' }, onClick: () => onAnswer(feedback.correct) }, 'CONTINUER ‚Üí'))
            );
        }

        function DojoScenario({ scenario, onAnswer }) {
            const [answered, setAnswered] = useState(false);
            const [selectedChoice, setSelectedChoice] = useState(null);
            const handleChoice = (choice) => { if (answered) return; setAnswered(true); setSelectedChoice(choice); };
            const getImpactClass = (impact) => impact >= 80 ? 'impact-positive' : impact > 0 ? 'impact-neutral' : 'impact-negative';
            const getImpactLabel = (impact) => impact >= 0 ? `+${impact}` : `${impact}`;
            return e('div', null,
                e('div', { className: 'dojo-scenario' }, e('div', { className: 'context-label' }, 'üëë √âPREUVE DU MA√éTRE'), e('p', { className: 'context' }, scenario.contexte), e('div', { className: 'question' }, e('strong', null, '‚ùì ', scenario.question))),
                e('div', { className: 'quiz-choices' }, scenario.choix.map((choice, idx) => e('button', { key: idx, className: `quiz-choice ${answered ? (choice === selectedChoice ? (choice.level === 'optimal' ? 'correct' : choice.level === 'error' ? 'incorrect' : '') : 'disabled') : ''}`, onClick: () => handleChoice(choice), disabled: answered }, choice.txt, answered && e('span', { className: `impact-badge ${getImpactClass(choice.impact)}` }, getImpactLabel(choice.impact))))),
                selectedChoice && e('div', { className: `feedback ${selectedChoice.level === 'optimal' ? 'correct' : selectedChoice.level === 'error' ? 'incorrect' : 'correct'}` }, e('div', { className: 'title' }, selectedChoice.level === 'optimal' ? 'üëë SAGESSE DU MA√éTRE !' : selectedChoice.level === 'error' ? '‚ö†Ô∏è LE√áON √Ä M√âDITER' : 'üëç VOIE ACCEPTABLE'), e('p', null, selectedChoice.feedback), e('button', { className: 'btn', style: { marginTop: '20px' }, onClick: () => onAnswer(selectedChoice.impact) }, 'CONTINUER ‚Üí'))
            );
        }

        function CertificationReport({ progress, onMenu }) {
            const saveCode = generateSaveCode(progress);
            const [copied, setCopied] = useState(false);
            const copyToClipboard = () => { navigator.clipboard.writeText(saveCode).then(() => { setCopied(true); setTimeout(() => setCopied(false), 2000); }); };
            const totalScore = progress.quizScore + progress.dojoScore;
            const getMasteryLevel = () => { if (totalScore >= 550) return { label: 'MA√éTRE', class: 'mastery-expert', emoji: 'üëë' }; if (totalScore >= 350) return { label: 'EXPERT', class: 'mastery-confirmed', emoji: '‚≠ê' }; return { label: 'CERTIFI√â', class: 'mastery-learning', emoji: '‚úì' }; };
            const mastery = getMasteryLevel();
            
            return e('div', null,
                e('div', { className: 'certification-badge' },
                    e('div', { className: 'seal' }, 'üèÜ'),
                    e('h3', null, 'CERTIFICATION COMPL√àTE'),
                    e('p', null, 'Ambassadeur pHARe - Parcours Juridique')
                ),
                e('div', { className: 'report' },
                    e('div', { className: 'report-header' },
                        e('span', { style: { fontSize: '3em', display: 'block', marginBottom: '15px' } }, mastery.emoji),
                        e('h2', null, 'PARCOURS ACCOMPLI'),
                        e('p', null, `F√©licitations ${progress.nom || 'Ambassadeur'} !`)
                    ),
                    e('div', { className: 'report-body' },
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Certification'), e('span', { className: 'value' }, 'Ambassadeur pHARe - Juridique')),
                        progress.classe && e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Classe'), e('span', { className: 'value' }, progress.classe)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Modules compl√©t√©s'), e('span', { className: 'value' }, '5/5')),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'XP Total'), e('span', { className: 'value' }, `${progress.xp} XP`)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Score Final'), e('span', { className: 'value' }, `${totalScore} pts`)),
                        e('div', { className: 'report-stat' }, e('span', { className: 'label' }, 'Grade'), e('span', { className: `mastery-badge ${mastery.class}` }, mastery.label))
                    )
                ),
                e('div', { className: 'save-code-section' },
                    e('h3', { style: { color: '#ffd700', marginBottom: '15px', textAlign: 'center' } }, 'üèÜ CODE DE CERTIFICATION FINALE'),
                    e('p', { style: { opacity: 0.8, textAlign: 'center' } }, 'Ce code prouve que tu as compl√©t√© le parcours complet !'),
                    e('div', { className: 'save-code-box' }, saveCode),
                    e('button', { className: `btn btn-block ${copied ? 'btn-success' : ''}`, onClick: copyToClipboard }, copied ? '‚úì COPI√â !' : 'üìã COPIER LE CODE DE CERTIFICATION'),
                    e('div', { className: 'save-instructions' },
                        e('h4', null, 'üìú Ta certification'),
                        e('ul', null,
                            e('li', null, 'Envoie ce code au CPE pour validation officielle'),
                            e('li', null, 'Tu peux maintenant former d\'autres ambassadeurs !'),
                            e('li', null, 'Ton expertise : Cadre l√©gal + Psychologie + Cyber + Protocoles + Vision syst√©mique')
                        )
                    )
                ),
                e('div', { className: 'btn-group', style: { marginTop: '30px' } },
                    e('button', { className: 'btn btn-block', onClick: onMenu }, 'üè† RETOUR √Ä L\'ACCUEIL')
                )
            );
        }

        function App() {
            const [mode, setMode] = useState('menu');
            const [unlocked, setUnlocked] = useState(false);
            const [currentLevel, setCurrentLevel] = useState(1);
            const [cardIdx, setCardIdx] = useState(0);
            const [questionIdx, setQuestionIdx] = useState(0);
            const [scenarioIdx, setScenarioIdx] = useState(0);
            const [xp, setXp] = useState(0);
            const [quizScore, setQuizScore] = useState(0);
            const [dojoScore, setDojoScore] = useState(0);
            const [nom, setNom] = useState('');
            const [classe, setClasse] = useState('');
            const [unlockCode, setUnlockCode] = useState('');
            const [unlockError, setUnlockError] = useState('');

            const resetProgress = () => { setCurrentLevel(1); setCardIdx(0); setQuestionIdx(0); setScenarioIdx(0); setXp(0); setQuizScore(0); setDojoScore(0); };
            const progress = { nom, classe, currentLevel, xp, quizScore, dojoScore, score: quizScore + dojoScore, finished: mode === 'report' };

            const handleUnlock = () => { const result = verifyPrerequisite(unlockCode); if (result.valid) { setNom(result.data.n || ''); setClasse(result.data.c || ''); setUnlocked(true); setUnlockError(''); } else { setUnlockError(result.error); } };

            if (mode === 'menu') {
                return e('div', { className: 'app-container' },
                    e(Header, { showProgress: false }),
                    e('div', { className: 'card' }, e('strong', null, 'üéØ MISSION FINALE : '), MODULE_DATA.description),
                    !unlocked ? e('div', { className: 'unlock-section' },
                        e('h3', null, 'üîê MODULE FINAL VERROUILL√â'),
                        e('p', null, `Pr√©requis : Compl√©ter les 4 modules pr√©c√©dents`),
                        e('input', { type: 'text', placeholder: 'Code du Module 4...', value: unlockCode, onChange: (ev) => { setUnlockCode(ev.target.value); setUnlockError(''); } }),
                        unlockError && e('div', { className: 'error-msg' }, `‚ö†Ô∏è ${unlockError}`),
                        e('button', { className: 'btn', onClick: handleUnlock }, 'üîì D√âBLOQUER LE MODULE FINAL')
                    ) : e('div', { className: 'btn-group' },
                        e('div', { style: { textAlign: 'center', color: '#ffd700', marginBottom: '15px', fontSize: '1.1em' } }, `üëë ${nom}, tu es pr√™t(e) pour l'√©preuve finale !`),
                        e('button', { className: 'btn btn-block', onClick: () => setMode('game') }, '‚öîÔ∏è COMMENCER L\'√âPREUVE')
                    ),
                    e('div', { style: { marginTop: '30px', textAlign: 'center', opacity: 0.5, fontSize: '0.85em' } }, `Module ${MODULE_DATA.id} v${MODULE_DATA.version}`)
                );
            }

            if (mode === 'game') {
                if (currentLevel === 1) {
                    const cards = MODULE_DATA.niveau1.cartes;
                    return e('div', { className: 'app-container' }, e(Header, { showProgress: true, xp }), e(ProgressBar, { currentLevel, xp }), e(LevelIndicator, { current: currentLevel }), e('h2', { style: { textAlign: 'center' } }, 'üåü √âPREUVE 1 : VISION'), e('div', { className: 'card-counter' }, `Carte ${cardIdx + 1} / ${cards.length}`), e(Flashcard, { card: cards[cardIdx], isLast: cardIdx === cards.length - 1, onNext: () => setCardIdx(cardIdx + 1), onComplete: () => { setXp(xp + MODULE_DATA.niveau1.xp_reward); setCurrentLevel(2); setCardIdx(0); } }));
                }
                if (currentLevel === 2) {
                    const questions = MODULE_DATA.niveau2.questions;
                    const handleQuizAnswer = (correct) => { if (correct) setQuizScore(quizScore + 50); if (questionIdx < questions.length - 1) setQuestionIdx(questionIdx + 1); else { setXp(xp + MODULE_DATA.niveau2.xp_reward); setCurrentLevel(3); setQuestionIdx(0); } };
                    return e('div', { className: 'app-container' }, e(Header, { showProgress: true, xp }), e(ProgressBar, { currentLevel, xp }), e(LevelIndicator, { current: currentLevel }), e('h2', { style: { textAlign: 'center' } }, '‚öîÔ∏è √âPREUVE 2 : INT√âGRATION'), e('div', { className: 'card-counter' }, `D√©fi ${questionIdx + 1} / ${questions.length}`), e(QuizQuestion, { key: questionIdx, question: questions[questionIdx], onAnswer: handleQuizAnswer }));
                }
                if (currentLevel === 3) {
                    const scenarios = MODULE_DATA.niveau3.scenarios;
                    const handleDojoAnswer = (impact) => { setDojoScore(dojoScore + Math.max(0, impact)); if (scenarioIdx < scenarios.length - 1) setScenarioIdx(scenarioIdx + 1); else { setXp(xp + MODULE_DATA.niveau3.xp_reward); setMode('report'); } };
                    return e('div', { className: 'app-container' }, e(Header, { showProgress: true, xp }), e(ProgressBar, { currentLevel, xp }), e(LevelIndicator, { current: currentLevel }), e('h2', { style: { textAlign: 'center' } }, 'üëë √âPREUVE 3 : SAGESSE'), e('div', { className: 'card-counter' }, `√âpreuve finale ${scenarioIdx + 1} / ${scenarios.length}`), e(DojoScenario, { key: scenarioIdx, scenario: scenarios[scenarioIdx], onAnswer: handleDojoAnswer }));
                }
            }

            if (mode === 'report') {
                return e('div', { className: 'app-container' }, e(CertificationReport, { progress: { ...progress, xp: xp + (currentLevel > 3 ? 0 : MODULE_DATA.niveau3.xp_reward) }, onMenu: () => { resetProgress(); setUnlocked(false); setUnlockCode(''); setMode('menu'); } }));
            }
            return e('div', { className: 'app-container' }, 'Chargement...');
        }

        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
