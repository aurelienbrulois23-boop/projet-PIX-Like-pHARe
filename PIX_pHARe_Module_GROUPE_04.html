<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module GROUPE 04 - Briser le Cycle</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --break-emerald: #059669;
            --break-teal: #14b8a6;
            --break-cyan: #06b6d4;
            --chain-gray: #4b5563;
            --chain-broken: #10b981;
            --void-dark: #0a100f;
            --deep-dark: #050807;
            --panel-bg: rgba(10, 16, 15, 0.95);
            --text-primary: #e8fff5;
            --text-secondary: #7faa99;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .break-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(5, 150, 105, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(20, 184, 166, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header { text-align: center; padding: 40px 20px; }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(5, 150, 105, 0.6));
            animation: chainBreak 3s ease-in-out infinite;
        }
        
        @keyframes chainBreak {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--break-emerald), var(--break-teal), var(--break-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--break-teal);
            margin-top: 10px;
            text-transform: uppercase;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 35px;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.2), rgba(20, 184, 166, 0.2));
            border: 2px solid var(--break-emerald);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--break-emerald);
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 55px; height: 55px;
            border: 3px solid var(--text-secondary);
            background: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .progress-node.active {
            border-color: var(--break-emerald);
            color: var(--break-emerald);
            box-shadow: 0 0 25px rgba(5, 150, 105, 0.5);
        }
        
        .progress-node.completed {
            border-color: var(--chain-broken);
            background: rgba(16, 185, 129, 0.2);
            color: var(--chain-broken);
        }
        
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 2px solid var(--break-emerald);
            padding: 15px 25px;
            text-align: center;
            border-radius: 10px;
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--break-emerald);
        }
        
        .content-panel {
            background: var(--panel-bg);
            border: 2px solid rgba(5, 150, 105, 0.3);
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--chain-gray), var(--break-emerald), var(--chain-broken));
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.15), rgba(20, 184, 166, 0.1));
            padding: 18px 25px;
            border-bottom: 1px solid rgba(5, 150, 105, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--break-emerald), var(--break-cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--break-emerald);
            text-transform: uppercase;
        }
        
        .panel-body { padding: 25px; }
        
        .unlock-screen { text-align: center; padding: 40px 20px; }
        
        .lock-icon { font-size: 4rem; margin-bottom: 20px; animation: chainBreak 3s ease-in-out infinite; }
        
        .unlock-title { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; color: var(--break-emerald); margin-bottom: 15px; }
        
        .code-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--break-emerald);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            margin: 20px auto;
            display: block;
        }
        
        .code-input:focus { outline: none; border-color: var(--break-cyan); box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
        
        .error-msg {
            color: #ef4444;
            font-family: 'Share Tech Mono', monospace;
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ef4444;
            border-radius: 10px;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .data-box {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(5, 150, 105, 0.15);
            border: 1px solid var(--break-emerald);
            border-radius: 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--break-emerald);
            margin: 5px;
        }
        
        .data-box .label { font-family: 'Share Tech Mono', monospace; font-size: 0.75rem; color: var(--text-secondary); font-weight: 400; }
        
        .method-card {
            background: var(--deep-dark);
            border: 2px solid var(--break-emerald);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .method-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--break-cyan);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .method-origin {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            padding: 3px 10px;
            background: rgba(5, 150, 105, 0.2);
            border-radius: 10px;
        }
        
        .flashcard-container { perspective: 1200px; margin-bottom: 20px; }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 280px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .flashcard-face {
            position: absolute;
            width: 100%;
            min-height: 280px;
            backface-visibility: hidden;
            border: 2px solid var(--break-emerald);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 25px;
            background: var(--deep-dark);
        }
        
        .flashcard-front { background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(20, 184, 166, 0.05)); }
        
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1));
            border-color: var(--chain-broken);
        }
        
        .flashcard-category {
            position: absolute;
            top: 15px; right: 15px;
            padding: 8px 18px;
            background: var(--break-emerald);
            color: var(--deep-dark);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 20px;
        }
        
        .flashcard-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--break-emerald);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .flashcard-hint {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--break-cyan);
            text-align: center;
        }
        
        .flashcard-answer { font-size: 1rem; line-height: 1.7; color: var(--text-primary); }
        .flashcard-answer strong { color: var(--chain-broken); }
        .flashcard-answer .data { color: var(--break-cyan); font-family: 'Orbitron', sans-serif; }
        .flashcard-answer .method { color: var(--break-emerald); font-style: italic; }
        
        .flashcard-nav { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        
        .nav-btn {
            background: transparent;
            border: 2px solid var(--break-emerald);
            color: var(--break-emerald);
            padding: 12px 30px;
            font-family: 'Share Tech Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 25px;
        }
        
        .nav-btn:hover { background: rgba(5, 150, 105, 0.2); box-shadow: 0 0 15px rgba(5, 150, 105, 0.4); }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        
        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(20, 184, 166, 0.05));
            border-left: 4px solid var(--break-emerald);
            border-radius: 0 15px 15px 0;
        }
        
        .quiz-options { display: flex; flex-direction: column; gap: 12px; }
        
        .quiz-option {
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-option:hover:not(.selected):not(.correct):not(.incorrect) {
            border-color: var(--break-emerald);
            background: rgba(5, 150, 105, 0.1);
            transform: translateX(5px);
        }
        
        .quiz-option.selected { border-color: var(--break-emerald); background: rgba(5, 150, 105, 0.15); }
        .quiz-option.correct { border-color: var(--chain-broken); background: rgba(16, 185, 129, 0.2); }
        .quiz-option.incorrect { border-color: #ef4444; background: rgba(239, 68, 68, 0.15); }
        
        .option-marker {
            width: 35px; height: 35px;
            border: 2px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }
        
        .option-text { flex: 1; font-size: 0.95rem; }
        
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-left: 4px solid var(--chain-broken);
            border-radius: 0 15px 15px 0;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .feedback-box.incorrect-feedback { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        
        .feedback-title { font-family: 'Orbitron', sans-serif; font-weight: 700; color: var(--chain-broken); margin-bottom: 10px; }
        .feedback-box.incorrect-feedback .feedback-title { color: #ef4444; }
        
        .scenario-intro {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.1), rgba(20, 184, 166, 0.05));
            border: 1px solid rgba(5, 150, 105, 0.3);
            border-radius: 15px;
        }
        
        .scenario-context {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--break-emerald);
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(5, 150, 105, 0.1);
            border: 1px dashed var(--break-emerald);
            border-radius: 10px;
        }
        
        .choice-btn {
            display: block;
            width: 100%;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            border-radius: 12px;
            padding: 18px 20px;
            margin-bottom: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }
        
        .choice-btn:hover {
            border-color: var(--break-emerald);
            background: rgba(5, 150, 105, 0.1);
            transform: translateX(5px);
        }
        
        .choice-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--chain-broken);
            border-radius: 15px;
        }
        
        .impact-score { display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap; }
        
        .impact-item {
            padding: 8px 15px;
            background: rgba(5, 150, 105, 0.1);
            border: 1px solid var(--break-emerald);
            border-radius: 20px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
        }
        
        .impact-item.positive { border-color: var(--chain-broken); color: var(--chain-broken); }
        .impact-item.negative { border-color: #ef4444; color: #ef4444; }
        
        .action-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--break-emerald), var(--break-cyan));
            color: var(--deep-dark);
            border: none;
            padding: 15px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            border-radius: 30px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(5, 150, 105, 0.5); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .completion-screen { text-align: center; padding: 50px 20px; }
        .completion-icon { font-size: 5rem; margin-bottom: 20px; animation: chainBreak 3s ease-in-out infinite; }
        
        .completion-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--break-emerald), var(--break-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px; margin: 30px 0; }
        
        .stat-card {
            background: var(--panel-bg);
            border: 2px solid var(--break-emerald);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value { font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight: 700; color: var(--break-emerald); }
        .stat-label { font-family: 'Share Tech Mono', monospace; font-size: 0.8rem; color: var(--text-secondary); text-transform: uppercase; margin-top: 5px; }
        
        .save-code-box { background: var(--deep-dark); border: 2px solid var(--chain-broken); border-radius: 15px; padding: 25px; margin: 30px 0; }
        .save-code-label { font-family: 'Share Tech Mono', monospace; font-size: 0.9rem; color: var(--chain-broken); margin-bottom: 10px; }
        
        .save-code {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--break-emerald);
            word-break: break-all;
            background: rgba(5, 150, 105, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed var(--break-emerald);
        }
        
        .copy-btn {
            margin-top: 15px;
            background: transparent;
            border: 2px solid var(--chain-broken);
            color: var(--chain-broken);
            padding: 10px 25px;
            font-family: 'Share Tech Mono', monospace;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover { background: rgba(16, 185, 129, 0.2); }
        
        .mastery-badge {
            display: inline-block;
            padding: 10px 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            border: 2px solid;
            border-radius: 25px;
            margin-top: 15px;
        }
        
        .mastery-expert { color: var(--break-cyan); border-color: var(--break-cyan); box-shadow: 0 0 20px rgba(6, 182, 212, 0.5); }
        .mastery-confirmed { color: var(--chain-broken); border-color: var(--chain-broken); }
        .mastery-training { color: var(--text-secondary); border-color: var(--text-secondary); }
        
        @media (max-width: 600px) {
            .glitch-title { font-size: 1.5rem; }
            .progress-node { width: 45px; height: 45px; font-size: 1rem; }
            .panel-body { padding: 15px; }
            .flashcard-face { padding: 20px 15px; min-height: 300px; }
        }
    </style>
</head>
<body>
    <div class="break-bg"></div>
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
        const { useState } = React;
        const e = React.createElement;

        const MODULE_ID = "GROUPE_04";
        const MODULE_TITLE = "Briser le Cycle";
        const PREREQUISITE_MODULE = "GROUPE_03";
        
        const flashcardsData = [
            { category: "DONN√âES CL√âS", question: "Quelle est l'efficacit√© prouv√©e des programmes anti-harc√®lement ?", hint: "[ Cliquez pour les chiffres ]", answer: "M√©ta-analyses (Niveau 1) : les programmes r√©duisent la <strong>perp√©tration de 19-20%</strong> et la <strong>victimation de 15-16%</strong>. Les <span class='method'>approches globales</span> (whole-school) sont les plus efficaces." },
            { category: "M√âTHODE KiVa", question: "Comment fonctionne le programme KiVa (Finlande) ?", hint: "[ Cliquez pour comprendre ]", answer: "<strong>Principe :</strong> Le harc√®lement est maintenu par les <span class='method'>renforceurs</span>. KiVa vise √† modifier les attitudes des t√©moins pour retirer le 'profit social' de l'agresseur. Rendre la d√©fense 'socialement payante' et le soutien √† l'agresseur 'socialement co√ªteux'." },
            { category: "M√âTHODE PIKAS", question: "Qu'est-ce que la M√©thode de Pr√©occupation Partag√©e ?", hint: "[ Cliquez pour comprendre ]", answer: "Aussi appel√©e <span class='method'>No Blame</span>. <strong>Principe :</strong> √©viter la confrontation punitive. On invite l'agresseur √† trouver des solutions pour am√©liorer le bien-√™tre de la cible. On mobilise son empathie plut√¥t que de le punir." },
            { category: "APPROCHES", question: "Pourquoi les approches 'Tol√©rance Z√©ro' sont-elles inefficaces ?", hint: "[ Cliquez pour comprendre ]", answer: "Les politiques <span class='method'>purement punitives</span> augmentent le <strong>climat de peur</strong> sans r√©duire les actes. Elles ne d√©veloppent pas les <strong>comp√©tences sociales</strong> sous-jacentes. L'agresseur exclu revient avec les m√™mes m√©canismes." },
            { category: "CLIMAT", question: "Quel r√¥le joue le climat scolaire ?", hint: "[ Cliquez pour comprendre ]", answer: "Un climat positif (soutien, appartenance, √©quit√©) agit comme un <strong>tampon protecteur</strong>. Les √©l√®ves harc√®lent moins quand les adultes manifestent une d√©sapprobation <span class='method'>ferme et coh√©rente</span>." },
            { category: "COMP√âTENCES", question: "Quelles comp√©tences psychosociales prot√®gent ?", hint: "[ Cliquez pour comprendre ]", answer: "<strong>1) Empathie affective</strong> : RESSENTIR la douleur (frein le plus puissant). <strong>2) Auto-efficacit√© sociale</strong> : croire en sa capacit√© √† intervenir. <strong>3) R√©gulation √©motionnelle</strong> : g√©rer le stress sans agressivit√©." },
            { category: "ADULTES", question: "Quel est le positionnement optimal des adultes ?", hint: "[ Cliquez pour comprendre ]", answer: "L'adulte = <strong>mod√®le de r√©gulation sociale</strong>. Interventions r√©ussies = enseignants form√©s (<span class='data'>minimum 15h</span>) pour reconna√Ætre les signes et intervenir <strong>sans aggraver</strong> pour la victime." },
            { category: "STRAT√âGIE", question: "Comment 'retirer le profit social' de l'agresseur ?", hint: "[ Cliquez pour la strat√©gie ]", answer: "L'agresseur cherche du <strong>statut</strong>. Strat√©gie : <span class='method'>rendre la d√©fense prestigieuse</span> et le soutien √† l'agresseur <span class='method'>co√ªteux socialement</span>. Quand l'agression ne 'paye' plus, elle diminue." }
        ];

        const quizData = [
            { question: "Le programme KiVa cible principalement quel groupe ?", options: ["Les victimes", "Les agresseurs", "Les t√©moins", "Les parents"], correct: 2, feedback: "KiVa cible les T√âMOINS. En changeant leur attitude, on retire la r√©compense sociale de l'agresseur." },
            { question: "Pourquoi les approches 'Tol√©rance Z√©ro' √©chouent-elles souvent ?", options: ["Trop douces", "Ne d√©veloppent pas les comp√©tences sous-jacentes", "Parents s'y opposent", "Trop ch√®res"], correct: 1, feedback: "La punition seule ne change pas les SCH√âMAS COGNITIFS. L'agresseur revient avec les m√™mes m√©canismes." },
            { question: "La M√©thode de Pr√©occupation Partag√©e consiste √† :", options: ["Punir s√©v√®rement", "Ignorer le probl√®me", "Mobiliser l'empathie de l'agresseur", "Isoler la victime"], correct: 2, feedback: "L'approche No Blame mobilise l'empathie plut√¥t que de d√©clencher la d√©fensivit√©." },
            { question: "Quelle comp√©tence est le 'frein le plus puissant' √† l'agression ?", options: ["Intelligence acad√©mique", "Empathie affective", "Force physique", "Popularit√©"], correct: 1, feedback: "L'EMPATHIE AFFECTIVE - la capacit√© √† RESSENTIR (pas juste comprendre) la douleur d'autrui." },
            { question: "Dur√©e minimale de formation des enseignants pour des interventions efficaces ?", options: ["2 heures", "6 heures", "Au moins 15 heures", "Pas besoin"], correct: 2, feedback: "AU MOINS 15 HEURES pour reconna√Ætre les signes et intervenir sans aggraver la situation." }
        ];

        const scenarioData = [
            { title: "Le Choix de l'Approche", context: "Tu es CPE adjoint¬∑e. Harc√®lement de groupe (5 √©l√®ves) contre 1 cible depuis 2 mois.", intro: "Deux approches sur la table : punitive ou restaurative. Les parents veulent des sanctions.", choices: [
                { text: "Approche punitive : exclure les 5 √©l√®ves pour 3 jours.", result: "Les 5 reviennent avec ranc≈ìur. Ils bl√¢ment la victime. Le harc√®lement reprend sous formes discr√®tes.", impact: { efficacite: -10, durabilite: -25 } },
                { text: "Approche restaurative : entretiens Pikas + m√©diation.", result: "Chaque √©l√®ve r√©fl√©chit √† l'impact de ses actes. L'empathie est mobilis√©e. R√©sultats durables.", impact: { efficacite: +25, durabilite: +30 } },
                { text: "Approche mixte : sanction symbolique + travail restauratif.", result: "La sanction marque la limite, le travail restauratif traite les causes. Compromis intelligent.", impact: { efficacite: +20, durabilite: +20 } },
                { text: "Laisser les √©l√®ves r√©gler √ßa entre eux.", result: "Sans intervention, le d√©s√©quilibre se maintient. Message envoy√© : 'ce n'est pas grave'.", impact: { efficacite: -30, durabilite: -30 } }
            ]},
            { title: "Cr√©er une Norme de D√©fense", context: "Tu veux que d√©fendre quelqu'un devienne 'cool' plut√¥t que risqu√©.", intro: "Comment transformer la norme sociale ?", choices: [
                { text: "Afficher un r√®glement avec les sanctions.", result: "N√©cessaire mais insuffisant. Les r√®glements ne changent pas les normes informelles.", impact: { efficacite: +5, norme: -5 } },
                { text: "Valoriser publiquement les comportements de d√©fense.", result: "Tu associes la d√©fense √† un statut positif. Le comportement devient d√©sirable.", impact: { efficacite: +25, norme: +30 } },
                { text: "Cr√©er un syst√®me d'ambassadeurs avec des √©l√®ves populaires.", result: "Strat√©gie KiVa ! Les √©l√®ves populaires qui d√©fendent envoient un signal puissant.", impact: { efficacite: +30, norme: +25 } },
                { text: "Punir s√©v√®rement tous ceux qui rient aux moqueries.", result: "Tu cr√©es de la peur mais pas d'adh√©sion. Les normes souterraines ne changent pas.", impact: { efficacite: +5, norme: -10 } }
            ]},
            { title: "L'Empathie Affective", context: "Un √©l√®ve dit : 'Je comprends que √ßa lui fait mal, mais je m'en fiche.'", intro: "Il a de l'empathie COGNITIVE mais pas AFFECTIVE. Comment d√©velopper l'empathie affective ?", choices: [
                { text: "Lui expliquer encore une fois pourquoi c'est mal.", result: "Inefficace. Il SAIT d√©j√†. Son probl√®me n'est pas cognitif mais affectif.", impact: { efficacite: -10, empathie: -5 } },
                { text: "Utiliser le storytelling : t√©moignages de victimes.", result: "Les r√©cits activent les m√™mes circuits c√©r√©braux que l'exp√©rience directe. Efficace.", impact: { efficacite: +25, empathie: +25 } },
                { text: "Le mettre en situation de vuln√©rabilit√©.", result: "Humilier cr√©e de la fermeture, pas de l'ouverture. Il activera plus de d√©sengagement.", impact: { efficacite: -20, empathie: -15 } },
                { text: "L'impliquer dans une action d'aide envers la cible.", result: "L'action pr√©c√®de parfois l'√©motion. Principe de la Pr√©occupation Partag√©e.", impact: { efficacite: +20, empathie: +20 } }
            ]}
        ];

        function encodeSaveCode(data) { return btoa(JSON.stringify(data)); }
        function decodeSaveCode(code) { try { return JSON.parse(atob(code)); } catch { return null; } }
        function getMasteryLevel(score) {
            if (score >= 400) return { level: "Briseur de Cycles", class: "mastery-expert" };
            if (score >= 250) return { level: "Intervenant Confirm√©", class: "mastery-confirmed" };
            return { level: "En formation", class: "mastery-training" };
        }

        function App() {
            const [gameState, setGameState] = useState("unlock");
            const [playerData, setPlayerData] = useState({ name: "", class: "", score: 0, xp: 0, quizScore: 0, scenarioScore: 0, finished: false });
            const [unlockCode, setUnlockCode] = useState("");
            const [unlockError, setUnlockError] = useState("");
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            function verifyUnlockCode() {
                const decoded = decodeSaveCode(unlockCode);
                if (!decoded) { setUnlockError("Code invalide."); return; }
                if (decoded.m !== PREREQUISITE_MODULE) { setUnlockError(`Code du module ${decoded.m}. Il te faut celui de ${PREREQUISITE_MODULE}.`); return; }
                if (!decoded.f) { setUnlockError("Module pr√©c√©dent non termin√©."); return; }
                setPlayerData(prev => ({ ...prev, name: decoded.n || "", class: decoded.c || "" }));
                setGameState("intro");
            }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({ ...prev, xp: prev.xp + 18 }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({ ...prev, xp: prev.xp + 80 }));
                }
            }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                if (selectedAnswer === quizData[currentQuiz].correct) {
                    setPlayerData(prev => ({ ...prev, score: prev.score + 45, quizScore: prev.quizScore + 45, xp: prev.xp + 45 }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({ ...prev, xp: prev.xp + 90 }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                const choice = scenarioData[currentScenario].choices[index];
                const totalChange = Math.max(0, Object.values(choice.impact).reduce((a, b) => a + b, 0));
                setPlayerData(prev => ({ ...prev, score: prev.score + totalChange, scenarioScore: prev.scenarioScore + totalChange, xp: prev.xp + 35 }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    setPlayerData(prev => ({ ...prev, finished: true, xp: prev.xp + 100 }));
                    setGameState("complete");
                }
            }

            function generateSaveCode() {
                return encodeSaveCode({ v: 1, d: new Date().toISOString(), m: MODULE_ID, n: playerData.name, c: playerData.class, s: playerData.score, x: playerData.xp, f: true });
            }

            function copyCode() { navigator.clipboard.writeText(generateSaveCode()).then(() => alert("Code copi√© !")); }

            if (gameState === "unlock") {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "‚õìÔ∏è"),
                        e("h1", { className: "glitch-title" }, "PIX-pHARe"),
                        e("div", { className: "subtitle" }, "Pilier Dynamiques de Groupe"),
                        e("div", { className: "module-badge" }, "MODULE 04 - VERROUILL√â")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üîê"),
                            e("div", { className: "panel-title" }, "Acc√®s Prot√©g√©")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "unlock-screen" },
                                e("div", { className: "lock-icon" }, "‚õìÔ∏è"),
                                e("h2", { className: "unlock-title" }, MODULE_TITLE),
                                e("p", { style: { color: "var(--text-secondary)", marginBottom: "20px" } }, "Code du Module 03 requis."),
                                e("input", { type: "text", className: "code-input", value: unlockCode, onChange: ev => setUnlockCode(ev.target.value), placeholder: "Code du Module 03..." }),
                                unlockError && e("div", { className: "error-msg" }, unlockError),
                                e("div", { style: { marginTop: "25px" } }, e("button", { className: "action-btn", onClick: verifyUnlockCode, disabled: !unlockCode.trim() }, "[ D√âVERROUILLER ]"))
                            )
                        )
                    )
                );
            }

            if (gameState === "intro") {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "‚õìÔ∏è"),
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Module 04"),
                        e("div", { className: "module-badge" }, "M√âTHODES D'INTERVENTION")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "üîß"),
                            e("div", { className: "panel-title" }, "De la th√©orie √† l'action")
                        ),
                        e("div", { className: "panel-body" },
                            e("p", { style: { fontSize: "1.1rem", marginBottom: "20px" } }, e("strong", null, playerData.name), ", tu connais les m√©canismes. Maintenant : les ", e("strong", { style: { color: "var(--break-emerald)" } }, "OUTILS QUI MARCHENT"), "."),
                            e("div", { style: { textAlign: "center", margin: "25px 0" } },
                                e("span", { className: "data-box" }, e("span", { className: "label" }, "R√©duction"), " -19%"),
                                e("span", { className: "data-box" }, e("span", { className: "label" }, "Victimation"), " -16%")
                            ),
                            e("p", { style: { marginBottom: "20px" } }, "Les programmes efficaces ciblent le ", e("strong", null, "groupe"), ", pas seulement l'individu. Ils d√©veloppent des ", e("strong", null, "comp√©tences"), ", pas seulement des sanctions."),
                            e("div", { style: { textAlign: "center", marginTop: "30px" } }, e("button", { className: "action-btn", onClick: () => setGameState("flashcards") }, "[ COMMENCER ]"))
                        )
                    )
                );
            }

            if (gameState === "flashcards") {
                const card = flashcardsData[currentFlashcard];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" }, e("h1", { className: "glitch-title" }, MODULE_TITLE), e("div", { className: "subtitle" }, "Niveau 1 : Les M√©thodes")),
                    e("div", { className: "progress-bar" }, e("div", { className: "progress-node active" }, "1"), e("div", { className: "progress-node" }, "2"), e("div", { className: "progress-node" }, "3")),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "M√©thode"), e("div", { className: "xp-value" }, `${currentFlashcard + 1}/${flashcardsData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" }, e("div", { className: "panel-icon" }, "üîß"), e("div", { className: "panel-title" }, "Bo√Æte √† Outils")),
                        e("div", { className: "panel-body" },
                            e("div", { className: "flashcard-container" },
                                e("div", { className: `flashcard ${flashcardFlipped ? "flipped" : ""}`, onClick: () => setFlashcardFlipped(!flashcardFlipped) },
                                    e("div", { className: "flashcard-face flashcard-front" },
                                        e("div", { className: "flashcard-category" }, card.category),
                                        e("div", { className: "flashcard-question" }, card.question),
                                        e("div", { className: "flashcard-hint" }, card.hint)
                                    ),
                                    e("div", { className: "flashcard-face flashcard-back" },
                                        e("div", { className: "flashcard-category", style: { background: "var(--chain-broken)" } }, "ACQUIS"),
                                        e("div", { className: "flashcard-answer", dangerouslySetInnerHTML: { __html: card.answer } })
                                    )
                                )
                            ),
                            e("div", { className: "flashcard-nav" },
                                e("button", { className: "nav-btn", onClick: () => { setCurrentFlashcard(prev => prev - 1); setFlashcardFlipped(false); }, disabled: currentFlashcard === 0 }, "‚óÑ PR√âC"),
                                e("button", { className: "nav-btn", onClick: nextFlashcard }, currentFlashcard < flashcardsData.length - 1 ? "SUIV ‚ñ∫" : "NIVEAU 2 ‚ñ∫")
                            )
                        )
                    )
                );
            }

            if (gameState === "quiz") {
                const question = quizData[currentQuiz];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" }, e("h1", { className: "glitch-title" }, MODULE_TITLE), e("div", { className: "subtitle" }, "Niveau 2 : Strat√©gie")),
                    e("div", { className: "progress-bar" }, e("div", { className: "progress-node completed" }, "‚úì"), e("div", { className: "progress-node active" }, "2"), e("div", { className: "progress-node" }, "3")),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.quizScore)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Question"), e("div", { className: "xp-value" }, `${currentQuiz + 1}/${quizData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" }, e("div", { className: "panel-icon" }, "üéØ"), e("div", { className: "panel-title" }, "Choix Strat√©giques")),
                        e("div", { className: "panel-body" },
                            e("div", { className: "quiz-question" }, question.question),
                            e("div", { className: "quiz-options" },
                                question.options.map((opt, idx) => {
                                    let optClass = "quiz-option";
                                    if (showQuizFeedback) { if (idx === question.correct) optClass += " correct"; else if (idx === selectedAnswer) optClass += " incorrect"; }
                                    else if (idx === selectedAnswer) optClass += " selected";
                                    return e("div", { key: idx, className: optClass, onClick: () => { if (!showQuizFeedback) setSelectedAnswer(idx); } },
                                        e("div", { className: "option-marker" }, String.fromCharCode(65 + idx)),
                                        e("div", { className: "option-text" }, opt)
                                    );
                                })
                            ),
                            showQuizFeedback && e("div", { className: `feedback-box ${selectedAnswer !== question.correct ? "incorrect-feedback" : ""}` },
                                e("div", { className: "feedback-title" }, selectedAnswer === question.correct ? "‚úì STRAT√âGIE VALID√âE" : "‚úó √Ä REVOIR"),
                                e("p", null, question.feedback)
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                !showQuizFeedback ? e("button", { className: "action-btn", onClick: validateQuizAnswer, disabled: selectedAnswer === null }, "[ VALIDER ]") :
                                e("button", { className: "action-btn", onClick: nextQuizQuestion }, currentQuiz < quizData.length - 1 ? "[ SUIVANT ]" : "[ NIVEAU 3 ]")
                            )
                        )
                    )
                );
            }

            if (gameState === "scenarios") {
                const scenario = scenarioData[currentScenario];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" }, e("h1", { className: "glitch-title" }, MODULE_TITLE), e("div", { className: "subtitle" }, "Niveau 3 : Intervention")),
                    e("div", { className: "progress-bar" }, e("div", { className: "progress-node completed" }, "‚úì"), e("div", { className: "progress-node completed" }, "‚úì"), e("div", { className: "progress-node active" }, "3")),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP Total"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.score)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Sc√©nario"), e("div", { className: "xp-value" }, `${currentScenario + 1}/${scenarioData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" }, e("div", { className: "panel-icon" }, "‚ö°"), e("div", { className: "panel-title" }, scenario.title)),
                        e("div", { className: "panel-body" },
                            e("div", { className: "scenario-context" }, scenario.context),
                            e("div", { className: "scenario-intro" }, scenario.intro),
                            !showScenarioResult ? e("div", null, scenario.choices.map((choice, idx) => e("button", { key: idx, className: "choice-btn", onClick: () => makeScenarioChoice(idx) }, choice.text))) :
                            e("div", { className: "choice-result" },
                                e("p", { style: { marginBottom: "15px", lineHeight: "1.7" } }, scenario.choices[scenarioChoice].result),
                                e("div", { className: "impact-score" }, Object.entries(scenario.choices[scenarioChoice].impact).map(([key, val]) => e("div", { key: key, className: `impact-item ${val > 0 ? "positive" : "negative"}` }, `${key}: ${val > 0 ? "+" : ""}${val}`))),
                                e("div", { style: { textAlign: "center", marginTop: "25px" } }, e("button", { className: "action-btn", onClick: nextScenario }, currentScenario < scenarioData.length - 1 ? "[ SUIVANT ]" : "[ TERMINER ]"))
                            )
                        )
                    )
                );
            }

            if (gameState === "complete") {
                const mastery = getMasteryLevel(playerData.score);
                return e("div", { className: "app-container" },
                    e("div", { className: "completion-screen" },
                        e("div", { className: "completion-icon" }, "üîì"),
                        e("h1", { className: "completion-title" }, "CYCLE BRIS√â"),
                        e("p", { style: { fontSize: "1.2rem", color: "var(--text-secondary)", marginBottom: "15px" } }, `Bravo ${playerData.name} ! Tu ma√Ætrises les m√©thodes d'intervention.`),
                        e("div", { className: `mastery-badge ${mastery.class}` }, mastery.level),
                        e("div", { className: "stats-grid" },
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.score), e("div", { className: "stat-label" }, "Score Total")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.xp), e("div", { className: "stat-label" }, "XP Gagn√©s")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.quizScore), e("div", { className: "stat-label" }, "Strat√©gie")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.scenarioScore), e("div", { className: "stat-label" }, "Intervention"))
                        ),
                        e("div", { className: "save-code-box" },
                            e("div", { className: "save-code-label" }, "üìã TON CODE (Module 05 - CERTIFICATION) :"),
                            e("div", { className: "save-code" }, generateSaveCode()),
                            e("button", { className: "copy-btn", onClick: copyCode }, "Copier le code")
                        ),
                        e("div", { className: "content-panel", style: { marginTop: "30px", textAlign: "left" } },
                            e("div", { className: "panel-header" }, e("div", { className: "panel-icon" }, "üéì"), e("div", { className: "panel-title" }, "Comp√©tences acquises")),
                            e("div", { className: "panel-body" },
                                e("p", null, "Tu ma√Ætrises KiVa, Pr√©occupation Partag√©e, approches restauratives."),
                                e("p", { style: { marginTop: "15px" } }, "Module 05 = ", e("strong", { style: { color: "var(--break-cyan)" } }, "CERTIFICATION"), " du pilier Dynamiques de Groupe.")
                            )
                        )
                    )
                );
            }

            return null;
        }

        ReactDOM.createRoot(document.getElementById("root")).render(e(App));
    </script>
</body>
</html>
