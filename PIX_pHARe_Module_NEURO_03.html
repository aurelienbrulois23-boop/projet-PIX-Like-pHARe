<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module NEURO 03 - Mettre des Mots sur ses √âmotions</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --neuro-primary: #6b8e23;
            --neuro-accent: #9acd32;
            --neuro-warning: #ff6b6b;
            --neuro-success: #4ecdc4;
            --void-dark: #0d0d1a;
            --deep-dark: #080812;
            --panel-bg: rgba(13, 13, 26, 0.95);
            --text-primary: #f5f5ff;
            --text-secondary: #9999bb;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Brain pattern background */
        .brain-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(107, 142, 35, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(154, 205, 50, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Animated synapses */
        .synapse-lines {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.3;
        }
        
        .synapse-lines::before,
        .synapse-lines::after {
            content: '';
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--neuro-accent), transparent);
            height: 1px;
            width: 200px;
            animation: synapseMove 10s linear infinite;
        }
        
        .synapse-lines::before { top: 25%; left: -200px; }
        .synapse-lines::after { top: 75%; right: -200px; animation-delay: -5s; animation-direction: reverse; }
        
        @keyframes synapseMove {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 400px)); }
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(107, 142, 35, 0.6));
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--neuro-primary), var(--neuro-accent), var(--neuro-success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--neuro-accent);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 35px;
            background: linear-gradient(135deg, rgba(107, 142, 35, 0.2), rgba(154, 205, 50, 0.2));
            border: 2px solid var(--neuro-accent);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--neuro-accent);
            clip-path: polygon(10px 0%, calc(100% - 10px) 0%, 100% 50%, calc(100% - 10px) 100%, 10px 100%, 0% 50%);
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 60px; height: 60px;
            border: 3px solid var(--text-secondary);
            background: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .progress-node.active {
            border-color: var(--neuro-accent);
            color: var(--neuro-accent);
            box-shadow: 0 0 25px rgba(154, 205, 50, 0.5);
        }
        
        .progress-node.completed {
            border-color: var(--neuro-success);
            background: rgba(78, 205, 196, 0.2);
            color: var(--neuro-success);
        }
        
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 2px solid var(--neuro-accent);
            padding: 15px 25px;
            text-align: center;
            clip-path: polygon(8px 0%, calc(100% - 8px) 0%, 100% 8px, 100% calc(100% - 8px), calc(100% - 8px) 100%, 8px 100%, 0% calc(100% - 8px), 0% 8px);
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--neuro-accent);
        }
        
        .content-panel {
            background: var(--panel-bg);
            border: 2px solid rgba(107, 142, 35, 0.3);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--neuro-primary), var(--neuro-accent), var(--neuro-success));
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(107, 142, 35, 0.15), rgba(154, 205, 50, 0.1));
            padding: 18px 25px;
            border-bottom: 1px solid rgba(107, 142, 35, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--neuro-primary), var(--neuro-accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 50%;
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--neuro-accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .panel-body { padding: 25px; }
        
        /* Intro specific styles */
        .intro-screen { text-align: center; padding: 30px 20px; }
        
        .emotion-wheel {
            margin: 30px auto;
            max-width: 400px;
            padding: 20px;
            background: rgba(107, 142, 35, 0.05);
            border: 2px dashed var(--neuro-accent);
            border-radius: 10px;
        }
        
        /* Name input */
        .name-input-group {
            margin: 30px auto;
            max-width: 400px;
        }
        
        .name-input {
            width: 100%;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--neuro-accent);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .name-input:focus {
            outline: none;
            border-color: var(--neuro-success);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        
        .name-input::placeholder { color: var(--text-secondary); }
        
        /* Flashcards */
        .flashcard-container { perspective: 1200px; margin-bottom: 20px; }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 240px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute;
            width: 100%;
            min-height: 240px;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            border: 2px solid var(--neuro-accent);
            background: var(--panel-bg);
        }
        
        .card-back { transform: rotateY(180deg); }
        
        .card-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            color: var(--text-primary);
            text-align: center;
            line-height: 1.5;
        }
        
        .card-answer {
            font-size: 1.1rem;
            color: var(--neuro-accent);
            text-align: center;
            line-height: 1.7;
        }
        
        .card-source {
            margin-top: 15px;
            padding: 8px 15px;
            background: rgba(107, 142, 35, 0.2);
            border-left: 3px solid var(--neuro-primary);
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        /* Quiz styles */
        .quiz-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--text-primary);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .quiz-option {
            padding: 18px;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .quiz-option:hover { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.1); }
        .quiz-option.selected { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.2); }
        .quiz-option.correct { border-color: var(--neuro-success); background: rgba(78, 205, 196, 0.2); }
        .quiz-option.incorrect { border-color: var(--neuro-warning); background: rgba(255, 107, 107, 0.2); }
        
        .quiz-feedback {
            margin-top: 20px;
            padding: 20px;
            background: var(--panel-bg);
            border-left: 4px solid var(--neuro-accent);
            line-height: 1.7;
        }
        
        /* Scenario styles */
        .scenario-context {
            background: rgba(107, 142, 35, 0.1);
            padding: 20px;
            border-left: 4px solid var(--neuro-primary);
            margin-bottom: 20px;
            font-size: 1.05rem;
            line-height: 1.7;
        }
        
        .scenario-intro {
            font-size: 1.05rem;
            line-height: 1.7;
            margin-bottom: 25px;
            color: var(--text-secondary);
        }
        
        .scenario-choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .scenario-choice {
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            line-height: 1.6;
        }
        
        .scenario-choice:hover { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.1); }
        .scenario-choice.selected { border-color: var(--neuro-accent); background: rgba(107, 142, 35, 0.2); }
        
        .scenario-result {
            margin-top: 20px;
            padding: 25px;
            background: var(--panel-bg);
            border-left: 4px solid var(--neuro-success);
            line-height: 1.8;
        }
        
        /* Buttons */
        .btn {
            padding: 15px 35px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--neuro-accent);
            color: var(--deep-dark);
        }
        
        .btn:hover {
            background: var(--neuro-success);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--neuro-accent);
            color: var(--neuro-accent);
        }
        
        .btn-secondary:hover {
            background: var(--neuro-accent);
            color: var(--deep-dark);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        /* Final screen */
        .final-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .mastery-badge {
            display: inline-block;
            padding: 20px 40px;
            margin: 30px 0;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            border: 3px solid;
            clip-path: polygon(10px 0%, calc(100% - 10px) 0%, 100% 50%, calc(100% - 10px) 100%, 10px 100%, 0% 50%);
        }
        
        .mastery-expert { border-color: var(--neuro-success); color: var(--neuro-success); background: rgba(78, 205, 196, 0.2); }
        .mastery-confirmed { border-color: var(--neuro-accent); color: var(--neuro-accent); background: rgba(154, 205, 50, 0.2); }
        .mastery-training { border-color: var(--neuro-primary); color: var(--neuro-primary); background: rgba(107, 142, 35, 0.2); }
        
        .save-code-box {
            background: var(--deep-dark);
            border: 2px solid var(--neuro-success);
            padding: 20px;
            margin: 30px auto;
            max-width: 600px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            color: var(--neuro-success);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .save-code-box:hover {
            background: rgba(78, 205, 196, 0.1);
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }
        
        /* Utilities */
        .info { color: var(--neuro-accent); font-weight: 600; }
        .warning { color: var(--neuro-warning); font-weight: 600; }
        .success { color: var(--neuro-success); font-weight: 600; }
        
        @media (max-width: 768px) {
            .app-container { padding: 15px; }
            .glitch-title { font-size: 1.5rem; }
            .flashcard, .card-face { min-height: 200px; }
        }
    </style>
</head>
<body>
    <div class="brain-bg"></div>
    <div class="synapse-lines"></div>
    
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

        const MODULE_DATA = {
            id: "NEURO_03",
            version: "1.0.0",
            titre: "METTRE DES MOTS SUR SES √âMOTIONS",
            sous_titre: "Comprendre ce qui se passe en soi",
            description: "D√©couvrir pourquoi nommer ses √©motions permet de r√©duire la violence.",
            auteur: "Programme pHARe",
            niveau1: {
                titre: "De la cocotte-minute aux mots",
                type: "flashcards",
                xp_reward: 50,
                cartes: [
                    {
                        recto: "Avoir des √©motions, est-ce un probl√®me ?",
                        verso: "Non. Le probl√®me, c'est de ne pas savoir les comprendre ni les exprimer.",
                        source: "Psychologie √©motionnelle"
                    },
                    {
                        recto: "Qu'est-ce que l'alexithymie ?",
                        verso: "Une difficult√© √† identifier et nommer ses √©motions. Touche environ 10% de la population.",
                        source: "Recherche clinique"
                    },
                    {
                        recto: "Pourquoi nommer ses √©motions aide-t-il ?",
                        verso: "Cela active le cortex pr√©frontal qui r√©gule l'amygdale (centre √©motionnel). C'est l'effet 'labeling affect'.",
                        source: "Neurosciences affectives"
                    },
                    {
                        recto: "Quelle est la diff√©rence entre 'je suis en col√®re' et 'je suis mal' ?",
                        verso: "La pr√©cision permet au cerveau de mieux traiter l'√©motion et de trouver une r√©ponse adapt√©e.",
                        source: "Psychologie cognitive"
                    },
                    {
                        recto: "Les √©motions sont-elles bonnes ou mauvaises ?",
                        verso: "Ni l'un ni l'autre. Elles sont des informations sur nos besoins. C'est ce qu'on en fait qui compte.",
                        source: "Intelligence √©motionnelle"
                    },
                    {
                        recto: "Combien existe-t-il d'√©motions de base ?",
                        verso: "6 universelles selon Ekman : joie, tristesse, col√®re, peur, d√©go√ªt, surprise. Mais des centaines de nuances.",
                        source: "Paul Ekman, psychologie des √©motions"
                    },
                    {
                        recto: "Peut-on apprendre √† mieux nommer ses √©motions ?",
                        verso: "Oui ! C'est une comp√©tence qui se d√©veloppe avec la pratique et l'enrichissement du vocabulaire √©motionnel.",
                        source: "√âducation √©motionnelle"
                    }
                ]
            },
            niveau2: {
                titre: "Du flou √† la pr√©cision",
                type: "quiz",
                xp_reward: 100,
                questions: [
                    {
                        texte: "Un √©l√®ve dit : 'je suis mal'.",
                        question: "Que permet un mot plus pr√©cis ?",
                        choix: [
                            {
                                txt: "Mieux comprendre et mieux r√©agir",
                                correct: true,
                                feedback: "Exact. Le cerveau r√©gule mieux quand on nomme pr√©cis√©ment. 'Mal' peut cacher : tristesse, col√®re, honte, frustration, anxi√©t√©... Chacune n√©cessite une r√©ponse diff√©rente."
                            },
                            {
                                txt: "Rien, c'est pareil",
                                correct: false,
                                feedback: "Faux. La pr√©cision active le cortex pr√©frontal qui aide √† r√©guler l'√©motion. C'est prouv√© par imagerie c√©r√©brale."
                            }
                        ]
                    },
                    {
                        texte: "L√©o se sent '√©nerv√©' mais ne sait pas pourquoi.",
                        question: "Quelle question l'aide le mieux ?",
                        choix: [
                            {
                                txt: "'De quoi ai-je besoin l√† maintenant ?'",
                                correct: true,
                                feedback: "Excellent. Les √©motions signalent des besoins. √ânerv√© peut venir d'un besoin de respect, d'√©coute, de repos, etc. Identifier le besoin donne la cl√©."
                            },
                            {
                                txt: "'Qui m'a √©nerv√© ?'",
                                correct: false,
                                feedback: "Incomplet. Chercher un coupable externe emp√™che de comprendre SON propre besoin. L'√©motion est √Ä SOI m√™me si d√©clench√©e par autrui."
                            }
                        ]
                    },
                    {
                        texte: "Dans une dispute, quelqu'un dit 'tu me rends furieux !'",
                        question: "Quel est le probl√®me de cette formulation ?",
                        choix: [
                            {
                                txt: "Elle rend l'autre responsable de mon √©motion",
                                correct: true,
                                feedback: "Exact. Mieux : 'Je me sens furieux quand...' Prendre possession de son √©motion permet de la g√©rer. Les autres d√©clenchent, mais c'est notre cerveau qui ressent."
                            },
                            {
                                txt: "Aucun, c'est une bonne expression",
                                correct: false,
                                feedback: "Faux. Dire 'tu me rends' donne le pouvoir √† l'autre et emp√™che de s'auto-r√©guler. C'est une position de victime passive."
                            }
                        ]
                    },
                    {
                        texte: "Yasmina a un vocabulaire √©motionnel riche : anxieuse, frustr√©e, d√©√ßue, sereine...",
                        question: "Quel est l'avantage ?",
                        choix: [
                            {
                                txt: "Elle peut √™tre plus intelligente √©motionnellement",
                                correct: false,
                                feedback: "Pas faux mais incomplet. Le vocabulaire seul ne suffit pas, il faut aussi savoir quoi faire de ces √©motions."
                            },
                            {
                                txt: "Elle peut mieux identifier et communiquer ce qu'elle ressent",
                                correct: true,
                                feedback: "Exact. Plus de nuances = meilleure compr√©hension de soi + communication plus claire aux autres. C'est la granularit√© √©motionnelle."
                            }
                        ]
                    },
                    {
                        texte: "Tom r√©p√®te souvent 'je suis stress√©' pour tout.",
                        question: "Quel est le risque ?",
                        choix: [
                            {
                                txt: "Ne pas diff√©rencier anxi√©t√©, pression, urgence, peur",
                                correct: true,
                                feedback: "Exact. 'Stress√©' est devenu un mot fourre-tout. Diff√©rencier permet d'agir : anxi√©t√© ‚Üí respiration, pression ‚Üí organisation, peur ‚Üí s√©curisation."
                            },
                            {
                                txt: "Aucun, tant qu'il l'exprime",
                                correct: false,
                                feedback: "Insuffisant. Exprimer c'est bien, mais sans pr√©cision, on ne peut pas traiter efficacement la cause."
                            }
                        ]
                    }
                ]
            },
            niveau3: {
                titre: "Baisser la pression",
                type: "dojo",
                xp_reward: 150,
                scenarios: [
                    {
                        contexte: "Une √©motion monte tr√®s vite.",
                        question: "Quelle action est la plus efficace ?",
                        choix: [
                            {
                                txt: "Exploser imm√©diatement pour 'vider le sac'",
                                impact: -20,
                                level: "contre-productif",
                                feedback: "Mauvaise strat√©gie. L'explosion renforce le circuit √©motionnel et peut cr√©er des d√©g√¢ts relationnels. La cocotte-minute explose, elle ne se r√©gule pas."
                            },
                            {
                                txt: "Identifier pr√©cis√©ment ce que je ressens",
                                impact: 100,
                                level: "optimal",
                                feedback: "Exact. Nommer apaise. Processus : PAUSE ‚Üí 'Qu'est-ce que je ressens ?' ‚Üí Nommer pr√©cis√©ment ‚Üí Le cerveau pr√©frontal s'active et r√©gule l'amygdale. C'est l'affect labeling."
                            },
                            {
                                txt: "Ignorer compl√®tement l'√©motion",
                                impact: -15,
                                level: "inefficace",
                                feedback: "Dangereux. La r√©pression cr√©e une explosion diff√©r√©e. Les √©motions ignor√©es ne disparaissent pas, elles s'accumulent."
                            },
                            {
                                txt: "Respirer profond√©ment puis nommer",
                                impact: 95,
                                level: "tr√®s bon",
                                feedback: "Excellent combo. Respiration ‚Üí apaise le syst√®me nerveux. Puis nommer ‚Üí engage le cortex pr√©frontal. Double r√©gulation."
                            }
                        ]
                    },
                    {
                        contexte: "Un ami te demande '√ßa va ?' et tu sens que non, mais tu ne sais pas pourquoi.",
                        question: "Quelle r√©ponse t'aide le mieux ?",
                        choix: [
                            {
                                txt: "'Ouais √ßa va' (alors que non)",
                                impact: -10,
                                level: "√©vitement",
                                feedback: "Occasion manqu√©e. Tu te coupes de l'aide potentielle ET tu ne travailles pas sur ta propre compr√©hension."
                            },
                            {
                                txt: "'Non, je me sens... [pause pour identifier]... frustr√© je crois'",
                                impact: 100,
                                level: "optimal",
                                feedback: "Parfait. Tu : 1) Reconnais l'√©motion. 2) Cherches √† la nommer. 3) Ouvres la porte au soutien. C'est de la vuln√©rabilit√© courageuse."
                            },
                            {
                                txt: "'Tout va mal dans ma vie'",
                                impact: 10,
                                level: "impr√©cis",
                                feedback: "Trop vague et catastrophiste. √áa exprime un mal-√™tre mais n'aide ni toi ni l'autre √† comprendre pr√©cis√©ment."
                            }
                        ]
                    },
                    {
                        contexte: "Pendant un conflit, l'autre dit 'tu exag√®res toujours !'",
                        question: "Comment nommer ton √©motion aide ?",
                        choix: [
                            {
                                txt: "Dire 'Cette phrase me fait me sentir incompris et bless√©'",
                                impact: 95,
                                level: "tr√®s efficace",
                                feedback: "Excellent. Tu nommes pr√©cis√©ment (incompris + bless√©) ET tu utilises le 'je' sans attaquer. Tu gardes le contr√¥le de ta r√©gulation."
                            },
                            {
                                txt: "Crier 'Et toi tu m'√©nerves !'",
                                impact: -25,
                                level: "escalade",
                                feedback: "Escalade garantie. Pas de nommage pr√©cis, juste une contre-attaque. Le conflit s'aggrave."
                            },
                            {
                                txt: "Ne rien dire et partir",
                                impact: 5,
                                level: "protection minimale",
                                feedback: "Tu te prot√®ges (c'est bien) mais sans communiquer. L'autre ne saura jamais l'impact de ses mots. Le conflit n'est pas r√©solu."
                            }
                        ]
                    },
                    {
                        contexte: "Tu ressens une boule au ventre avant un contr√¥le.",
                        question: "Comment affiner la compr√©hension de cette sensation ?",
                        choix: [
                            {
                                txt: "Me demander : 'Est-ce de l'anxi√©t√©, de l'excitation, ou de la peur ?'",
                                impact: 100,
                                level: "optimal",
                                feedback: "Parfait. Granularit√© √©motionnelle. Anxi√©t√© ‚Üí techniques de respiration. Excitation ‚Üí canaliser l'√©nergie. Peur ‚Üí identifier la menace r√©elle. Chacune a sa r√©ponse."
                            },
                            {
                                txt: "Juste me dire 'je stresse' et passer √† autre chose",
                                impact: 20,
                                level: "insuffisant",
                                feedback: "Mieux que rien mais incomplet. 'Stresser' est trop vague pour trouver la bonne strat√©gie de r√©gulation."
                            },
                            {
                                txt: "Ignorer la sensation et me forcer √† r√©viser",
                                impact: -5,
                                level: "r√©pression",
                                feedback: "La sensation corporelle est une information. L'ignorer emp√™che de traiter la cause et peut amplifier le malaise."
                            }
                        ]
                    }
                ]
            }
        };

        const flashcardsData = MODULE_DATA.niveau1.cartes.map(c => ({
            question: c.recto,
            answer: c.verso,
            source: c.source
        }));

        const quizData = MODULE_DATA.niveau2.questions.map(q => ({
            question: q.texte + " " + q.question,
            options: q.choix.map(ch => ch.txt),
            correct: q.choix.findIndex(ch => ch.correct),
            feedback: q.choix.find(ch => ch.correct).feedback
        }));

        const scenarioData = MODULE_DATA.niveau3.scenarios.map(s => ({
            title: s.contexte,
            context: s.contexte,
            intro: s.question,
            choices: s.choix.map(ch => ({
                text: ch.txt,
                result: ch.feedback,
                impact: { regulation: ch.impact }
            }))
        }));

        function encodeSaveCode(data) { return btoa(JSON.stringify(data)); }
        function getMasteryLevel(score) {
            if (score >= 450) return { level: "Expert", class: "mastery-expert" };
            if (score >= 280) return { level: "Confirm√©", class: "mastery-confirmed" };
            return { level: "En formation", class: "mastery-training" };
        }

        function App() {
            const [gameState, setGameState] = useState("intro");
            const [playerData, setPlayerData] = useState({ 
                name: "", 
                class: "", 
                level: 1, 
                score: 0, 
                xp: 0, 
                quizScore: 0, 
                scenarioScore: 0, 
                flashcardsViewed: 0, 
                finished: false 
            });
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            function startGame() {
                if (playerData.name.trim()) setGameState("flashcards");
            }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({ 
                        ...prev, 
                        flashcardsViewed: Math.max(prev.flashcardsViewed, currentFlashcard + 2), 
                        xp: prev.xp + 12 
                    }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({ 
                        ...prev, 
                        level: 2, 
                        flashcardsViewed: flashcardsData.length, 
                        xp: prev.xp + 50 
                    }));
                }
            }

            function prevFlashcard() { 
                if (currentFlashcard > 0) { 
                    setCurrentFlashcard(prev => prev - 1); 
                    setFlashcardFlipped(false); 
                } 
            }

            function selectQuizAnswer(index) { 
                if (!showQuizFeedback) setSelectedAnswer(index); 
            }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                if (selectedAnswer === quizData[currentQuiz].correct) {
                    setPlayerData(prev => ({ 
                        ...prev, 
                        score: prev.score + 30, 
                        quizScore: prev.quizScore + 30, 
                        xp: prev.xp + 30 
                    }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({ ...prev, level: 3, xp: prev.xp + 60 }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                const choice = scenarioData[currentScenario].choices[index];
                const values = Object.values(choice.impact);
                const totalChange = Math.max(0, values.reduce((a, b) => a + b, 0));
                setPlayerData(prev => ({ 
                    ...prev, 
                    score: prev.score + totalChange, 
                    scenarioScore: prev.scenarioScore + totalChange, 
                    xp: prev.xp + 25 
                }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    finishModule();
                }
            }

            function finishModule() {
                setPlayerData(prev => ({ 
                    ...prev, 
                    finished: true, 
                    xp: prev.xp + 100 
                }));
                setGameState("final");
            }

            function generateSaveCode() {
                const saveData = {
                    v: MODULE_DATA.version,
                    d: new Date().toISOString(),
                    m: MODULE_DATA.id,
                    n: playerData.name,
                    c: playerData.class,
                    s: playerData.score,
                    x: playerData.xp,
                    f: playerData.finished
                };
                return encodeSaveCode(saveData);
            }

            function copySaveCode() {
                const code = generateSaveCode();
                navigator.clipboard.writeText(code).then(() => {
                    alert("‚úÖ Code copi√© dans le presse-papier !");
                });
            }

            // Render functions (IntroFlashcards, Quiz, Scenarios, Final)
            // [Le code des fonctions render est identique √† NEURO_02, je le r√©utilise]

            function renderIntro() {
                return (
                    <div className="intro-screen">
                        <div className="content-panel">
                            <div className="panel-body">
                                <h2 style={{fontSize: "1.8rem", marginBottom: "20px", color: "var(--neuro-accent)"}}>
                                    üí¨ {MODULE_DATA.titre}
                                </h2>
                                <p style={{fontSize: "1.1rem", lineHeight: "1.8", marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    {MODULE_DATA.description}
                                </p>
                                
                                <div className="emotion-wheel">
                                    <p style={{fontSize: "0.95rem", lineHeight: "1.6", color: "var(--text-primary)"}}>
                                        <strong>De "je suis mal" √† la pr√©cision :</strong><br/>
                                        Triste, frustr frustr√©, anxieux, d√©√ßu, bless√©, en col√®re, honteux, jaloux, seul...
                                        <br/><br/>
                                        Plus on a de mots, mieux on se comprend.
                                    </p>
                                </div>

                                <p style={{fontSize: "1rem", lineHeight: "1.6", marginTop: "30px", color: "var(--text-primary)"}}>
                                    <strong>Ce que tu vas d√©couvrir :</strong><br/>
                                    ‚Ä¢ Pourquoi nommer aide √† r√©guler<br/>
                                    ‚Ä¢ L'importance de la granularit√© √©motionnelle<br/>
                                    ‚Ä¢ Des techniques concr√®tes d'identification
                                </p>

                                <div className="name-input-group">
                                    <input 
                                        type="text" 
                                        className="name-input"
                                        placeholder="Ton pr√©nom"
                                        value={playerData.name}
                                        onChange={(e) => setPlayerData(prev => ({...prev, name: e.target.value}))}
                                    />
                                    <input 
                                        type="text" 
                                        className="name-input"
                                        placeholder="Ta classe (optionnel)"
                                        value={playerData.class}
                                        onChange={(e) => setPlayerData(prev => ({...prev, class: e.target.value}))}
                                    />
                                    <button 
                                        className="btn" 
                                        onClick={startGame}
                                        disabled={!playerData.name.trim()}
                                    >
                                        Commencer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderFlashcards() {
                const card = flashcardsData[currentFlashcard];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">üí¨</div>
                                <div className="panel-title">Niveau 1 : {MODULE_DATA.niveau1.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Carte {currentFlashcard + 1} / {flashcardsData.length}
                                </p>
                                
                                <div className="flashcard-container">
                                    <div 
                                        className={`flashcard ${flashcardFlipped ? 'flipped' : ''}`}
                                        onClick={() => setFlashcardFlipped(!flashcardFlipped)}
                                    >
                                        <div className="card-face">
                                            <div className="card-question">{card.question}</div>
                                            <p style={{marginTop: "20px", fontSize: "0.85rem", color: "var(--text-secondary)"}}>
                                                Clique pour retourner
                                            </p>
                                        </div>
                                        <div className="card-face card-back">
                                            <div className="card-answer">{card.answer}</div>
                                            {card.source && <div className="card-source">Source : {card.source}</div>}
                                        </div>
                                    </div>
                                </div>

                                <div className="btn-group">
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={prevFlashcard}
                                        disabled={currentFlashcard === 0}
                                    >
                                        ‚Üê Pr√©c√©dent
                                    </button>
                                    <button 
                                        className="btn" 
                                        onClick={nextFlashcard}
                                    >
                                        {currentFlashcard === flashcardsData.length - 1 ? "Passer au Quiz ‚Üí" : "Suivant ‚Üí"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderQuiz() {
                const quiz = quizData[currentQuiz];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">üéØ</div>
                                <div className="panel-title">Niveau 2 : {MODULE_DATA.niveau2.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Question {currentQuiz + 1} / {quizData.length}
                                </p>
                                
                                <div className="quiz-question">{quiz.question}</div>
                                
                                <div className="quiz-options">
                                    {quiz.options.map((option, index) => (
                                        <div
                                            key={index}
                                            className={`quiz-option ${
                                                selectedAnswer === index ? 'selected' : ''
                                            } ${
                                                showQuizFeedback && index === quiz.correct ? 'correct' : ''
                                            } ${
                                                showQuizFeedback && selectedAnswer === index && index !== quiz.correct ? 'incorrect' : ''
                                            }`}
                                            onClick={() => selectQuizAnswer(index)}
                                        >
                                            {option}
                                        </div>
                                    ))}
                                </div>

                                {showQuizFeedback && (
                                    <div className="quiz-feedback">
                                        <strong>
                                            {selectedAnswer === quiz.correct ? "‚úÖ Correct !" : "‚ùå Pas tout √† fait..."}
                                        </strong>
                                        <p style={{marginTop: "10px"}}>{quiz.feedback}</p>
                                    </div>
                                )}

                                <div className="btn-group">
                                    {!showQuizFeedback ? (
                                        <button 
                                            className="btn" 
                                            onClick={validateQuizAnswer}
                                            disabled={selectedAnswer === null}
                                        >
                                            Valider
                                        </button>
                                    ) : (
                                        <button className="btn" onClick={nextQuizQuestion}>
                                            {currentQuiz === quizData.length - 1 ? "Passer aux Sc√©narios ‚Üí" : "Question suivante ‚Üí"}
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            function renderScenarios() {
                const scenario = scenarioData[currentScenario];
                return (
                    <div>
                        <div className="content-panel">
                            <div className="panel-header">
                                <div className="panel-icon">‚ö°</div>
                                <div className="panel-title">Niveau 3 : {MODULE_DATA.niveau3.titre}</div>
                            </div>
                            <div className="panel-body">
                                <p style={{marginBottom: "20px", color: "var(--text-secondary)"}}>
                                    Sc√©nario {currentScenario + 1} / {scenarioData.length}
                                </p>
                                
                                <div className="scenario-context">
                                    <strong>Situation :</strong> {scenario.context}
                                </div>
                                
                                <div className="scenario-intro">{scenario.intro}</div>
                                
                                <div className="scenario-choices">
                                    {scenario.choices.map((choice, index) => (
                                        <div
                                            key={index}
                                            className={`scenario-choice ${scenarioChoice === index ? 'selected' : ''}`}
                                            onClick={() => !showScenarioResult && makeScenarioChoice(index)}
                                        >
                                            {choice.text}
                                        </div>
                                    ))}
                                </div>

                                {showScenarioResult && scenarioChoice !== null && (
                                    <div className="scenario-result">
                                        <strong>Analyse :</strong>
                                        <p style={{marginTop: "10px"}}>
                                            {scenario.choices[scenarioChoice].result}
                                        </p>
                                    </div>
                                )}

                                {showScenarioResult && (
                                    <div className="btn-group">
                                        <button className="btn" onClick={nextScenario}>
                                            {currentScenario === scenarioData.length - 1 ? "Terminer le module ‚Üí" : "Sc√©nario suivant ‚Üí"}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            function renderFinal() {
                const mastery = getMasteryLevel(playerData.score);
                return (
                    <div className="final-screen">
                        <div className="content-panel">
                            <div className="panel-body">
                                <h2 style={{fontSize: "2rem", marginBottom: "20px", color: "var(--neuro-accent)"}}>
                                    üéì Module Compl√©t√© !
                                </h2>
                                
                                <p style={{fontSize: "1.2rem", marginBottom: "30px"}}>
                                    Bravo <strong>{playerData.name}</strong> !
                                </p>

                                <div className={`mastery-badge ${mastery.class}`}>
                                    {mastery.level}
                                </div>

                                <div className="xp-display">
                                    <div className="xp-box">
                                        <div className="xp-label">Score Total</div>
                                        <div className="xp-value">{playerData.score}</div>
                                    </div>
                                    <div className="xp-box">
                                        <div className="xp-label">XP Gagn√©</div>
                                        <div className="xp-value">{playerData.xp}</div>
                                    </div>
                                </div>

                                <p style={{margin: "30px 0", lineHeight: "1.8", color: "var(--text-secondary)"}}>
                                    Tu as d√©couvert le pouvoir des mots pour r√©guler tes √©motions.
                                    <br/>
                                    <strong style={{color: "var(--neuro-accent)"}}>
                                        Plus tu nommes pr√©cis√©ment, mieux tu te comprends !
                                    </strong>
                                </p>

                                <div className="save-code-box" onClick={copySaveCode}>
                                    <div style={{fontSize: "0.85rem", marginBottom: "10px", color: "var(--text-secondary)"}}>
                                        üìã CODE DE VALIDATION (clique pour copier)
                                    </div>
                                    <div style={{fontSize: "0.9rem", wordBreak: "break-all"}}>
                                        {generateSaveCode()}
                                    </div>
                                </div>

                                <p style={{fontSize: "0.9rem", color: "var(--text-secondary)"}}>
                                    Copie ce code et valide-le sur le hub PIXHARe pour d√©bloquer le niveau suivant.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            // Main render
            return (
                <div className="app-container">
                    <div className="header">
                        <div className="pillar-icon">üí¨</div>
                        <h1 className="glitch-title">{MODULE_DATA.titre}</h1>
                        <div className="subtitle">{MODULE_DATA.sous_titre}</div>
                        <div className="module-badge">PILIER NEURO & EMPATHIE</div>
                    </div>

                    {gameState !== "intro" && (
                        <>
                            <div className="progress-bar">
                                <div className={`progress-node ${playerData.level >= 1 ? 'completed' : ''} ${playerData.level === 1 && gameState === 'flashcards' ? 'active' : ''}`}>
                                    1
                                </div>
                                <div className={`progress-node ${playerData.level >= 2 ? 'completed' : ''} ${playerData.level === 2 && gameState === 'quiz' ? 'active' : ''}`}>
                                    2
                                </div>
                                <div className={`progress-node ${playerData.level >= 3 ? 'completed' : ''} ${playerData.level === 3 && gameState === 'scenarios' ? 'active' : ''}`}>
                                    3
                                </div>
                            </div>

                            <div className="xp-display">
                                <div className="xp-box">
                                    <div className="xp-label">Score</div>
                                    <div className="xp-value">{playerData.score}</div>
                                </div>
                                <div className="xp-box">
                                    <div className="xp-label">XP</div>
                                    <div className="xp-value">{playerData.xp}</div>
                                </div>
                            </div>
                        </>
                    )}

                    {gameState === "intro" && renderIntro()}
                    {gameState === "flashcards" && renderFlashcards()}
                    {gameState === "quiz" && renderQuiz()}
                    {gameState === "scenarios" && renderScenarios()}
                    {gameState === "final" && renderFinal()}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
