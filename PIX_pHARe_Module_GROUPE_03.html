<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIX-pHARe | Module GROUPE 03 - Les PiÃ¨ges de l'Esprit</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Share+Tech+Mono&display=swap');
        
        :root {
            --trap-red: #dc2626;
            --trap-orange: #ea580c;
            --trap-amber: #d97706;
            --awareness-cyan: #06b6d4;
            --clarity-white: #f0f9ff;
            --void-dark: #0a0a12;
            --deep-dark: #050508;
            --panel-bg: rgba(10, 10, 18, 0.95);
            --text-primary: #f0f0ff;
            --text-secondary: #8888aa;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .mind-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(220, 38, 38, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, rgba(6, 182, 212, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Neural network pattern */
        .neural-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(220, 38, 38, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 80% 40%, rgba(6, 182, 212, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 40% 80%, rgba(234, 88, 12, 0.1) 1px, transparent 1px);
            background-size: 100px 100px, 150px 150px, 120px 120px;
            pointer-events: none;
            z-index: 0;
            animation: neuralPulse 10s ease-in-out infinite;
        }
        
        @keyframes neuralPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .app-container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
        }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 15px rgba(220, 38, 38, 0.6));
            animation: brainPulse 3s ease-in-out infinite;
        }
        
        @keyframes brainPulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(220, 38, 38, 0.6)); }
            50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(6, 182, 212, 0.8)); }
        }
        
        .glitch-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--trap-red), var(--awareness-cyan), var(--trap-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 3px;
        }
        
        .subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 1rem;
            color: var(--trap-orange);
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .module-badge {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 35px;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(6, 182, 212, 0.2));
            border: 2px solid var(--trap-orange);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--trap-orange);
        }
        
        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .progress-node {
            width: 55px; height: 55px;
            border: 3px solid var(--text-secondary);
            background: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-secondary);
            position: relative;
            transition: all 0.4s ease;
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }
        
        .progress-node.active {
            border-color: var(--trap-orange);
            color: var(--trap-orange);
            box-shadow: 0 0 25px rgba(234, 88, 12, 0.5);
        }
        
        .progress-node.completed {
            border-color: var(--awareness-cyan);
            background: rgba(6, 182, 212, 0.2);
            color: var(--awareness-cyan);
        }
        
        .xp-display {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .xp-box {
            background: var(--panel-bg);
            border: 2px solid var(--trap-orange);
            padding: 15px 25px;
            text-align: center;
        }
        
        .xp-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .xp-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--trap-orange);
        }
        
        .content-panel {
            background: var(--panel-bg);
            border: 2px solid rgba(234, 88, 12, 0.3);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .content-panel::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--trap-red), var(--trap-orange), var(--trap-amber), var(--awareness-cyan));
        }
        
        .panel-header {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(6, 182, 212, 0.05));
            padding: 18px 25px;
            border-bottom: 1px solid rgba(234, 88, 12, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .panel-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--trap-red), var(--awareness-cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--trap-orange);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .panel-body { padding: 25px; }
        
        /* Unlock */
        .unlock-screen { text-align: center; padding: 40px 20px; }
        
        .lock-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: brainPulse 3s ease-in-out infinite;
        }
        
        .unlock-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--trap-orange);
            margin-bottom: 15px;
        }
        
        .code-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--trap-orange);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            margin: 20px auto;
            display: block;
        }
        
        .code-input:focus {
            outline: none;
            border-color: var(--awareness-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }
        
        .error-msg {
            color: var(--trap-red);
            font-family: 'Share Tech Mono', monospace;
            margin-top: 15px;
            padding: 10px;
            border: 1px solid var(--trap-red);
            background: rgba(220, 38, 38, 0.1);
        }
        
        /* Mechanism cards */
        .mechanism-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 25px 0;
        }
        
        .mechanism-mini {
            padding: 12px 8px;
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid var(--trap-red);
            text-align: center;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.7rem;
            color: var(--trap-orange);
            text-transform: uppercase;
        }
        
        .mechanism-mini.highlighted {
            background: rgba(6, 182, 212, 0.2);
            border-color: var(--awareness-cyan);
            color: var(--awareness-cyan);
        }
        
        /* Trap indicator */
        .trap-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(220, 38, 38, 0.15);
            border: 1px solid var(--trap-red);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            color: var(--trap-red);
            margin: 5px;
        }
        
        .trap-indicator.neutralized {
            background: rgba(6, 182, 212, 0.15);
            border-color: var(--awareness-cyan);
            color: var(--awareness-cyan);
            text-decoration: line-through;
        }
        
        /* Flashcards */
        .flashcard-container { perspective: 1200px; margin-bottom: 20px; }
        
        .flashcard {
            position: relative;
            width: 100%;
            min-height: 280px;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .flashcard.flipped { transform: rotateY(180deg); }
        
        .flashcard-face {
            position: absolute;
            width: 100%;
            min-height: 280px;
            backface-visibility: hidden;
            border: 2px solid var(--trap-orange);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 25px;
            background: var(--deep-dark);
        }
        
        .flashcard-front {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(234, 88, 12, 0.05));
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(220, 38, 38, 0.05));
            border-color: var(--awareness-cyan);
        }
        
        .flashcard-mechanism {
            position: absolute;
            top: 15px; right: 15px;
            padding: 8px 18px;
            background: var(--trap-red);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .flashcard-number {
            position: absolute;
            top: 15px; left: 15px;
            width: 35px; height: 35px;
            background: var(--trap-orange);
            color: var(--deep-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.1rem;
        }
        
        .flashcard-phrase {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--trap-red);
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .flashcard-question {
            font-size: 1rem;
            color: var(--trap-orange);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .flashcard-hint {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--awareness-cyan);
            text-align: center;
        }
        
        .flashcard-answer {
            font-size: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
        }
        
        .flashcard-answer strong { color: var(--awareness-cyan); }
        .flashcard-answer .trap { color: var(--trap-red); }
        .flashcard-answer .counter { color: var(--awareness-cyan); font-style: italic; }
        
        .flashcard-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            background: transparent;
            border: 2px solid var(--trap-orange);
            color: var(--trap-orange);
            padding: 12px 30px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .nav-btn:hover {
            background: rgba(234, 88, 12, 0.2);
            box-shadow: 0 0 15px rgba(234, 88, 12, 0.4);
        }
        
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        
        /* Quiz */
        .quiz-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(6, 182, 212, 0.05));
            border-left: 4px solid var(--trap-orange);
        }
        
        .quiz-phrase {
            display: block;
            font-style: italic;
            color: var(--trap-red);
            margin-top: 10px;
            padding: 10px;
            background: rgba(220, 38, 38, 0.1);
            border: 1px dashed var(--trap-red);
        }
        
        .quiz-options { display: flex; flex-direction: column; gap: 12px; }
        
        .quiz-option {
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-option:hover:not(.selected):not(.correct):not(.incorrect) {
            border-color: var(--trap-orange);
            background: rgba(234, 88, 12, 0.1);
            transform: translateX(5px);
        }
        
        .quiz-option.selected { border-color: var(--trap-orange); background: rgba(234, 88, 12, 0.15); }
        .quiz-option.correct { border-color: var(--awareness-cyan); background: rgba(6, 182, 212, 0.2); }
        .quiz-option.incorrect { border-color: var(--trap-red); background: rgba(220, 38, 38, 0.15); }
        
        .option-marker {
            width: 35px; height: 35px;
            border: 2px solid currentColor;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }
        
        .option-text { flex: 1; font-size: 0.95rem; }
        
        .feedback-box {
            margin-top: 20px;
            padding: 20px;
            border-left: 4px solid var(--awareness-cyan);
            background: rgba(6, 182, 212, 0.1);
        }
        
        .feedback-box.incorrect-feedback {
            border-color: var(--trap-red);
            background: rgba(220, 38, 38, 0.1);
        }
        
        .feedback-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--awareness-cyan);
            margin-bottom: 10px;
        }
        
        .feedback-box.incorrect-feedback .feedback-title { color: var(--trap-red); }
        
        /* Scenario */
        .scenario-intro {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), rgba(6, 182, 212, 0.05));
            border: 1px solid rgba(234, 88, 12, 0.3);
        }
        
        .scenario-context {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--trap-orange);
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(234, 88, 12, 0.1);
            border: 1px dashed var(--trap-orange);
        }
        
        .detected-traps {
            margin: 20px 0;
            padding: 15px;
            background: var(--deep-dark);
            border: 2px solid var(--trap-red);
        }
        
        .detected-traps-title {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
            color: var(--trap-red);
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .choice-btn {
            display: block;
            width: 100%;
            background: var(--deep-dark);
            border: 2px solid var(--text-secondary);
            padding: 18px 20px;
            margin-bottom: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }
        
        .choice-btn:hover {
            border-color: var(--trap-orange);
            background: rgba(234, 88, 12, 0.1);
            transform: translateX(5px);
        }
        
        .choice-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--deep-dark);
            border: 2px solid var(--awareness-cyan);
        }
        
        .impact-score {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .impact-item {
            padding: 8px 15px;
            background: rgba(234, 88, 12, 0.1);
            border: 1px solid var(--trap-orange);
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85rem;
        }
        
        .impact-item.positive { border-color: var(--awareness-cyan); color: var(--awareness-cyan); }
        .impact-item.negative { border-color: var(--trap-red); color: var(--trap-red); }
        
        .action-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--trap-orange), var(--awareness-cyan));
            color: var(--deep-dark);
            border: none;
            padding: 15px 40px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(234, 88, 12, 0.5);
        }
        
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        /* Completion */
        .completion-screen { text-align: center; padding: 50px 20px; }
        
        .completion-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: brainPulse 3s ease-in-out infinite;
        }
        
        .completion-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--trap-orange), var(--awareness-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--panel-bg);
            border: 2px solid var(--trap-orange);
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--trap-orange);
        }
        
        .stat-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .save-code-box {
            background: var(--deep-dark);
            border: 2px solid var(--awareness-cyan);
            padding: 25px;
            margin: 30px 0;
        }
        
        .save-code-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            color: var(--awareness-cyan);
            margin-bottom: 10px;
        }
        
        .save-code {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.75rem;
            color: var(--trap-orange);
            word-break: break-all;
            background: rgba(234, 88, 12, 0.1);
            padding: 15px;
            border: 1px dashed var(--trap-orange);
        }
        
        .copy-btn {
            margin-top: 15px;
            background: transparent;
            border: 2px solid var(--awareness-cyan);
            color: var(--awareness-cyan);
            padding: 10px 25px;
            font-family: 'Share Tech Mono', monospace;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover { background: rgba(6, 182, 212, 0.2); }
        
        .mastery-badge {
            display: inline-block;
            padding: 10px 25px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            border: 2px solid;
            margin-top: 15px;
        }
        
        .mastery-expert { color: var(--awareness-cyan); border-color: var(--awareness-cyan); box-shadow: 0 0 20px rgba(6, 182, 212, 0.5); }
        .mastery-confirmed { color: var(--trap-orange); border-color: var(--trap-orange); }
        .mastery-training { color: var(--text-secondary); border-color: var(--text-secondary); }
        
        @media (max-width: 600px) {
            .glitch-title { font-size: 1.5rem; }
            .progress-node { width: 45px; height: 45px; font-size: 1rem; }
            .panel-body { padding: 15px; }
            .flashcard-face { padding: 20px 15px; min-height: 300px; }
            .mechanism-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="mind-bg"></div>
    <div class="neural-overlay"></div>
    
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script>
        const { useState } = React;
        const e = React.createElement;

        const MODULE_ID = "GROUPE_03";
        const MODULE_VERSION = "1.0";
        const MODULE_TITLE = "Les PiÃ¨ges de l'Esprit";
        const PREREQUISITE_MODULE = "GROUPE_02";
        
        // The 8 Bandura mechanisms + examples from research
        const mechanismsList = [
            "Justification morale",
            "Ã‰tiquetage euphÃ©misant", 
            "Comparaison avantageuse",
            "DÃ©placement responsabilitÃ©",
            "Diffusion responsabilitÃ©",
            "Distorsion consÃ©quences",
            "DÃ©shumanisation",
            "Attribution faute"
        ];
        
        const flashcardsData = [
            {
                num: 1,
                mechanism: "JUSTIFICATION MORALE",
                phrase: "Â« Je l'ai fait pour protÃ©ger la rÃ©putation du groupe. Â»",
                question: "Comment ce piÃ¨ge fonctionne-t-il ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Transforme l'agression en acte noble ou nÃ©cessaire. L'agresseur se voit comme un hÃ©ros qui fait ce qu'il faut. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>Humilier quelqu'un ne protÃ¨ge jamais rien. La 'rÃ©putation du groupe' n'est pas menacÃ©e par une personne diffÃ©rente.</span>"
            },
            {
                num: 2,
                mechanism: "Ã‰TIQUETAGE EUPHÃ‰MISANT",
                phrase: "Â« C'Ã©tait juste une blague. Â» Â« On s'amuse. Â»",
                question: "Pourquoi ce piÃ¨ge est-il si courant ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Utilise un langage neutre ou positif pour masquer la violence. 'Blague' semble inoffensif. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>Une blague fait rire TOUT LE MONDE, y compris la cible. Si la cible ne rit pas, ce n'est pas une blague, c'est une agression dÃ©guisÃ©e.</span>"
            },
            {
                num: 3,
                mechanism: "COMPARAISON AVANTAGEUSE",
                phrase: "Â« Je l'ai juste poussÃ©, je ne l'ai pas frappÃ©. Â»",
                question: "Comment ce mÃ©canisme minimise-t-il ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Minimise l'acte en le comparant Ã  pire. 'Au moins je n'ai pas fait X'. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>Ce n'est pas parce qu'il existe pire que ce que tu fais est acceptable. Pousser quelqu'un rÃ©guliÃ¨rement EST du harcÃ¨lement.</span>"
            },
            {
                num: 4,
                mechanism: "DÃ‰PLACEMENT DE RESPONSABILITÃ‰",
                phrase: "Â« Le prof ne dit rien, donc c'est permis. Â»",
                question: "Comment ce piÃ¨ge utilise-t-il l'autoritÃ© ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Attribue la responsabilitÃ© Ã  une autoritÃ©. Si l'autoritÃ© ne rÃ©agit pas, c'est qu'elle approuve. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>L'absence de sanction ne signifie pas approbation. Tu es responsable de TES actes, pas le prof. L'autoritÃ© peut simplement ne pas avoir vu.</span>"
            },
            {
                num: 5,
                mechanism: "DIFFUSION DE RESPONSABILITÃ‰",
                phrase: "Â« Tout le monde le dÃ©teste, pas seulement moi. Â»",
                question: "Comment le groupe dilue-t-il la faute ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Dilue la culpabilitÃ© dans le collectif. 'Je ne suis qu'UN parmi d'autres'. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>Si tout le monde saute d'un pont, tu sautes aussi ? ÃŠtre nombreux Ã  mal agir ne rend pas l'action juste. Tu es responsable de TA part.</span>"
            },
            {
                num: 6,
                mechanism: "DISTORSION DES CONSÃ‰QUENCES",
                phrase: "Â« Il/Elle en rajoute. Ã‡a ne fait pas si mal. Â»",
                question: "Comment ce piÃ¨ge nie-t-il la souffrance ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Nie ou minimise la souffrance de la cible. 'C'est pas si grave'. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>Tu n'es pas dans sa tÃªte. Tu ne peux pas dÃ©cider de ce qui fait mal Ã  quelqu'un d'autre. La rÃ©pÃ©tition fait que mÃªme des 'petites' choses deviennent insupportables.</span>"
            },
            {
                num: 7,
                mechanism: "DÃ‰SHUMANISATION",
                phrase: "Â« C'est un dÃ©chet / un cas / un boulet. Â»",
                question: "Pourquoi ce piÃ¨ge est-il le plus dangereux ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Retire les qualitÃ©s humaines Ã  la victime. Si elle n'est plus 'humaine', la maltraiter ne pose plus de problÃ¨me moral. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>DerriÃ¨re chaque surnom dÃ©gradant, il y a une personne avec des Ã©motions, une famille, des rÃªves. La dÃ©shumanisation est le mÃ©canisme de TOUTES les atrocitÃ©s historiques.</span>"
            },
            {
                num: 8,
                mechanism: "ATTRIBUTION DE LA FAUTE",
                phrase: "Â« C'est de sa faute s'il/elle est bizarre. Â»",
                question: "Comment ce piÃ¨ge inverse-t-il les rÃ´les ?",
                hint: "[ Cliquez pour comprendre ]",
                answer: "<span class='trap'>PIÃˆGE :</span> Rend la victime responsable de sa propre victimisation. 'Elle l'a cherchÃ©'. <strong>CONTRE-ARGUMENT :</strong> <span class='counter'>RIEN ne justifie le harcÃ¨lement. ÃŠtre 'diffÃ©rent' n'est pas une invitation Ã  Ãªtre maltraitÃ©. L'agresseur CHOISIT d'agresser, la cible ne choisit pas d'Ãªtre ciblÃ©e.</span>"
            }
        ];

        const quizData = [
            {
                question: "Identifie le mÃ©canisme de dÃ©sengagement moral :",
                phrase: "Â« De toute faÃ§on, tout le monde fait pareil dans la classe. Â»",
                options: [
                    "Justification morale",
                    "Diffusion de responsabilitÃ©",
                    "Comparaison avantageuse",
                    "DÃ©shumanisation"
                ],
                correct: 1,
                feedback: "C'est la DIFFUSION DE RESPONSABILITÃ‰. L'agresseur dilue sa culpabilitÃ© dans le groupe ('tout le monde'). Il se dÃ©responsabilise en se fondant dans la masse. Rappel : Ãªtre nombreux Ã  mal agir ne rend pas l'action juste."
            },
            {
                question: "Identifie le mÃ©canisme de dÃ©sengagement moral :",
                phrase: "Â« C'est juste du chambrage entre potes. Â»",
                options: [
                    "Ã‰tiquetage euphÃ©misant",
                    "DÃ©placement de responsabilitÃ©",
                    "Attribution de la faute",
                    "Distorsion des consÃ©quences"
                ],
                correct: 0,
                feedback: "C'est l'Ã‰TIQUETAGE EUPHÃ‰MISANT. Le mot 'chambrage' masque la violence rÃ©elle. 'Entre potes' suggÃ¨re que c'est amical. Mais si la cible souffre, ce n'est ni du chambrage ni entre potes."
            },
            {
                question: "Identifie le mÃ©canisme de dÃ©sengagement moral :",
                phrase: "Â« Si elle ne veut pas qu'on se moque d'elle, elle n'a qu'Ã  pas s'habiller comme Ã§a. Â»",
                options: [
                    "Comparaison avantageuse",
                    "Justification morale",
                    "Attribution de la faute",
                    "Distorsion des consÃ©quences"
                ],
                correct: 2,
                feedback: "C'est l'ATTRIBUTION DE LA FAUTE. L'agresseur inverse les rÃ´les : la victime 'mÃ©rite' ce qui lui arrive Ã  cause de son apparence. C'est du victim-blaming. RIEN ne justifie le harcÃ¨lement."
            },
            {
                question: "Identifie le mÃ©canisme de dÃ©sengagement moral :",
                phrase: "Â« Au moins je ne lui ai pas cassÃ© la figure. Â»",
                options: [
                    "Distorsion des consÃ©quences",
                    "Comparaison avantageuse",
                    "DÃ©placement de responsabilitÃ©",
                    "Ã‰tiquetage euphÃ©misant"
                ],
                correct: 1,
                feedback: "C'est la COMPARAISON AVANTAGEUSE. L'agresseur minimise son acte en le comparant Ã  pire. 'Au moins je n'ai pas fait X' ne rend pas Y acceptable. Le harcÃ¨lement verbal/social est aussi destructeur que le physique."
            },
            {
                question: "Quel mÃ©canisme est considÃ©rÃ© comme le plus dangereux car il est Ã  la base de toutes les atrocitÃ©s historiques ?",
                options: [
                    "La diffusion de responsabilitÃ©",
                    "L'Ã©tiquetage euphÃ©misant",
                    "La dÃ©shumanisation",
                    "La justification morale"
                ],
                correct: 2,
                feedback: "La DÃ‰SHUMANISATION. Quand on retire les qualitÃ©s humaines Ã  quelqu'un ('dÃ©chet', 'sous-merde', 'cas'), on court-circuite l'empathie. C'est le mÃ©canisme central de tous les gÃ©nocides et crimes de masse. Les surnoms dÃ©gradants en sont la forme quotidienne."
            }
        ];

        const scenarioData = [
            {
                title: "Le DÃ©tecteur de PiÃ¨ges",
                context: "Discussion dans la cour. Un groupe parle de Sofiane qui s'est fait 'chambrer'.",
                intro: "Tu entends : 'Franchement c'est pas mÃ©chant, c'est juste des vannes. Et puis il est bizarre aussi, il l'a un peu cherchÃ©. Tout le monde le dit de toute faÃ§on.' Combien de piÃ¨ges repÃ¨res-tu ?",
                traps: ["Ã‰tiquetage euphÃ©misant", "Attribution faute", "Diffusion responsabilitÃ©"],
                choices: [
                    { text: "Tu ne dis rien. Tu n'as pas envie de crÃ©er de problÃ¨me.", result: "Tu as identifiÃ© les piÃ¨ges mais tu n'as pas agi. C'est dÃ©jÃ  un premier pas de les reconnaÃ®tre. Mais sans action, les mÃ©canismes continuent de fonctionner.", impact: { detection: +10, action: -10 } },
                    { text: "Tu dis : 'Attendez... vous venez d'utiliser 3 techniques pour vous justifier lÃ .'", result: "Tu nommes les mÃ©canismes ! C'est la mÃ©thode de la MÃ‰TACOGNITION SOCIALE. En rendant visible le processus de dÃ©sengagement, tu forces les autres Ã  rÃ©flÃ©chir Ã  leurs propres justifications.", impact: { detection: +25, action: +30 } },
                    { text: "Tu rÃ©ponds : 'Une vanne Ã§a fait rire tout le monde. Sofiane rit ?'", result: "Tu attaques l'Ã©tiquetage euphÃ©misant avec une question simple mais puissante. Tu forces Ã  reconsidÃ©rer si c'est vraiment 'une vanne'. Technique socratique efficace.", impact: { detection: +20, action: +25 } },
                    { text: "Tu changes de sujet pour Ã©viter le conflit.", result: "Tu Ã©vites la confrontation mais les mÃ©canismes restent intacts. Le groupe continuera Ã  utiliser ces justifications. Parfois, nommer les choses est nÃ©cessaire.", impact: { detection: +5, action: -5 } }
                ]
            },
            {
                title: "Le Cercle Vicieux",
                context: "Recherche prouvÃ©e : le harcÃ¨lement AUGMENTE le dÃ©sengagement moral chez l'agresseur.",
                intro: "Plus on harcÃ¨le, plus on se dÃ©sensibilise, plus on harcÃ¨le... C'est un cercle vicieux. Comment briser ce cycle chez quelqu'un qui commence Ã  glisser ?",
                traps: null,
                choices: [
                    { text: "L'isoler et le punir sÃ©vÃ¨rement.", result: "La punition seule ne modifie pas les mÃ©canismes cognitifs. L'agresseur peut mÃªme utiliser le 'dÃ©placement de responsabilitÃ©' : 'C'est Ã  cause du systÃ¨me injuste'. Les recherches montrent que les approches punitives sont moins efficaces Ã  long terme.", impact: { efficacite: -10, comprehension: -15 } },
                    { text: "L'aider Ã  reconnaÃ®tre ses propres mÃ©canismes de justification.", result: "C'est l'approche de la RESTRUCTURATION COGNITIVE. En aidant l'agresseur Ã  voir comment il se justifie, on rÃ©active sa capacitÃ© d'autocensure morale. C'est ce que font les mÃ©thodes comme 'PrÃ©occupation PartagÃ©e'.", impact: { efficacite: +30, comprehension: +25 } },
                    { text: "Le confronter publiquement Ã  la souffrance de sa victime.", result: "RisquÃ©. Peut crÃ©er de la honte qui renforce la dÃ©fensivitÃ© et donc... le dÃ©sengagement moral. Mieux vaut une approche progressive et privÃ©e qui permet de 'sauver la face' tout en changeant.", impact: { efficacite: +5, comprehension: +10 } },
                    { text: "Ignorer car 'c'est son problÃ¨me'.", result: "Le cercle vicieux continue. L'agresseur se dÃ©sensibilise de plus en plus. Les recherches montrent que sans intervention, le dÃ©sengagement moral s'ancre et prÃ©dit des comportements antisociaux futurs.", impact: { efficacite: -20, comprehension: -20 } }
                ]
            },
            {
                title: "Le Miroir",
                context: "Tu rÃ©flÃ©chis Ã  tes propres paroles et pensÃ©es...",
                intro: "Sois honnÃªte. T'est-il arrivÃ© de penser ou dire : 'C'est bon, c'est juste pour rire' ou 'Il/elle est un peu chelou quand mÃªme' ? Ces phrases sont des signaux d'alerte.",
                traps: null,
                choices: [
                    { text: "Oui, mais c'Ã©tait diffÃ©rent dans mon cas.", result: "Attention ! Tu viens peut-Ãªtre d'utiliser la COMPARAISON AVANTAGEUSE ou la JUSTIFICATION MORALE. Le dÃ©sengagement moral est UNIVERSEL - tout le monde y est vulnÃ©rable. ReconnaÃ®tre qu'on l'utilise aussi est le premier pas.", impact: { honnetete: +15, lucidite: +10 } },
                    { text: "Oui, et maintenant je comprends que c'Ã©tait un piÃ¨ge.", result: "BRAVO. La luciditÃ© sur soi-mÃªme est la compÃ©tence la plus difficile et la plus prÃ©cieuse. ReconnaÃ®tre ses propres mÃ©canismes permet de les dÃ©sactiver AVANT d'agir. C'est la vraie 'mÃ©tacognition sociale'.", impact: { honnetete: +30, lucidite: +30 } },
                    { text: "Non, jamais. Je suis toujours bienveillantÂ·e.", result: "Hmm... Tout le monde utilise ces mÃ©canismes parfois, c'est humain. ÃŠtre certainÂ·e de ne jamais les utiliser pourrait Ãªtre... un mÃ©canisme de dÃ©sengagement en soi (justification morale de sa propre bontÃ©). Reste vigilantÂ·e !", impact: { honnetete: -10, lucidite: -5 } },
                    { text: "Je prÃ©fÃ¨re ne pas y penser.", result: "L'Ã©vitement est comprÃ©hensible mais contre-productif. Sans examen de conscience, les mÃ©canismes restent actifs en arriÃ¨re-plan. La luciditÃ© demande du courage.", impact: { honnetete: -5, lucidite: -15 } }
                ]
            }
        ];

        function encodeSaveCode(data) { return btoa(JSON.stringify(data)); }
        function decodeSaveCode(code) { try { return JSON.parse(atob(code)); } catch { return null; } }
        function getMasteryLevel(score) {
            if (score >= 450) return { level: "ImmunisÃ©", class: "mastery-expert" };
            if (score >= 280) return { level: "Vigilant", class: "mastery-confirmed" };
            return { level: "En Ã©veil", class: "mastery-training" };
        }

        function App() {
            const [gameState, setGameState] = useState("unlock");
            const [playerData, setPlayerData] = useState({ name: "", class: "", level: 1, score: 0, xp: 0, quizScore: 0, scenarioScore: 0, flashcardsViewed: 0, finished: false });
            const [unlockCode, setUnlockCode] = useState("");
            const [unlockError, setUnlockError] = useState("");
            const [currentFlashcard, setCurrentFlashcard] = useState(0);
            const [flashcardFlipped, setFlashcardFlipped] = useState(false);
            const [currentQuiz, setCurrentQuiz] = useState(0);
            const [selectedAnswer, setSelectedAnswer] = useState(null);
            const [showQuizFeedback, setShowQuizFeedback] = useState(false);
            const [currentScenario, setCurrentScenario] = useState(0);
            const [scenarioChoice, setScenarioChoice] = useState(null);
            const [showScenarioResult, setShowScenarioResult] = useState(false);

            function verifyUnlockCode() {
                const decoded = decodeSaveCode(unlockCode);
                if (!decoded) { setUnlockError("Code invalide."); return; }
                if (decoded.m !== PREREQUISITE_MODULE) { setUnlockError(`Code du module ${decoded.m}. Il te faut celui de ${PREREQUISITE_MODULE}.`); return; }
                if (!decoded.f) { setUnlockError("Module prÃ©cÃ©dent non terminÃ©."); return; }
                setPlayerData(prev => ({ ...prev, name: decoded.n || "", class: decoded.c || "" }));
                setGameState("intro");
            }

            function startGame() { setGameState("flashcards"); }

            function nextFlashcard() {
                if (currentFlashcard < flashcardsData.length - 1) {
                    setCurrentFlashcard(prev => prev + 1);
                    setFlashcardFlipped(false);
                    setPlayerData(prev => ({ ...prev, flashcardsViewed: Math.max(prev.flashcardsViewed, currentFlashcard + 2), xp: prev.xp + 15 }));
                } else {
                    setGameState("quiz");
                    setPlayerData(prev => ({ ...prev, level: 2, flashcardsViewed: flashcardsData.length, xp: prev.xp + 70 }));
                }
            }

            function prevFlashcard() { if (currentFlashcard > 0) { setCurrentFlashcard(prev => prev - 1); setFlashcardFlipped(false); } }

            function selectQuizAnswer(index) { if (!showQuizFeedback) setSelectedAnswer(index); }

            function validateQuizAnswer() {
                setShowQuizFeedback(true);
                if (selectedAnswer === quizData[currentQuiz].correct) {
                    setPlayerData(prev => ({ ...prev, score: prev.score + 40, quizScore: prev.quizScore + 40, xp: prev.xp + 40 }));
                }
            }

            function nextQuizQuestion() {
                if (currentQuiz < quizData.length - 1) {
                    setCurrentQuiz(prev => prev + 1);
                    setSelectedAnswer(null);
                    setShowQuizFeedback(false);
                } else {
                    setGameState("scenarios");
                    setPlayerData(prev => ({ ...prev, level: 3, xp: prev.xp + 80 }));
                }
            }

            function makeScenarioChoice(index) {
                setScenarioChoice(index);
                setShowScenarioResult(true);
                const choice = scenarioData[currentScenario].choices[index];
                const values = Object.values(choice.impact);
                const totalChange = Math.max(0, values.reduce((a, b) => a + b, 0));
                setPlayerData(prev => ({ ...prev, score: prev.score + totalChange, scenarioScore: prev.scenarioScore + totalChange, xp: prev.xp + 30 }));
            }

            function nextScenario() {
                if (currentScenario < scenarioData.length - 1) {
                    setCurrentScenario(prev => prev + 1);
                    setScenarioChoice(null);
                    setShowScenarioResult(false);
                } else {
                    setPlayerData(prev => ({ ...prev, finished: true, xp: prev.xp + 100 }));
                    setGameState("complete");
                }
            }

            function generateSaveCode() {
                return encodeSaveCode({
                    v: 1, d: new Date().toISOString(), m: MODULE_ID, mv: MODULE_VERSION,
                    n: playerData.name, c: playerData.class, l: 3, s: playerData.score,
                    x: playerData.xp, q: playerData.quizScore, sc: playerData.scenarioScore, f: true
                });
            }

            function copyCode() { navigator.clipboard.writeText(generateSaveCode()).then(() => alert("Code copiÃ© !")); }

            function renderUnlock() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "ðŸ§ "),
                        e("h1", { className: "glitch-title" }, "PIX-pHARe"),
                        e("div", { className: "subtitle" }, "Pilier Dynamiques de Groupe"),
                        e("div", { className: "module-badge" }, "MODULE 03 - VERROUILLÃ‰")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "ðŸ”"),
                            e("div", { className: "panel-title" }, "AccÃ¨s ProtÃ©gÃ©")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "unlock-screen" },
                                e("div", { className: "lock-icon" }, "ðŸ§ "),
                                e("h2", { className: "unlock-title" }, MODULE_TITLE),
                                e("p", { style: { color: "var(--text-secondary)", marginBottom: "20px" } }, "Ce module nÃ©cessite d'avoir complÃ©tÃ© le Module 02 (Le Pouvoir des TÃ©moins)."),
                                e("input", { type: "text", className: "code-input", value: unlockCode, onChange: ev => setUnlockCode(ev.target.value), placeholder: "Code du Module 02..." }),
                                unlockError && e("div", { className: "error-msg" }, unlockError),
                                e("div", { style: { marginTop: "25px" } },
                                    e("button", { className: "action-btn", onClick: verifyUnlockCode, disabled: !unlockCode.trim() }, "[ DÃ‰VERROUILLER ]")
                                )
                            )
                        )
                    )
                );
            }

            function renderIntro() {
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("div", { className: "pillar-icon" }, "ðŸ§ "),
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Module 03"),
                        e("div", { className: "module-badge" }, "DÃ‰SENGAGEMENT MORAL")
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "âš ï¸"),
                            e("div", { className: "panel-title" }, "Les 8 PiÃ¨ges de Bandura")
                        ),
                        e("div", { className: "panel-body" },
                            e("p", { style: { fontSize: "1.1rem", marginBottom: "20px" } }, 
                                e("strong", null, playerData.name), ", tu connais les rÃ´les et les Ã©tapes. Maintenant : les ", 
                                e("strong", { style: { color: "var(--trap-red)" } }, "PIÃˆGES MENTAUX"), "."
                            ),
                            e("p", { style: { marginBottom: "20px" } }, 
                                "Le dÃ©sengagement moral, c'est comment notre cerveau dÃ©sactive nos freins Ã©thiques pour justifier des actes qu'on sait mauvais. ",
                                e("strong", null, "8 mÃ©canismes"), " identifiÃ©s par le psychologue Albert Bandura :"
                            ),
                            e("div", { className: "mechanism-grid" },
                                mechanismsList.map((m, i) => e("div", { key: i, className: "mechanism-mini" }, m))
                            ),
                            e("p", { style: { textAlign: "center", color: "var(--awareness-cyan)", marginTop: "20px" } }, 
                                "ReconnaÃ®tre ces piÃ¨ges = les ", e("strong", null, "neutraliser"), "."
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "30px" } },
                                e("button", { className: "action-btn", onClick: startGame }, "[ COMMENCER ]")
                            )
                        )
                    )
                );
            }

            function renderFlashcards() {
                const card = flashcardsData[currentFlashcard];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 1 : Les 8 MÃ©canismes")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node active" }, "1"),
                        e("div", { className: "progress-node" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "PiÃ¨ge"), e("div", { className: "xp-value" }, `${currentFlashcard + 1}/${flashcardsData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "ðŸŽ­"),
                            e("div", { className: "panel-title" }, "DÃ©masquer les Justifications")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "flashcard-container" },
                                e("div", { className: `flashcard ${flashcardFlipped ? "flipped" : ""}`, onClick: () => setFlashcardFlipped(!flashcardFlipped) },
                                    e("div", { className: "flashcard-face flashcard-front" },
                                        e("div", { className: "flashcard-number" }, card.num),
                                        e("div", { className: "flashcard-mechanism" }, card.mechanism),
                                        e("div", { className: "flashcard-phrase" }, card.phrase),
                                        e("div", { className: "flashcard-question" }, card.question),
                                        e("div", { className: "flashcard-hint" }, card.hint)
                                    ),
                                    e("div", { className: "flashcard-face flashcard-back" },
                                        e("div", { className: "flashcard-mechanism", style: { background: "var(--awareness-cyan)" } }, "NEUTRALISÃ‰"),
                                        e("div", { className: "flashcard-answer", dangerouslySetInnerHTML: { __html: card.answer } })
                                    )
                                )
                            ),
                            e("div", { className: "flashcard-nav" },
                                e("button", { className: "nav-btn", onClick: prevFlashcard, disabled: currentFlashcard === 0 }, "â—„ PRÃ‰C"),
                                e("button", { className: "nav-btn", onClick: nextFlashcard }, currentFlashcard < flashcardsData.length - 1 ? "SUIV â–º" : "NIVEAU 2 â–º")
                            )
                        )
                    )
                );
            }

            function renderQuiz() {
                const question = quizData[currentQuiz];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 2 : Identification")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "âœ“"),
                        e("div", { className: "progress-node active" }, "2"),
                        e("div", { className: "progress-node" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.quizScore)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Question"), e("div", { className: "xp-value" }, `${currentQuiz + 1}/${quizData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "ðŸ”"),
                            e("div", { className: "panel-title" }, "DÃ©tecteur de PiÃ¨ges")
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "quiz-question" }, 
                                question.question,
                                e("span", { className: "quiz-phrase" }, question.phrase)
                            ),
                            e("div", { className: "quiz-options" },
                                question.options.map((opt, idx) => {
                                    let optClass = "quiz-option";
                                    if (showQuizFeedback) {
                                        if (idx === question.correct) optClass += " correct";
                                        else if (idx === selectedAnswer) optClass += " incorrect";
                                    } else if (idx === selectedAnswer) optClass += " selected";
                                    return e("div", { key: idx, className: optClass, onClick: () => selectQuizAnswer(idx) },
                                        e("div", { className: "option-marker" }, String.fromCharCode(65 + idx)),
                                        e("div", { className: "option-text" }, opt)
                                    );
                                })
                            ),
                            showQuizFeedback && e("div", { className: `feedback-box ${selectedAnswer !== question.correct ? "incorrect-feedback" : ""}` },
                                e("div", { className: "feedback-title" }, selectedAnswer === question.correct ? "âœ“ PIÃˆGE IDENTIFIÃ‰" : "âœ— RATÃ‰"),
                                e("p", null, question.feedback)
                            ),
                            e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                !showQuizFeedback ?
                                    e("button", { className: "action-btn", onClick: validateQuizAnswer, disabled: selectedAnswer === null }, "[ VALIDER ]") :
                                    e("button", { className: "action-btn", onClick: nextQuizQuestion }, currentQuiz < quizData.length - 1 ? "[ SUIVANT ]" : "[ NIVEAU 3 ]")
                            )
                        )
                    )
                );
            }

            function renderScenarios() {
                const scenario = scenarioData[currentScenario];
                return e("div", { className: "app-container" },
                    e("div", { className: "header" },
                        e("h1", { className: "glitch-title" }, MODULE_TITLE),
                        e("div", { className: "subtitle" }, "Niveau 3 : Neutralisation")
                    ),
                    e("div", { className: "progress-bar" },
                        e("div", { className: "progress-node completed" }, "âœ“"),
                        e("div", { className: "progress-node completed" }, "âœ“"),
                        e("div", { className: "progress-node active" }, "3")
                    ),
                    e("div", { className: "xp-display" },
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "XP Total"), e("div", { className: "xp-value" }, playerData.xp)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "Score"), e("div", { className: "xp-value" }, playerData.score)),
                        e("div", { className: "xp-box" }, e("div", { className: "xp-label" }, "ScÃ©nario"), e("div", { className: "xp-value" }, `${currentScenario + 1}/${scenarioData.length}`))
                    ),
                    e("div", { className: "content-panel" },
                        e("div", { className: "panel-header" },
                            e("div", { className: "panel-icon" }, "ðŸŽ¯"),
                            e("div", { className: "panel-title" }, scenario.title)
                        ),
                        e("div", { className: "panel-body" },
                            e("div", { className: "scenario-context" }, scenario.context),
                            e("div", { className: "scenario-intro" }, scenario.intro),
                            scenario.traps && e("div", { className: "detected-traps" },
                                e("div", { className: "detected-traps-title" }, "ðŸŽ­ PiÃ¨ges dÃ©tectÃ©s dans cette phrase :"),
                                e("div", null, scenario.traps.map((trap, i) => 
                                    e("span", { key: i, className: "trap-indicator" }, trap)
                                ))
                            ),
                            !showScenarioResult ?
                                e("div", null, scenario.choices.map((choice, idx) =>
                                    e("button", { key: idx, className: "choice-btn", onClick: () => makeScenarioChoice(idx) }, choice.text)
                                )) :
                                e("div", { className: "choice-result" },
                                    e("p", { style: { marginBottom: "15px", lineHeight: "1.7" } }, scenario.choices[scenarioChoice].result),
                                    e("div", { className: "impact-score" },
                                        Object.entries(scenario.choices[scenarioChoice].impact).map(([key, val]) =>
                                            e("div", { key: key, className: `impact-item ${val > 0 ? "positive" : "negative"}` }, `${key}: ${val > 0 ? "+" : ""}${val}`)
                                        )
                                    ),
                                    e("div", { style: { textAlign: "center", marginTop: "25px" } },
                                        e("button", { className: "action-btn", onClick: nextScenario }, currentScenario < scenarioData.length - 1 ? "[ SUIVANT ]" : "[ TERMINER ]")
                                    )
                                )
                        )
                    )
                );
            }

            function renderComplete() {
                const mastery = getMasteryLevel(playerData.score);
                const saveCode = generateSaveCode();
                return e("div", { className: "app-container" },
                    e("div", { className: "completion-screen" },
                        e("div", { className: "completion-icon" }, "ðŸ§ "),
                        e("h1", { className: "completion-title" }, "ESPRIT BLINDÃ‰"),
                        e("p", { style: { fontSize: "1.2rem", color: "var(--text-secondary)", marginBottom: "15px" } }, `Bravo ${playerData.name} ! Tu sais maintenant reconnaÃ®tre les piÃ¨ges de l'esprit.`),
                        e("div", { className: `mastery-badge ${mastery.class}` }, mastery.level),
                        e("div", { className: "stats-grid" },
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.score), e("div", { className: "stat-label" }, "Score Total")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.xp), e("div", { className: "stat-label" }, "XP GagnÃ©s")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.quizScore), e("div", { className: "stat-label" }, "Identification")),
                            e("div", { className: "stat-card" }, e("div", { className: "stat-value" }, playerData.scenarioScore), e("div", { className: "stat-label" }, "Neutralisation"))
                        ),
                        e("div", { className: "save-code-box" },
                            e("div", { className: "save-code-label" }, "ðŸ“‹ TON CODE (pour le Module 04) :"),
                            e("div", { className: "save-code" }, saveCode),
                            e("button", { className: "copy-btn", onClick: copyCode }, "Copier le code")
                        ),
                        e("div", { className: "content-panel", style: { marginTop: "30px", textAlign: "left" } },
                            e("div", { className: "panel-header" },
                                e("div", { className: "panel-icon" }, "ðŸŽ“"),
                                e("div", { className: "panel-title" }, "CompÃ©tences acquises")
                            ),
                            e("div", { className: "panel-body" },
                                e("p", null, "Tu connais maintenant les ", e("strong", { style: { color: "var(--trap-orange)" } }, "8 mÃ©canismes de dÃ©sengagement moral"), " de Bandura."),
                                e("p", { style: { marginTop: "15px" } }, "Tu sais identifier ces piÃ¨ges dans les phrases quotidiennes et proposer des contre-arguments."),
                                e("p", { style: { marginTop: "15px" } }, "Dans le Module 04, tu apprendras Ã  ", e("strong", { style: { color: "var(--awareness-cyan)" } }, "briser le cycle"), " : des techniques concrÃ¨tes pour transformer les dynamiques de groupe.")
                            )
                        )
                    )
                );
            }

            switch (gameState) {
                case "unlock": return renderUnlock();
                case "intro": return renderIntro();
                case "flashcards": return renderFlashcards();
                case "quiz": return renderQuiz();
                case "scenarios": return renderScenarios();
                case "complete": return renderComplete();
                default: return renderUnlock();
            }
        }

        ReactDOM.createRoot(document.getElementById("root")).render(e(App));
    </script>
</body>
</html>
